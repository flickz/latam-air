var destPickerBinded=false;var destinationPicker=function(){var _config={bloc:"",eloc:"",blocEloc:"",boundId:"",dateInputName:"",currentlyClickedInput:"",airportFiltered:"",airList:clientSideData.SORTED_AIRPORTS,destPickerOpened:false,topDestinationAirports:clientSideData.TOP_DESTINATION_AIRPORTS,topDestinationAirportsFiltered:"",currentlySelectedContinent:"BRASIL",outboundAirList:"",inboundAirList:"",targetFormName:"SEARCH_FORM"};var locationsTemplate=$('<script id="locationsTemplate"'+'type="text/x-jquery-tmpl">{{each obj}}<li data-code="{{html $value.IATA}}"'+'class="midst {{if $value.continent=="BRASIL" || $value.continent=="AMERICA" || $value.continent=="EUROP" || $value.continent=="ASIA"}}{{html $value.continent}}'+'{{else}}{{if $value.continent=="CARIB"}}AMERICA{{else}}ASIA{{/if}}{{/if}}list">'+"{{if $value.name!=$value.airport}} {{html $value.name}} - {{/if}}"+"{{html $value.airport}}&nbsp;({{html $value.IATA}})</li>"+"{{/each obj}}"+"<\/script>");function initDestinationPicker(){initAirports();var $bLocInput=$("#"+_config.bloc);var $eLocInput=$("#"+_config.eloc);var bLocData=$bLocInput.attr("data-code");var eLocData=$eLocInput.attr("data-code");if(typeof bLocData!="undefined"){$bLocInput.val(getLocationName(bLocData));}if(typeof eLocData!="undefined"){$eLocInput.val(getLocationName(eLocData));}}function initAirports(){$(_config.blocEloc).keyup(function(e){if(e.keyCode!=13&&e.keyCode!=38&&e.keyCode!=40&&e.keyCode!=9&&e.keyCode!=37&&e.keyCode!=39){var nbCar=$(e.target).val().length;if(nbCar>=0){if(typeof _config.airList!="undefined"&&_config.airList.length){if((typeof _config.topDestinationAirports!="undefined"&&_config.topDestinationAirports.length&&clientSideData.IS_COMPANION_FLOW==false)||(clientSideData.IS_COMPANION_FLOW==true&&_config.currentlyClickedInput.id==_config.bloc&&clientSideData.COMPANION_LIMITED_AIRPORTS!=null&&clientSideData.COMPANION_LIMITED_AIRPORTS.OUTBOUND_LIMIT=="")||(clientSideData.IS_COMPANION_FLOW==true&&_config.currentlyClickedInput.id==_config.eloc&&clientSideData.COMPANION_LIMITED_AIRPORTS!=null&&clientSideData.COMPANION_LIMITED_AIRPORTS.INBOUND_LIMIT=="")){_config.topDestinationAirportsFiltered=updateLocationList(_config.topDestinationAirports,$(e.target).val());initLocationListTmpl(_config.topDestinationAirportsFiltered,true);}else{$("#topDestList").html("");}if(clientSideData.IS_COMPANION_FLOW==true&&clientSideData.COMPANION_LIMITED_AIRPORTS!=null&&(clientSideData.COMPANION_LIMITED_AIRPORTS.OUTBOUND!=null||clientSideData.COMPANION_LIMITED_AIRPORTS.INBOUND!=null)){if(_config.currentlyClickedInput.id==_config.bloc){_config.airportFiltered=updateLocationList(_config.outboundAirList,$(e.target).val());}else{_config.airportFiltered=updateLocationList(_config.inboundAirList,$(e.target).val());}}else{_config.airportFiltered=updateLocationList(_config.airList,$(e.target).val());}}initLocationListTmpl(_config.airportFiltered);if(_config.airportFiltered.length==0){$("#destList").html("<li class='midst em'>"+clientMessages["ALLP.error.NoDestinationFound"]+"</li>").find("li:first").unbind();}$("#tooltip_countries").show();hideAlreadySelectedInputValue(_config.bloc,_config.eloc);$("#destList li:visible:not(.em)").first().addClass("destpicker_selected");$("#destList li:visible:not(.em)").first().attr("id","dest-picker-selected-item");destinationPickerHelper.destPickerOpened=true;}}});}function initLocationListTmpl(airList,isTop){var wrapperFeedSect;if(isTop==undefined){wrapperFeedSect=$("#destList");}else{wrapperFeedSect=$("#topDestList");}if(isTop&&isCar()){airList=clientSideData.TOP_CAR_DESTINATION_AIRPORTS;}if(isTop&&isHotel()){airList=clientSideData.TOP_HOTEL_DESTINATION_AIRPORTS;}wrapperFeedSect.html("");wrapperFeedSect.append(locationsTemplate.tmpl([{"obj":airList}]));$("#destList li").filter(":visible").eq(0).addClass("boxl");}function updateLocationList(list,val){var varSearch=val.replace(/^\s*/,"").replace(/\s*$/,"");varSearch=varSearch.ignoreAccent();var newList=[];var foundCode=false;var foundCodeCountry="";var newListCountry=[];if(varSearch.length>0){$("#topDestList").addClass("none");$("#destList li:visible").eq(0).removeClass("boxl");}else{$("#topDestList").removeClass("none");$("#destList li:visible").eq(0).addClass("boxl");}for(var i=0;i<list.length;i++){if(list[i].IATA.toLowerCase()===varSearch.toLowerCase()){newList=[{name:list[i].name,country:list[i].country,airport:list[i].airport,domestic:list[i].domestic,IATA:list[i].IATA,regionCode:list[i].regionCode,countryCode:list[i].countryCode,continent:list[i].continent}].concat(newList);foundCode=true;foundCodeCountry=list[i].country;}else{if(list[i].name.ignoreAccent().toLowerCase().indexOf(varSearch.toLowerCase())+1>0||list[i].airport.ignoreAccent().toLowerCase().indexOf(varSearch.toLowerCase())+1>0||list[i].IATA.toLowerCase().indexOf(varSearch.toLowerCase())+1>0){newList.push({name:list[i].name,country:list[i].country,airport:list[i].airport,domestic:list[i].domestic,IATA:list[i].IATA,regionCode:list[i].regionCode,countryCode:list[i].countryCode,continent:list[i].continent});}}}if(foundCode){var startIndex=-1;var endIndex=-1;for(i=1;i<newList.length;i++){if(newList[i].country===foundCodeCountry){if(startIndex==-1){startIndex=i;endIndex=i;}endIndex++;}}if(startIndex!=-1){newListCountry=newList.slice(0,1).concat(newList.slice(startIndex,endIndex),newList.slice(1,startIndex),newList.slice(endIndex));newList=newListCountry;}}return newList;}function closeDatePicker(){$("#tooltip_countries div").scrollTop(0);$("#tooltip_countries").hide();destinationPickerHelper.destPickerOpened=false;return false;}function bindDestPickers(){var self=this;var getDataBoundId=function(target){var id=undefined;id=target.parents("fieldset").eq(0).attr("data-bound-id");if(typeof id==="undefined"){if($("#home_car:visible").length>0){id=$("#home_car").attr("data-bound-id");}else{if($("#onlineCar:visible").length>0){id=$("#onlineCar").attr("data-bound-id");}else{if($("#searchPanel:visible").length>0){id=$("#searchPanel").attr("data-bound-id");}else{if($("#home_hotel:visible").length>0){id=$("#home_hotel").attr("data-bound-id");}else{if($("#onlineHotel:visible").length>0){id=$("#onlineHotel").attr("data-bound-id");}else{if($("#searchPanel.hotelMini:visible").length>0){id=$("#searchPanel.hotelMini").attr("data-bound-id");}}}}}}}return id;};$(document).mouseup(function(e){if($(e.target).parents("#tooltip_countries").length==0){$("#tooltip_countries div").scrollTop(0);$("#tooltip_countries:visible").hide();}});$(_config.blocEloc+", #tooltip_countries p.boxg span").unbind("click").click(function(e){$(e.target).trigger("openDestPicker",e);}).focusin(function(e){destinationPickerHelper.currentlyClickedInput=this;if(e.target.id!=_config.bloc&&e.target.id!=_config.eloc){$(e.target).trigger("openDestPicker",e);}$("#tooltip_countries")[0].className=$("#tooltip_countries")[0].className.replace(/\btooltip_countries.*?\b/g,"");$("#tooltip_countries").addClass("tooltip_countries"+getDataBoundId($(e.target)));}).bind("openDestPicker",function(e){if(destinationPickerHelper.destPickerOpened==true&&e.target.id==destinationPickerHelper.currentlyClickedInput.id){destinationPickerHelper.destPickerOpened=false;}if(destinationPickerHelper.destPickerOpened==false){if(e.target.id==_config.bloc||e.target.id==_config.eloc){_config.currentlyClickedInput=this;destinationPickerHelper.currentlyClickedInput=this;destinationPickerHelper.boundId=getDataBoundId($(e.target));$("#tooltip_countries").show();setPositionLocalisation(_config.currentlyClickedInput);}destinationPickerHelper.destPickerOpened=true;if(isHotel()||isCar()||clientSideData.IS_COMPANION_FLOW==false||(clientSideData.IS_COMPANION_FLOW==true&&_config.currentlyClickedInput.id==_config.eloc&&clientSideData.COMPANION_LIMITED_AIRPORTS!=null&&clientSideData.COMPANION_LIMITED_AIRPORTS.INBOUND_LIMIT=="")||(clientSideData.IS_COMPANION_FLOW==true&&_config.currentlyClickedInput.id==_config.bloc&&clientSideData.COMPANION_LIMITED_AIRPORTS!=null&&clientSideData.COMPANION_LIMITED_AIRPORTS.OUTBOUND_LIMIT=="")){initLocationListTmpl(_config.topDestinationAirports,true);}else{$("#topDestList").html("");}if(clientSideData.IS_COMPANION_FLOW==true&&clientSideData.COMPANION_LIMITED_AIRPORTS!=null&&(clientSideData.COMPANION_LIMITED_AIRPORTS.OUTBOUND!=null||clientSideData.COMPANION_LIMITED_AIRPORTS.INBOUND!=null)){if(_config.currentlyClickedInput.id==_config.bloc){initLocationListTmpl(_config.outboundAirList);}else{if(_config.currentlyClickedInput.id==_config.eloc){initLocationListTmpl(_config.inboundAirList);}}}else{initLocationListTmpl(isCar()?clientSideData.CAR_SORTED_AIRPORTS:(isHotel()?clientSideData.HOTEL_SORTED_AIRPORTS:_config.airList));}showAirportsByContinent(_config.currentlySelectedContinent);hideAlreadySelectedInputValue(_config.bloc,_config.eloc);$("#destList li").removeClass("boxl");$("#destList li").filter(":visible").eq(0).addClass("boxl");$("#topDestList").removeClass("none");$(_config.currentlyClickedInput).val("");}}).focusout(function(e){if(!($.browser.msie&&parseInt($.browser.version,10)==7||$.browser.msie&&parseInt($.browser.version,10)==8)){if($("#tooltip_countries li").parent().find(":hover").length>0){$("#tooltip_countries li.destpicker_selected").removeClass("destpicker_selected");$("#tooltip_countries li").parent().find(":hover").addClass("destpicker_selected");}}if(destinationPickerHelper.destPickerOpened==true){if($("#tooltip_countries li.destpicker_selected").length>0){$("#tooltip_countries li.destpicker_selected").click();}}$(e.target).val(getLocationName($(e.target).attr("data-code")));destinationPickerHelper.destPickerOpened=false;});$("#tooltip_countries p.toggle small.ico, #tooltip_countries p.toggle u.em").click(function(){$("#tooltip_countries div").scrollTop(0);$("#tooltip_countries").hide();destinationPickerHelper.destPickerOpened=false;});$("#tooltip_countries p.boxg span").click(function(){$("#tooltip_countries ol li").hide();$("#tooltip_countries p.boxg span").removeClass("em3");$(this).addClass("em3");$("."+this.getAttribute("data-continent")+"list").show();_config.currentlySelectedContinent=this.getAttribute("data-continent");hideAlreadySelectedInputValue(_config.bloc,_config.eloc);$("#destList li").removeClass("boxl");$("#destList li").filter(":visible").eq(0).addClass("boxl");});$(_config.eloc).keydown(function(e){switch(e.keyCode){case 9:if(destinationPickerHelper.destPickerOpened==true){if($("#tooltip_countries li.destpicker_selected").length>0&&$("#tooltip_countries:visible").length>0){$("#tooltip_countries li.destpicker_selected").click();}}$("#tooltip_countries").hide();destinationPickerHelper.destPickerOpened=false;break;}});$("#"+_config.dateInputName).keyup(function(e){switch(e.keyCode){case 9:if(e.target.id==_config.dateInputName){if(destinationPickerHelper.destPickerOpened==true&&$("#tooltip_countries li.destpicker_selected").length>0){$("#tooltip_countries li.destpicker_selected").click();}else{closeDatePicker();}}break;default:break;}});$(_config.blocEloc).keyup(function(e){var selected=$("#dest-picker-selected-item");switch(e.keyCode){case 8:if($(e.target).val()==""){$("#tooltip_countries div").scrollTop(0);$("#tooltip_countries").hide();if(e.target.id==_config.bloc){changeDepartureLocationInputValue("",false);}else{if(e.target.id==_config.eloc){changeArrivalLocationInputValue("",false);}}destinationPickerHelper.destPickerOpened=false;}else{if($("#destList li:visible").length==0){$("#destList").html("<li class='midst em'>"+clientMessages["ALLP.text.AirportAlreadySelected"]+"</li>").find("li:first").unbind();}}var theForm=$("form[name='"+_config.targetFormName+"']");if($("input[name='TRIP_TYPE'][checked='checked']",theForm).val()=="M"){multicitySearch.disableOrEnableFields();}break;case 9:if(e.target.id==_config.eloc){$("#tooltip_countries div").scrollTop(0);if(destinationPickerHelper.destPickerOpened==true&&$("#tooltip_countries:visible").length>0){$("#tooltip_countries li.destpicker_selected").click();}$("#"+_config.eloc).trigger("click");}else{if(e.target.id==_config.bloc){$("#tooltip_countries div").scrollTop(0);$("#tooltip_countries").hide();$("#"+_config.bloc).trigger("click");}}var theForm=$("form[name='"+_config.targetFormName+"']");if($("input[name='TRIP_TYPE'][checked='checked']",theForm).val()=="M"){multicitySearch.disableOrEnableFields();}break;case 13:e.preventDefault();if(destinationPickerHelper.destPickerOpened==true){$("#tooltip_countries li.destpicker_selected").click();$("#tooltip_countries div").scrollTop(0);$("#tooltip_countries").hide();destinationPickerHelper.destPickerOpened=false;}var theForm=$("form[name='"+_config.targetFormName+"']");if($("input[name='TRIP_TYPE'][checked='checked']",theForm).val()=="M"){multicitySearch.disableOrEnableFields();}break;case 27:$("#tooltip_countries div").scrollTop(0);$("#tooltip_countries").hide();if(e.target.id==_config.bloc){changeDepartureLocationInputValue("",true);}else{if(e.target.id==_config.eloc){changeArrivalLocationInputValue("",true);}}destinationPickerHelper.destPickerOpened=false;var theForm=$("form[name='"+_config.targetFormName+"']");if($("input[name='TRIP_TYPE'][checked='checked']",theForm).val()=="M"){multicitySearch.disableOrEnableFields();}break;case 38:case 37:if(!($.browser.msie&&~~($.browser.version)<7)){if(self.destPickerOpened==false){$(e.target).trigger("openDestPicker",e);}if(selected.length==0){$("#destList li:visible").last().addClass("destpicker_selected");$("#destList li:visible").last().attr("id","dest-picker-selected-item");if($("#destList li:visible").last().length>0){$("#tooltip_countries div").scrollTop($("#destList li:visible").last().position().top);}}else{if(selected.prevAll().filter(":visible").first().length==0){selected.removeClass("destpicker_selected");selected.attr("id","");if(selected.parent().attr("id")=="destList"&&$("#topDestList li:visible").last().length>0){$("#topDestList li:visible").last().addClass("destpicker_selected");$("#topDestList li:visible").last().attr("id","dest-picker-selected-item");$("#tooltip_countries div").scrollTop($("#topDestList li:visible").last().position().top);}else{if($("#destList li:visible").last().length>0){$("#destList li:visible").last().addClass("destpicker_selected");$("#destList li:visible").last().attr("id","dest-picker-selected-item");$("#tooltip_countries div").scrollTop($("#destList li:visible").last().position().top);}}}else{selected.removeClass("destpicker_selected");selected.attr("id","");var prevElem=selected.prevAll().filter(":visible").first();prevElem.addClass("destpicker_selected");prevElem.attr("id","dest-picker-selected-item");var top=prevElem.position().top+selected.prevAll().filter(":visible").first().height();var topPan=selected.parents("#tooltip_countries div").height();if(top<topPan){selected.parents("#tooltip_countries div").scrollTop($("#tooltip_countries div").scrollTop()+top-60);}}}}break;case 40:case 39:if(!($.browser.msie&&~~($.browser.version)<7)){if(self.destPickerOpened==false){$(e.target).trigger("openDestPicker",e);}if(selected.length==0){if($("#topDestList li").filter(":visible").first().length>0){$("#topDestList li:visible").first().addClass("destpicker_selected");$("#topDestList li:visible").first().attr("id","dest-picker-selected-item");$("#tooltip_countries div").scrollTop(0);}else{$("#destList li:visible").first().addClass("destpicker_selected");$("#destList li:visible").first().attr("id","dest-picker-selected-item");$("#tooltip_countries div").scrollTop(0);}}else{if(selected.nextAll().filter(":visible").last().length==0){selected.removeClass("destpicker_selected");selected.attr("id","");if(selected.parent().attr("id")=="destList"&&$("#topDestList li:visible").first().length>0){$("#topDestList li:visible").first().addClass("destpicker_selected");$("#topDestList li:visible").first().attr("id","dest-picker-selected-item");$("#tooltip_countries div").scrollTop($("#topDestList li:visible").first().position().top);}else{if($("#destList li:visible").first().length>0){$("#destList li:visible").first().addClass("destpicker_selected");$("#destList li:visible").first().attr("id","dest-picker-selected-item");$("#tooltip_countries div").scrollTop($("#destList li:visible").first().position().top-40);}}}else{selected.removeClass("destpicker_selected");selected.attr("id","");var nextElem=selected.nextAll().filter(":visible").first();nextElem.addClass("destpicker_selected");nextElem.attr("id","dest-picker-selected-item");var bottom=nextElem.position().top+nextElem.height();var botPan=selected.parents("#tooltip_countries div").height();if(bottom>botPan){selected.parents("#tooltip_countries div").scrollTop($("#tooltip_countries div").scrollTop()+bottom-botPan+20);}}}}break;case 46:$("#tooltip_countries div").scrollTop(0);$("#tooltip_countries").hide();if(e.target.id==_config.bloc){changeDepartureLocationInputValue("",true);}else{if(e.target.id==_config.eloc){changeArrivalLocationInputValue("",true);}}destinationPickerHelper.destPickerOpened=false;var theForm=$("form[name='"+_config.targetFormName+"']");if($("input[name='TRIP_TYPE'][checked='checked']",theForm).val()=="M"){multicitySearch.disableOrEnableFields();}break;default:$("#tooltip_countries div").scrollTop(0);if($("#destList li:visible").length==0){$("#destList").html("<li class='em'>"+clientMessages["ALLP.text.AirportAlreadySelected"]+"</li>");}break;}}).keydown(function(e){switch(e.keyCode){case 13:e.preventDefault();break;case 9:if(isHotel()||isCar()){$("#tooltip_countries").hide();}break;default:break;}});}function initUseMyPointsManager(confObj){var formDOM=$("form[name='"+_config.targetFormName+"']");var useMyPointsChbx=$(formDOM).find("input[name='"+confObj.trigger+"']");var cabinSelect=$(formDOM).find("select[name='"+confObj.cab+"']");var changedOutboundB=$("form[name='"+_config.targetFormName+"']").find("input[name='B_LOCATION_1']").val();var changedOutboundE=$("form[name='"+_config.targetFormName+"']").find("input[name='E_LOCATION_1']").val();if(changedOutboundB!=""&&changedOutboundE!=""){$(cabinSelect).find("option").remove();if($(useMyPointsChbx).prop("checked")){theSearch.configureMarketingCabin("redemption",confObj);}else{theSearch.configureMarketingCabin("revenue",confObj);}}else{$(".cabin_search").hide();$("#promocodebox").addClass("br");}}function handleWarningForBothBoundChange(){var info=$("#pageWarning").errorPanel();info.errorPanel("addError",null,null,clientMessages[clientSideData.PAGE_CODE+".text.changeBothBoundWarning"]);$(window).scrollTop(0);}function changeDepartureLocationInputValue(iataCode,updateTextInput,callCallback){var callback=true;if(typeof callCallback!="undefined"){callback=callCallback;}var textInput=$("#"+_config.bloc);if(iataCode!=""){textInput.attr("data-code",iataCode);}else{textInput.removeAttr("data-code");}if(updateTextInput){textInput.val(iataCode!=""?getLocationName(iataCode):"");}var theForm=$("form[name='"+_config.targetFormName+"']");theForm.input("B_LOCATION_"+_config.boundId).val(iataCode);if(typeof _config.onDepartureSelection!="undefined"&&callback){_config.onDepartureSelection(iataCode);}}function changeArrivalLocationInputValue(iataCode,updateTextInput,callCallback){var callback=true;if(typeof callCallback!="undefined"){callback=callCallback;}var textInput=$("#"+_config.eloc);if(iataCode!=""){textInput.attr("data-code",iataCode);}else{textInput.removeAttr("data-code");}if(updateTextInput){textInput.val(iataCode!=""?getLocationName(iataCode):"");}var theForm=$("form[name='"+_config.targetFormName+"']");theForm.input("E_LOCATION_"+_config.boundId).val(iataCode);if(typeof _config.OnArrivalSelection!="undefined"&&callback){_config.OnArrivalSelection(iataCode);}}function selectOrigin(iataCode,callCallback){changeDepartureLocationInputValue(iataCode,true,callCallback);}function selectDestination(iataCode,callCallback){changeArrivalLocationInputValue(iataCode,true,callCallback);}function getOriginIataCode(){var iata=$("#"+_config.bloc).attr("data-code");return typeof iata!="undefined"?iata:"";}function getDestinationIataCode(){var iata=$("#"+_config.eloc).attr("data-code");return typeof iata!="undefined"?iata:"";}function bindAirportSelection(){$("#tooltip_countries").on("click","div ol li",function(e){if(typeof $(this).data("code")!=="undefined"){var theForm=$("form[name='"+_config.targetFormName+"']");if(destinationPickerHelper.currentlyClickedInput!=null&&(destinationPickerHelper.currentlyClickedInput.id==_config.bloc||destinationPickerHelper.currentlyClickedInput.id==_config.eloc)){if(destinationPickerHelper.currentlyClickedInput.id==_config.bloc){changeDepartureLocationInputValue(this.getAttribute("data-code"),true);if($("input[name='E_LOCATION_"+_config.boundId+"']",theForm).val()==this.getAttribute("data-code")){changeArrivalLocationInputValue("",true);}if(clientSideData.PAGE_CODE!=="ATCSEARCH"&&clientSideData.PAGE_CODE!=="RD_ATC_SRCH"&&!isCar()&&!isHotel()){initUseMyPointsManager({"trigger":"passenger_useMyPoints","cab":"MARKETING_CABIN","formName":"SEARCH_FORM"});}else{if(typeof theChangeCabin!=="undefined"){theChangeCabin.manageChangeCabin();}}$("#tooltip_countries div").scrollTop(0);$("#tooltip_countries").hide();destinationPickerHelper.destPickerOpened=false;if($("input[name='TRIP_TYPE'][checked='checked']",theForm).val()=="M"){multicitySearch.disableOrEnableFields();}}else{if(destinationPickerHelper.currentlyClickedInput.id==_config.eloc){changeArrivalLocationInputValue(this.getAttribute("data-code"),true);$("#tooltip_countries div").scrollTop(0);$("#tooltip_countries").hide();destinationPickerHelper.destPickerOpened=false;if(clientSideData.PAGE_CODE!=="ATCSEARCH"&&clientSideData.PAGE_CODE!=="RD_ATC_SRCH"){if($("input#multicity").value()=="M"){multicitySearch.disableOrEnableFields();initUseMyPointsManager({"trigger":"passenger_useMyPoints","cab":"MARKETING_CABIN","isMulticity":"true","formName":"SEARCH_FORM"});}else{initUseMyPointsManager({"trigger":"passenger_useMyPoints","cab":"MARKETING_CABIN","formName":"SEARCH_FORM"});}}else{if(typeof theChangeCabin!=="undefined"){theChangeCabin.manageChangeCabin();}}}}$(destinationPickerHelper.currentlyClickedInput).trigger("change");}}else{closeDatePicker();}});}function showAirportsByContinent(continent){$(".BRASILlist, .AMERICAlist, .EUROPlist, .ASIAlist").hide();var continentToBeShown=continent;if(continent==undefined||continent==null){if($("#destList li.BRASILlist").length>0){continentToBeShown="BRASIL";}else{if($("#destList li.AMERICAlist").length>0){continentToBeShown="AMERICA";}else{if($("#destList li.EUROPlist").length>0){continentToBeShown="EUROP";}else{if($("#destList li.ASIAlist").length>0){continentToBeShown="ASIA";}}}}}$("#tooltip_countries p.boxg span").removeClass("em3");$("#tooltip_countries p.boxg span[data-continent='"+continentToBeShown+"']").addClass("em3");_config.currentlySelectedContinent=continentToBeShown;$("."+continentToBeShown+"list").show();}function setPositionLocalisation(button){var dest_wrapper;var bodyId=$("body").attr("id").toLowerCase();if(bodyId=="home_search"){dest_wrapper=$("body");}else{if(bodyId=="upsl"||bodyId=="rd_upsl"||bodyId=="rd_mo_cald"||bodyId=="avai"||bodyId=="cp_upsl"||bodyId=="carl"||bodyId=="hotl"){dest_wrapper=$("#searchPanel");}else{dest_wrapper=$("section.main.wrap");}}var ui_dest=$("#tooltip_countries");var eleOffset=$(button).offset();ui_dest.hide();ui_dest.show();var posX;var posY;if(bodyId=="home_search"){posX=dest_wrapper.offset().left+30;if(posX<0){posX=50;}posY=eleOffset.top-dest_wrapper.offset().top+20;}else{if(bodyId=="upsl"||bodyId=="rd_upsl"||bodyId=="cp_upsl"||bodyId=="carl"||bodyId=="hotl"){posX=eleOffset.left-dest_wrapper.offset().left-50;if(posX<0){posX=50;}posY=eleOffset.top-dest_wrapper.offset().top+55;}else{if(bodyId=="rd_mo_cald"||bodyId=="avai"){posX=eleOffset.left-dest_wrapper.offset().left-50;if(posX<0){posX=50;}posY=eleOffset.top-dest_wrapper.offset().top+75;}else{posX=eleOffset.left-dest_wrapper.offset().left-10;if(posX<0){posX=0;}posY=eleOffset.top-dest_wrapper.offset().top;}}}if(bodyId!="home_search"&&(posY+$("#tooltip_countries").height()>$("#mainOuter").height())){posY=posY-$("#tooltip_countries").height()-$(button).parent().height();}ui_dest.css({"top":posY,"left":posX});if(bodyId=="home_search"&&$("#home_car:visible").length>0){$("#tooltip_countries").addClass("tooltipCountriesSmaller");}else{if(bodyId=="home_search"&&$("#home_hotel:visible").length>0){$("#tooltip_countries").addClass("tooltipCountriesSmaller");}else{$("#tooltip_countries").removeClass("tooltipCountriesSmaller");}}$("#tooltip_countries").css("z-index","1000");ui_dest.find("h3").css("width","100%");ui_dest.hide();ui_dest.show();}function isCar(){if($("#home_car:visible").length>0||$("#onlineCar:visible").length>0||$("#searchPanel.carMini:visible").length>0||theUtils.isCarFlow()){return true;}return false;}function isHotel(){if($("#home_hotel:visible").length>0||$("#onlineHotel:visible").length>0||$("#searchPanel.hotelMini:visible").length>0||theUtils.isHotelFlow()){return true;}return false;}function hideAlreadySelectedInputValue(firstInput,secondInput){if(isCar()||isHotel()){return false;}if(_config.currentlyClickedInput!=null&&typeof _config.currentlyClickedInput!=="undefined"&&_config.currentlyClickedInput.id==_config.eloc){var theOtherInput;if(_config.currentlyClickedInput.id==secondInput){theOtherInput=$("#"+firstInput);}else{theOtherInput=$("#"+secondInput);}$("#destList li[data-code='"+theOtherInput.attr("data-code")+"']").hide();$("#topDestList li[data-code='"+theOtherInput.attr("data-code")+"']").hide();}}function getLocationName(Iata){var airportList=isCar()?clientSideData.CAR_SORTED_AIRPORTS:(isHotel()?clientSideData.HOTEL_SORTED_AIRPORTS:_config.airList);if(null!=airportList&&typeof airportList!="undefined"&&airportList.length){for(var i=0;i<airportList.length;i++){if(Iata==airportList[i].IATA){if(airportList[i].name!=airportList[i].airport){return airportList[i].name+" - "+airportList[i].airport+" ("+airportList[i].IATA+")";}else{return airportList[i].name+" ("+airportList[i].IATA+")";}break;}}}airportList=isCar()?clientSideData.TOP_CAR_DESTINATION_AIRPORTS:(isHotel()?clientSideData.TOP_HOTEL_DESTINATION_AIRPORTS:undefined);if(typeof airportList!="undefined"&&airportList.length){for(var i=0;i<airportList.length;i++){if(Iata==airportList[i].IATA){if(airportList[i].name!=airportList[i].airport){return airportList[i].name+" - "+airportList[i].airport+" ("+airportList[i].IATA+")";}else{return airportList[i].name+" ("+airportList[i].IATA+")";}break;}}}return"";}function bindInputArrows(outboundInput,inboundInput){$("span.selectBox-arrowOnInput",$("#"+outboundInput).parent()).click(function(e){if($(this).prev().prop("disabled")==false){destinationPickerHelper.destPickerOpened=false;$(this).prev().focus();$(this).prev().trigger("click");}});$("span.selectBox-arrowOnInput",$("#"+inboundInput).parent()).click(function(e){if($(this).prev().prop("disabled")==false){destinationPickerHelper.destPickerOpened=false;$(this).prev().focus();$(this).prev().trigger("click");}});}function setConfig(list){_config.topDestinationAirports=list.topDestinationAirports;_config.airList=list.airList;}function getConfig(){return _config;}return{init:function(bLocationInputName,eLocationInputName,bound,dateInputName,targetFormName,onDepartureSelection,OnArrivalSelection){_config.bloc=bLocationInputName;_config.eloc=eLocationInputName;_config.dateInputName=dateInputName;_config.blocEloc="#"+bLocationInputName+", #"+eLocationInputName;_config.boundId=bound;_config.targetFormName=typeof targetFormName!="undefined"?targetFormName:"SEARCH_FORM";if(typeof onDepartureSelection!="undefined"){_config.onDepartureSelection=onDepartureSelection;}if(typeof OnArrivalSelection!="undefined"){_config.OnArrivalSelection=OnArrivalSelection;}bindInputArrows(_config.bloc,_config.eloc);if(clientSideData.COMPANION_LIMITED_AIRPORTS!=null){if(clientSideData.COMPANION_LIMITED_AIRPORTS.OUTBOUND!=null){_config.outboundAirList=clientSideData.COMPANION_LIMITED_AIRPORTS.OUTBOUND;}if(clientSideData.COMPANION_LIMITED_AIRPORTS.INBOUND!=null){_config.inboundAirList=clientSideData.COMPANION_LIMITED_AIRPORTS.INBOUND;}}initDestinationPicker();},bindAirportSelection:function(){bindAirportSelection();},bindDestPickers:function(){bindDestPickers();},getLocationName:function(iata){getLocationName(iata);},setConfig:function(list){setConfig(list);},getConfig:function(){return getConfig();},getOriginIataCode:getOriginIataCode,getDestinationIataCode:getDestinationIataCode,selectOrigin:selectOrigin,selectDestination:selectDestination};};var destinationPickerHelper={boundId:"",currentlyClickedInput:"",destPickerOpened:false};