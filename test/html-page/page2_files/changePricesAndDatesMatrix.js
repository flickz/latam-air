var template_changePricesAndDatesMatrix=$('<script id="template_changePricesAndDatesMatrix" type="text/x-jquery-tmpl">'+"<div>"+'<header class="caption4">'+'<h3 class="h6">${messages.changePricesDates}</h3>'+"</header>"+'<section style="background:white;padding-top:5px;"><div style="margin:5px 5px 0 5px;display:none;" id="popinWarning" class="warning w4"></div></section>'+'<section style="background:white;padding:8px;">'+'<button class="fr changeDates">${messages.changeDates}</button>'+'<input type="text" class="changeDatesDP" style="display:none;" />'+'<input type="text" class="changeDatesDP" style="display:none;" />'+'<p class="mr">${messages.info}</p>'+'<header class="caption boxw">'+'<h2 class="em3">${messages.inboundOutbound} </h2><span>${messages.from} '+"<strong>${template_changePricesAndDatesMatrix.formatDestination(departureCity)}</strong> ${messages.to} <strong>"+"${template_changePricesAndDatesMatrix.formatDestination(arrivalCity)}</strong></span>"+"</header>"+'<table class="cald br tc">'+"<thead>"+"<tr>"+'<th class="bottomF" colspan="2"></th>'+'<th class="h2 caption" colspan="7">${messages.returnTrip}</th>'+"</tr>"+"<tr>"+'<th colspan="2"></th>'+"{{each calendar[0].RETURN}}"+'<th class="caption{{if IS_SELECTED}}2{{/if}}">${FORMATED_DATE}</th>'+"{{/each}}"+"</tr>"+"</thead>"+"<tbody>"+"{{each(index, outbound) calendar}}"+"<tr>"+"{{if index == 0}}"+'<th rowspan="7" class="h2 caption">{{html template_changePricesAndDatesMatrix.formatDeparting(messages.departing)}}</th>'+"{{/if}}"+'<th class="caption{{if outbound.IS_SELECTED}}2{{/if}}">${outbound.FORMATED_DATE}</th>'+"{{each RETURN}}"+"{{if AVAILABLE && !OUT_OF_SCOPE}}"+"{{if CHEAPEST || IS_SELECTED}}"+"{{if IS_SELECTED && outbound.IS_SELECTED}}"+"{{if CHEAPEST}}"+'<td class="caption3 lowest em3 selected">'+'<small class="fr"><small class="ico cheap"></small></small>'+"<strong>${template_changePricesAndDatesMatrix.formatPrice(PRICE)}</strong>"+'<span class="inDateInbound" style="display:none">${INPUT_FORMATED_DATE}</span>'+'<span class="inDateOutbound" style="display:none">${outbound.INPUT_FORMATED_DATE}</span>'+"</td>"+"{{else}}"+'<td class="caption3 selected">${template_changePricesAndDatesMatrix.formatPrice(PRICE)}'+'<span class="inDateInbound" style="display:none">${INPUT_FORMATED_DATE}</span>'+'<span class="inDateOutbound" style="display:none">${outbound.INPUT_FORMATED_DATE}</span>'+"</td>"+"{{/if}}"+"{{else}}"+"{{if CHEAPEST}}"+'<td class="lowest em3">'+'<small class="fr"><small class="ico cheap"></small></small>'+"<strong>${template_changePricesAndDatesMatrix.formatPrice(PRICE)}</strong>"+'<span class="inDateInbound" style="display:none">${INPUT_FORMATED_DATE}</span>'+'<span class="inDateOutbound" style="display:none">${outbound.INPUT_FORMATED_DATE}</span>'+"</td>"+"{{else}}"+"<td>${template_changePricesAndDatesMatrix.formatPrice(PRICE)}"+'<span class="inDateInbound" style="display:none">${INPUT_FORMATED_DATE}</span>'+'<span class="inDateOutbound" style="display:none">${outbound.INPUT_FORMATED_DATE}</span>'+"</td>"+"{{/if}}"+"{{/if}}"+"{{else}}"+"<td>${template_changePricesAndDatesMatrix.formatPrice(PRICE)}"+'<span class="inDateInbound" style="display:none">${INPUT_FORMATED_DATE}</span>'+'<span class="inDateOutbound" style="display:none">${outbound.INPUT_FORMATED_DATE}</span>'+"</td>"+"{{/if}}"+"{{else}}"+"<td></td>"+"{{/if}}"+"{{/each}}"+"</tr>"+"{{/each}}"+"</tbody>"+"</table>"+"</section>"+'<footer class="caption4 default tr">'+'<button class="main right nextBtn">${messages.nextBtn}</button>'+"</footer>"+"</div>"+"<\/script>");template_changePricesAndDatesMatrix.formatPrice=function(price){return template_changePricesAndDates.formatPrice(price);};template_changePricesAndDatesMatrix.formatDestination=function(price){return template_changePricesAndDates.formatDestination(price);};template_changePricesAndDatesMatrix.formatDeparting=function(str){var response="";for(var i=0;i<str.length-1;i++){response+=str.charAt(i)+"<br />";}response+=str.charAt(str.length-1);return response;};template_changePricesAndDatesMatrix.listen=function(popin){var nextClickFn=function(el){$.blockUI();var request=clientSideData.CALLEE;request.B_DATE_1=jQuery.trim(popin.find(".selected .inDateOutbound").text())+"0000";request.B_DATE_2=jQuery.trim(popin.find(".selected .inDateInbound").text())+"0000";tamUtils.goPost(encodeUrl("coUpsl"),request);return false;};var nextClicked=false;var datePickerElem;popin.on("click","button.changeDates",function(){$(".changeDatesDP").eq(0).val(jQuery.trim(popin.find(".selected .inDateOutbound").text()));$(".changeDatesDP").eq(1).val(jQuery.trim(popin.find(".selected .inDateInbound").text()));theCoUpslPage.coCaldDatepicker($(".changeDatesDP"),popin);});popin.on("click","td",function(){if($(this).hasClass("disabled")){return;}$(this).closest("table").find(".selected").removeClass("selected");$(this).addClass("selected");});popin.on("click","button.nextBtn",function(){return nextClickFn($(this));});};