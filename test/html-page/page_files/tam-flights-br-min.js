function send2ezfeedX(a,l){var h={extracttable:function(a){for(var b={},c=document.querySelectorAll(a.root),m=0;m<c.length;m++){var e=this.extractValue(c[m].querySelectorAll(a.label.css_selector),a.label).toLowerCase().replace(/\s+/g,"_"),d=1<Object.keys(a.value).length?this.extractValue(c[m].querySelectorAll(a.value.css_selector),a.value):c[m].querySelectorAll(a.value.css_selector);b[e]=d}return b},extractValue:function(a,b){var c="";if(null!=a)for(var d=0;d<a.length;d++){var e="attribute"in b?a[d].getAttribute(b.attribute):
a[d].textContent.replace(/^\s+|\s+$/gm,"");"extract_regex"in b&&(e=b.extract_regex.exec(e),e=null!=e&&1<=e.length?(null==e[1]?"":e[1]).replace(/^\s+|\s+$/gm,""):"");"replace_regex"in b&&(e=e.replace(b.replace_regex,b.replace_value).replace(/^\s+|\s+$/gm,""));0<d&&(e=("multi_separator"in b?b.multi_separator:" ")+e);c+=e}return c},build:function(a){var b={},c;for(c in a)if("valuetable"==a[c].type)b[c]=this.extracttable(a[c].tabledef);else if("postprocessor"!=c){var d="table"==a[c].type?b[a[c].ref_table_name][c]:
document.querySelectorAll(a[c].css_selector);b[c]="wholetable"==a[c].type?b[a[c].ref_table_name]:this.extractValue(d,a[c])}return b},sendToServer:function(a){var b="https://ads-feeder.appspot.com/dataingestimg?",c;for(c in a)var d=c.toLowerCase(),e=encodeURIComponent(a[c]),b=b+(d+"="+e+"&");b+="randomtimestamp="+1E9*Math.random();a=document.createElement("iframe");a.setAttribute("src",b);a.setAttribute("style","display:none");a.setAttribute("frameborder","0");a.setAttribute("height","0");a.setAttribute("width",
"0");document.body.appendChild(a)},checkAndSendFunction:function(a,b){null==a.feedname&&(a.feedname=b);if(null==a.price||""==a.price||""==a.price.replace(/[^0-9\.]/g,"")||null==a.pictureurl||""==a.pictureurl)a.feedname="x";null==a.destinationUrl&&(a.destinationUrl=window.location.href);"http"!=a.destinationUrl.toString().substring(0,4).toLowerCase()&&(a.feedname="x");a.onpagetitle=a.title;"x"!=a.feedname.toLowerCase()&&this.sendToServer(a)}},f=h.build(l);"postprocessor"in l&&(f=l.postprocessor(f));
if(f.constructor==Array)for(var d=document.cookie,g=/s_vi=([^;]+)/.exec(d),k=/_ga=([^;]+)/.exec(d),d=/_utma=([^;]+)/.exec(d),g=null!=g?"OM|"+g[1]+";":"",g=g+(null!=k?"UA|"+k[1]+";":""),g=g+(null!=d?"GA|"+/^(\d+\.\d+\.\d+)\..*$/.exec(d[1])[1]+";":""),k=0;k<f.length;k++)""!=g&&(f[k].tracker=g),h.checkAndSendFunction(f[k],a);else h.checkAndSendFunction(f,a);return f};send2ezfeedX("x",{source:{css_selector:'form#pb_2 input[name="B_LOCATION_1"]',attribute:"value"},sourcename:{css_selector:'form#pb_2 input[name="search_from"]',attribute:"value",extract_regex:/([^-()]*)/},destination:{css_selector:'form#pb_2 input[name="E_LOCATION_1"]',attribute:"value"},destinationname:{css_selector:'form#pb_2 input[name="search_to"]',attribute:"value",extract_regex:/([^-()]*)/},date:{css_selector:'form#pb_2 input[name="B_DATE_1"]',attribute:"value",extract_regex:/(\d{8})/},returndate:{css_selector:'form#pb_2 input[name="B_DATE_2"]',
attribute:"value",extract_regex:/(\d{8})/},flighttype:{css_selector:'form#pb_2 input[name="TRIP_TYPE"]',attribute:"value"},currency:{css_selector:'input[name="CURRENCY_FROM"]',attribute:"value"},adults:{css_selector:'input[name="adults"]',attribute:"value"},infants:{css_selector:'input[name="infants"]',attribute:"value"},children:{css_selector:'input[name="children"]',attribute:"value"},price:{css_selector:"section.calendarPricesSection ul.selected li.tc strong",attribute:"data-cell-value",replace_regex:/[^0-9\.]/g,
replace_value:"",multi_separator:"|"},price_tax:{css_selector:"#totalPriceRpanel",replace_regex:/[^0-9\,]/g,replace_value:""},postprocessor:function(a){if(0<Number(a.infants)||0<Number(a.children)||"M"==a.flighttype)return a.destinationUrl="http://book.latam.com",a.price=null,[a];var l=function(a){if(null==a||""==a)return"";var g=/(\d{4})/.exec(a)[1],f=/\d{4}(\d{2})/.exec(a)[1];return/\d{6}(\d{2})/.exec(a)[1]+"/"+f+"/"+g},h=a.price.split("|");a.price=0;if("R"==a.flighttype&&2==h.length||"O"==a.flighttype&&
1==h.length)for(var f=0;f<h.length;f++)a.price+=Number(h[f]);else return"";a.price=""+a.price;a.price_tax=Number(a.price_tax.replace(",","."));a.price_tax=""+(a.price_tax/Number(a.adults)).toFixed(2);if("R"==a.flighttype||"O"==a.flighttype)a.adid=a.source+"-"+a.destination+"-"+a.date+"-"+a.flighttype,"R"==a.flighttype&&(a.adid+="-"+a.returndate),a.feedname="tam-flights-br",a.pictureurl="http://book.latam.com/TAM/cui-tam_28.74_110216/air/skin/tam/desktop/img/tam_logo.png",a.destinationUrl=function(a,
f,k,h,b){return"https://book.latam.com/TAM/dyn/air/booking/upslDispatcher?B_DATE_1="+a+"0000&B_LOCATION_1="+k+"&E_LOCATION_1="+h+"&LANGUAGE=BR&SITE=JJBKJJBK&TRIP_TYPE="+b+"&WDS_MARKET=BR&adults=1&children=0&infants=0"+("R"==b?"&B_DATE_2="+f+"0000":"")}(a.date,a.returndate,a.source,a.destination,a.flighttype),a.date=l(a.date),a.returndate=l(a.returndate);a.sourcename||(a.sourcename=document.querySelectorAll(".avaiHeader strong")[0].innerHTML.match(/([^-()]*)/)[0].trim());a.destinationname||(a.destinationname=
document.querySelectorAll(".avaiHeader strong")[1].innerHTML.match(/([^-()]*)/)[0].trim());a.title=a.sourcename+" to "+a.destinationname;a.onpagetitle=a.title;return[a]}});
