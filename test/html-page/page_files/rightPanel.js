window.wdsResponsive=window.wdsResponsive||{};var rpModel={currencyCode:"",bounds:[{id:"0",ff:"TEST",segments:[],luggage:{},seatsInfo:{}}],totals:{}};function refreshRightPanel(model){refreshBounds(model);refreshUpsellTeaser(model);refreshTotals(model);setTaxPopin();}function setTaxPopin(){$(document).on("click","#taxBLink",function(){if($("#taxb").length>0){$("#taxb").dialog({autoOpen:true,draggable:false,width:640,modal:true,resizable:false,dialogClass:"responsive-dialog responsive-dialog-640"});}});$(document).on("click","#rd_atc_taxb_link",function(event){event.preventDefault();if($("#rd_atc_taxb").length>0){$("#rd_atc_taxb").dialog({autoOpen:true,draggable:false,width:640,modal:true,resizable:false,dialogClass:"responsive-dialog responsive-dialog-640"});}});}function refreshBounds(model){if(model!==null){for(var i=0;i<4;i++){if(typeof model.bounds[i]!=="undefined"){refreshBound(model,i);}}}}function prepareSeatsInterior(data,boundId,currencyCode,caption){if(data.seats==undefined){return;}var seatType=null;var seatsCount=0;var seatsLabel="";var tmplData={messages:{types:{"XL":clientMessages[clientSideData.PAGE_CODE+".text.ChargeableSeats.XLSeat"],"EXIT":clientMessages[clientSideData.PAGE_CODE+".text.ChargeableSeats.ExitSeat"]}},bound:boundId,enableDelete:data.popinCallback!=undefined?true:false,seats:[]};for(var i=0;i<data.seats.length;i++){seatsCount=data.seats[i].count;seatType=data.seats[i].type;seatsLabel=seatsCount==1?tmplData.messages.seat:tmplData.messages.seats;tmplData["seats"][i]={"count":seatsCount,"price":theUtils.formatPriceWithCurrency(data.seats[i].price,currencyCode),"typeLabel":tmplData.messages.types[seatType]};}if(caption!=undefined){tmplData["caption"]=caption;}var interiorTemplate=tamUtils.getElementForTmpls($("#template_seats").tmpl(tmplData));return interiorTemplate;}function prepareSeatsTemplateData(model,boundId){var captionMessages={messages:{addedSeats:"Added seats",confirmedSeats:"Confirmed seats"}};var resultTemplate=null;var data=model.bounds[boundId].seatsInfo;var confirmedTemplate=null;if((null!=data.confirmedSeat&&data.confirmedSeat!=undefined)||(null!=data.seats&&data.seats!=undefined)){var addedTemplate="";if(null!=data.seats&&data.seats!=undefined){addedTemplate=prepareSeatsInterior(data,boundId,model.currencyCode,captionMessages.messages.addedSeat);}var confirmedTemplate="";if(null!=data.confirmedSeat&&data.confirmedSeat!=undefined){confirmedTemplate=prepareSeatsInterior(data.confirmedSeat,boundId,model.currencyCode,captionMessages.messages.confirmedSeat);}resultTemplate=tamUtils.getElementForTmpls($("#template_servicing_seats").tmpl({template_added_seats:addedTemplate,template_confirmed_seats:confirmedTemplate}));}else{var interiorTemplate=prepareSeatsInterior(data,boundId,model.currencyCode);if(null==interiorTemplate&&typeof interiorTemplate=="undefined"){return"";}resultTemplate=tamUtils.getElementForTmpls($("#template_standard_seats").tmpl({template_seats:interiorTemplate}));}return resultTemplate;}function prepareLuggageInterior(data,boundId,currencyCode,caption){var tmplData={messages:{hideAllDetails:clientMessages["RPANEL.text.HideAllDetails"],showDetails:clientMessages["RPANEL.text.ShowAllDetails"]},bound:boundId};tmplData["luggage"]={count:0};if(data.count>0){tmplData["luggage"]={count:data.count,price:theUtils.formatPriceWithCurrency(data.price,currencyCode),passengers:data.passengers,enableDelete:(null!=data.popinCallback&&data.popinCallback!=undefined)?true:false};if(null!=caption&&caption!=undefined){tmplData.luggage["caption"]=caption;}}return tamUtils.getElementForTmpls($("#template_luggage").tmpl(tmplData));}function prepareLuggageTemplateData(model,boundId){var resultTemplate=null;var data=model.bounds[boundId].luggage;if((null!=data.addedLuggage&&data.addedLuggage!=undefined)||(null!=data.confirmedLuggage&&data.confirmedLuggage!=undefined)){var addedTemplate="";if(null!=data.addedLuggage&&data.addedLuggage!=undefined){data.addedLuggage.passengers.sort(function(a,b){return a.elementNr-b.elementNr;});addedTemplate=prepareLuggageInterior(model.bounds[boundId].luggage.addedLuggage,boundId,model.currencyCode,"ADDED");}var confirmedTemplate="";if(null!=data.confirmedLuggage&&data.confirmedLuggage!=undefined){data.confirmedLuggage.passengers.sort(function(a,b){return a.elementNr-b.elementNr;});confirmedTemplate=prepareLuggageInterior(model.bounds[boundId].luggage.confirmedLuggage,boundId,model.currencyCode,"CONFIRMED");}resultTemplate=tamUtils.getElementForTmpls($("#template_servicing_luggage").tmpl({template_added_luggage:addedTemplate,template_confirmed_luggage:confirmedTemplate}));}else{var interiorTemplate=prepareLuggageInterior(data,boundId,model.currencyCode,"ADDED");resultTemplate=tamUtils.getElementForTmpls($("#template_standard_luggage").tmpl({template_luggage:interiorTemplate}));}return resultTemplate;}function updateLuggageEvents(elem,tmplData,params){var tmplData={messages:{hideAllDetails:clientMessages["RPANEL.text.HideAllDetails"],showDetails:clientMessages["RPANEL.text.ShowAllDetails"]}};var trashElem=elem.find(".deleteLuggage");var detailsSwitch=elem.find(".toggleLuggageDetails");trashElem.bind("click");if(typeof params.luggage.popinCallback!="undefined"){trashElem.click({boundId:params.boundId,itemId:params.itemId},params.luggage.popinCallback);}else{if(params.luggage.addedLuggage!=null&&typeof params.luggage.addedLuggage!=="undefined"&&typeof params.luggage.addedLuggage.popinCallback!="undefined"){trashElem.click({boundId:params.boundId,itemId:params.itemId},params.luggage.addedLuggage.popinCallback);}}detailsSwitch.data("detailsShown",true);detailsSwitch.bind("click",function(){if(detailsSwitch.data("detailsShown")){detailsSwitch.data("detailsShown",false);$(this).find("strong").html(tmplData.messages.showDetails);elem.find("dl.luggageDetails").hide();}else{detailsSwitch.data("detailsShown",true);$(this).find("strong").html(tmplData.messages.hideAllDetails);elem.find("dl.luggageDetails").show();}});}function updateSeatsEvents(elem,params){var trashElem=elem.find(".deleteSeats");trashElem.bind("click");trashElem.click({boundId:params.boundId,itemId:params.itemId},params.seatsInfo.popinCallback);}function showBoundAsUncombinable(boundId){var bounds=[$("aside.main section#bound"+boundId+"NoDetails"),$("aside.main section#bound"+boundId+"WithDetails")];for(var key in bounds){if(bounds.hasOwnProperty(key)){bounds[key].find("div.wrap:not(:first)").remove();bounds[key].find("div.fr").html("").append($("<p>"+clientMessages["RPANEL.text.SummaryPanel.SelectFlight"]+"</p>"));}}}function refreshBound(model,boundId){if(model!==null){var params=model.bounds[boundId];var noDetailsElem=$("aside.main section#bound"+boundId+"NoDetails");var withDetailsElem=$("aside.main section#bound"+boundId+"WithDetails");var luggageTmplData=null;var seatsTmplData=null;var fsrsXbagEnabled=clientSideData.FSRS_ONLY==null||clientSideData.FSRS_ONLY==""||clientSideData.FSRS_ONLY=="XBAG";var fsrsSeatEnabled=clientSideData.FSRS_ONLY==null||clientSideData.FSRS_ONLY==""||clientSideData.FSRS_ONLY=="SEAT";if(null!=params.luggage&&params.luggage!=undefined&&!clientSideData.FLOW_STATE.IS_REBOOKING_REDEMPTION&&fsrsXbagEnabled){luggageTmplData=prepareLuggageTemplateData(model,boundId);}if(null!=params.seatsInfo&&params.seatsInfo!=undefined&&fsrsSeatEnabled){seatsTmplData=prepareSeatsTemplateData(model,boundId);}var date=new Date(params.segments[0].date);var departureSegment=params.segments[0];var arrivalSegment=params.segments[params.segments.length-1];var departureDate=new Date(departureSegment.from.date);var arrivalDate=new Date(arrivalSegment.to.date);var departureAirport=typeof clientSideData.LOCATIONS_TRANSLATION[departureSegment.from.airportCode]!=="undefined"?clientSideData.LOCATIONS_TRANSLATION[departureSegment.from.airportCode].airport:missingLocationFallback(boundId,"LOCATION_NAME","B_LOCATION",departureSegment.from.airportCode);var departureCity=typeof clientSideData.LOCATIONS_TRANSLATION[departureSegment.from.airportCode]!=="undefined"?clientSideData.LOCATIONS_TRANSLATION[departureSegment.from.airportCode].city:missingLocationFallback(boundId,"CITY_NAME","B_LOCATION",departureSegment.from.airportCodee);var arrivalAirport=typeof clientSideData.LOCATIONS_TRANSLATION[arrivalSegment.to.airportCode]!=="undefined"?clientSideData.LOCATIONS_TRANSLATION[arrivalSegment.to.airportCode].airport:missingLocationFallback(boundId,"LOCATION_NAME","E_LOCATION",arrivalSegment.to.airportCode);var arrivalCity=typeof clientSideData.LOCATIONS_TRANSLATION[arrivalSegment.to.airportCode]!=="undefined"?clientSideData.LOCATIONS_TRANSLATION[arrivalSegment.to.airportCode].city:missingLocationFallback(boundId,"CITY_NAME","E_LOCATION",arrivalSegment.to.airportCode);var totalDuration=0;if(clientSideData.PAGE_CODE=="ATC_UPSL"){$.each(params.segments,function(index){if(null!=this.duration&&this.duration!=undefined){totalDuration=totalDuration+this.duration;if(params.segments.length>0&&index>0){var nextDepartureTime=params.segments[index].from.date;var arrivalTime=params.segments[index-1].to.date;totalDuration+=nextDepartureTime-arrivalTime;}}});}var nbStops=0,nextDay=0;$.each(params.segments,function(index){nbStops+=this.numberOfStops;nextDay+=params.segments[index].nextDay;});var noDetailsTmplData={bound:params.id,dayOfTheWeek:dateFormat(date,clientMessages["ALLP.pattern.DateFormat.Day3Chars"]),dayOfTheMonth:dateFormat(date,clientMessages["ALLP.pattern.DateFormat.DayNumber"]),month:dateFormat(date,clientMessages["ALLP.pattern.DateFormat.Month3Chars"]).toUpperCase(),totalDuration:theUtils.calculateDurationOver24hours(parseInt(totalDuration)),connections:params.segments.length-1,numberOfStops:nbStops,nextDay:nextDay,locations:[{location:departureCity+", "+departureAirport,time:dateFormat(departureDate,clientMessages["ALLP.pattern.DateFormat.DurationShort"])},{location:arrivalCity+", "+arrivalAirport,time:dateFormat(arrivalDate,clientMessages["ALLP.pattern.DateFormat.DurationShort"])}]};if(luggageTmplData!=null){noDetailsTmplData["luggage_html"]=luggageTmplData;}if(seatsTmplData!=null){noDetailsTmplData["seats_html"]=seatsTmplData;}if(null!=params.ff&&params.ff!=undefined){noDetailsTmplData["ff"]=params.ff;}if(null!=params.totalDuration&&params.totalDuration!=undefined&&clientSideData["PAGE_CODE"]!="AVAI"){noDetailsTmplData["totalDuration"]=theUtils.calculateDurationOver24hours(parseInt(params.totalDuration));noDetailsTmplData["flyDuration"]=theUtils.calculateDurationOver24hours(this.calculateFlyTime(params.segments));}if(clientSideData["PAGE_CODE"]=="AVAI"){noDetailsTmplData["totalDuration"]=theUtils.calculateDurationOver24hours($("td.selected").nextAll(".durationTh").data("cellValue"));}if(null!=params.ffCode&&params.ffCode!=undefined){noDetailsTmplData["ffCode"]=params.ffCode;}var dayFrom=dateFormat(departureDate,clientMessages["ALLP.pattern.DateFormat.DayNumber"]);var dayTo=dateFormat(arrivalDate,clientMessages["ALLP.pattern.DateFormat.DayNumber"]);if(dayFrom!==dayTo){noDetailsTmplData["arrivalDate"]=dateFormat(arrivalDate,clientMessages["ALLP.pattern.DateFormat.ShortDateWithoutYear"]);}var flightSummaryNoDetailsHtml=tamUtils.getElementForTmpls($("#template_flightSummaryNoDetails").tmpl(noDetailsTmplData));if($("aside.main section#bound"+boundId+"NoDetails").length){$("aside.main section#bound"+boundId+"NoDetails").html(flightSummaryNoDetailsHtml);$("aside.main .bound"+boundId+"NoDetailsClass").show();}else{$("#sticky-bottom-box section#bound"+boundId+"NoDetails").html(flightSummaryNoDetailsHtml);$("#sticky-bottom-box section.bound"+boundId+"NoDetailsClass").show();if(noDetailsElem.length==0){noDetailsElem=$("#sticky-bottom-box section#bound"+boundId+"NoDetails");}}if(null!=params.luggage&&params.luggage!=undefined){updateLuggageEvents(noDetailsElem,noDetailsTmplData,params);}if(null!=params.seatsInfo&&params.seatsInfo!=undefined){updateSeatsEvents(noDetailsElem,params);}var withDetailsTmplData={duration:0,totalDuration:null,segments:[]};if(null!=params.totalDuration&&params.totalDuration!=undefined&&clientSideData["PAGE_CODE"]!="AVAI"){withDetailsTmplData["totalDuration"]=theUtils.calculateDurationOver24hours(parseInt(params.totalDuration));withDetailsTmplData["flyDuration"]=theUtils.calculateDurationOver24hours(self.calculateFlyTime(params.segments));}if(clientSideData["PAGE_CODE"]=="AVAI"){withDetailsTmplData["totalDuration"]=theUtils.calculateDurationOver24hours($("td.selected").nextAll(".durationTh").data("cellValue"));}$.each(params.segments,function(i,segment){var departureDate=new Date(segment.from.date);var arrivalDate=new Date(segment.to.date);var departureAirport=typeof clientSideData.LOCATIONS_TRANSLATION[segment.from.airportCode]!=="undefined"?clientSideData.LOCATIONS_TRANSLATION[segment.from.airportCode].airport:missingLocationFallback(boundId,"LOCATION_NAME","B_LOCATION",segment.from.airportCode);var departureCity=typeof clientSideData.LOCATIONS_TRANSLATION[segment.from.airportCode]!=="undefined"?clientSideData.LOCATIONS_TRANSLATION[segment.from.airportCode].city:missingLocationFallback(boundId,"CITY_NAME","B_LOCATION",segment.from.airportCode);var arrivalAirport=typeof clientSideData.LOCATIONS_TRANSLATION[segment.to.airportCode]!=="undefined"?clientSideData.LOCATIONS_TRANSLATION[segment.to.airportCode].airport:missingLocationFallback(boundId,"LOCATION_NAME","E_LOCATION",segment.to.airportCode);var arrivalCity=typeof clientSideData.LOCATIONS_TRANSLATION[segment.to.airportCode]!=="undefined"?clientSideData.LOCATIONS_TRANSLATION[segment.to.airportCode].city:missingLocationFallback(boundId,"CITY_NAME","E_LOCATION",segment.to.airportCode);var dayFrom=dateFormat(departureDate,clientMessages["ALLP.pattern.DateFormat.DayNumber"]);var dayTo=dateFormat(arrivalDate,clientMessages["ALLP.pattern.DateFormat.DayNumber"]);var differentDay=undefined;if(dayFrom!==dayTo){differentDay=dateFormat(arrivalDate,clientMessages["ALLP.pattern.DateFormat.ShortDateWithoutYear"]);}withDetailsTmplData.segments[i]={dayOfTheWeek:dateFormat(segment.from.date,clientMessages["ALLP.pattern.DateFormat.Day3Chars"]),dayOfTheMonth:dateFormat(segment.from.date,clientMessages["ALLP.pattern.DateFormat.DayNumber"]),month:dateFormat(segment.from.date,clientMessages["ALLP.pattern.DateFormat.Month3Chars"]).toUpperCase(),bTime:dateFormat(departureDate,clientMessages["ALLP.pattern.DateFormat.DurationShort"]),eTime:dateFormat(arrivalDate,clientMessages["ALLP.pattern.DateFormat.DurationShort"]),bLocation:departureCity+", "+departureAirport,eLocation:arrivalCity+", "+arrivalAirport,aircraft:segment.aircraft,arrivalDate:differentDay,nextDay:segment.nextDay};if(null!=params.ff&&params.ff!=undefined&&(i==params.segments.length-1)){withDetailsTmplData.segments[i]["ff"]=params.ff;}if(null!=params.ffCode&&params.ffCode!=undefined&&(i==params.segments.length-1)){withDetailsTmplData.segments[i]["ffCode"]=params.ffCode;}if(luggageTmplData!=null){withDetailsTmplData["luggage_html"]=luggageTmplData;}if(seatsTmplData!=null){withDetailsTmplData["seats_html"]=seatsTmplData;}if(null!=segment.flightNumber&&segment.flightNumber!=undefined){if(null!=segment.operatedBy&&segment.operatedBy!=undefined){if(segment.operatedBy.indexOf("ONEWORLD_ALLIANCE")!=-1){withDetailsTmplData.segments[i]["operator"]="ONEWORLD";}else{if(segment.operatedBy.indexOf("JJ")!=-1){withDetailsTmplData.segments[i]["operator"]="TAM";}else{if(segment.operatedBy.indexOf("LA")!=-1){withDetailsTmplData.segments[i]["operator"]="LAN";}else{withDetailsTmplData.segments[i]["operator"]="OTHER";}}}withDetailsTmplData.segments[i]["flightNumber"]=segment.flightNumber;}}if(segment.operatedBy!=undefined&&segment.operatedByAirlineName!=undefined&&segment.operatedBy.indexOf("JJ")==-1){withDetailsTmplData.segments[i]["operatedByAirlineName"]=segment.operatedByAirlineName;}if(segment.anacLink){withDetailsTmplData.segments[i]["anacLink"]=segment.anacLink;}if(segment.ontimePerformance){withDetailsTmplData.segments[i]["ontimePerformance"]=segment.ontimePerformance;}if(segment.baggageAllowance&&segment.baggageAllowance.indexOf("0")!==0){withDetailsTmplData.segments[i]["baggageAllowance"]=segment.baggageAllowance;}if(segment.baggageAllowanceLink){withDetailsTmplData.segments[i]["baggageAllowanceLink"]=segment.baggageAllowanceLink;}if(segment.airlineCompany){withDetailsTmplData.segments[i]["airlineCompany"]=segment.airlineCompany;}if(segment.cabin!=undefined){withDetailsTmplData.segments[i]["cabin"]=segment.cabin;}if(segment.duration!=undefined){var dur=new Date();dur=new Date(segment.duration);withDetailsTmplData.segments[i]["duration"]=dur.getUTCHours()+"h&nbsp;"+dateFormat(dur,"MM")+"m";}if(params.segments.length>i+1){nextDepartureTime=params.segments[i+1].from.date;var arrivalTime=params.segments[i].to.date;connectionDuration=new Date(new Date(nextDepartureTime)-new Date(arrivalTime));var landingDay=dateFormat(new Date(arrivalTime),clientMessages["ALLP.pattern.DateFormat.Day3Chars"]);var takeoffDay=dateFormat(new Date(nextDepartureTime),clientMessages["ALLP.pattern.DateFormat.Day3Chars"]);var dateToDisplay=null;if(takeoffDay!=landingDay){dateToDisplay=dateFormat(nextDepartureTime,clientMessages["ALLP.pattern.DateFormat.ShortDateWithoutYear"]);}withDetailsTmplData.segments[i]["connection"]={duration:connectionDuration.getUTCHours()+"h&nbsp;"+dateFormat(connectionDuration,"MM")+"m",location:arrivalCity+", "+arrivalAirport,date:dateToDisplay};}withDetailsTmplData.duration+=segment.duration;});var finalDuration=params.duration!=undefined?new Date(params.duration):new Date(!isNaN(withDetailsTmplData.duration)?withDetailsTmplData.duration:0);withDetailsTmplData.duration=finalDuration.getUTCHours()+"h&nbsp;"+dateFormat(finalDuration,"MM")+"m";if(params.duration==null){withDetailsTmplData.duration=null;}$("aside.main section#bound"+boundId+"WithDetails").html($("#template_flightSummaryWithDetails").tmpl(withDetailsTmplData));var flightSummaryWithDetailsHtml=tamUtils.getElementForTmpls($("#template_flightSummaryWithDetails").tmpl(withDetailsTmplData));if($("aside.main section#bound"+boundId+"WithDetails").length){$("aside.main section#bound"+boundId+"WithDetails").html(flightSummaryWithDetailsHtml);}else{$("#sticky-bottom-box section#bound"+boundId+"WithDetails").html(flightSummaryWithDetailsHtml);if(withDetailsElem.length==0){withDetailsElem=$("#sticky-bottom-box section#bound"+boundId+"WithDetails");}}if(params.luggage!=undefined){updateLuggageEvents(withDetailsElem,withDetailsTmplData,params);}if(params.seatsInfo!=undefined){updateSeatsEvents(withDetailsElem,params);}$("#flightSummaryInterstice").hide();$("#flightSummaryArticle").show();}}var noRpTeaser=false;function refreshUpsellTeaser(model){if(model===null){return;}if(noRpTeaser){return;}var elem=$("aside.main section#rpTeaser");if(model["upsellTeaser"]!=undefined){var data=model.upsellTeaser;elem.hide();elem.removeClass();var tmplData=[{amount:theUtils.formatPriceWithCurrency(Math.abs(data.diff),data.currencyCode),fare_family:data.ff}];elem.addClass("teaser hr family "+(data.ff==undefined?"f4":("ff-"+data.ffCode)));var renderedTemplate=$("#template_upsellTeaser").tmpl(tmplData);elem.html(renderedTemplate);elem.parent().off("click","#rpUpgrade");elem.parent().on("click","#rpUpgrade",function(){data.upgradeCallback();elem.hide();});elem.find("#rpThankYou").click(function(event){event.preventDefault();noRpTeaser=true;elem.hide();});if(data.diff>0){elem.find(".positive").removeClass("none");}else{elem.find(".negative").removeClass("none");}elem.show();}else{elem.hide();}}function addPaxTotalToTmplData(paxName,totals,currencyCode,tmplData,summed){var redemptionFlow=typeof totals["redemption"]!=="undefined"&&totals["redemption"]==true;var extraPriceDiscounted=0;if(paxName=="adults"&&totals.discount!=undefined){if($(totals.discount).size()==1){if(totals.discount.type==="D"){extraPriceDiscounted=totals.discount.amount;}}else{if($(totals.discount).size()==2){if(totals.discount.amount[0]!=0&&totals.discount.amount[1]!=0){if(totals.discount.type[0]==="D"&&totals.discount.type[1]==="D"){extraPriceDiscounted=totals.discount.amount[0]+totals.discount.amount[1];}if(totals.discount.type[0]==="D"&&totals.discount.type[1]==="P"){extraPriceDiscounted=totals.discount.amount[0]+totals.discount.price[1]*(totals.discount.amount[1]/100);}if(totals.discount.type[0]==="P"&&totals.discount.type[1]==="D"){extraPriceDiscounted=totals.discount.price[0]*(totals.discount.amount[0]/100)+totals.discount.amount[1];}if(totals.discount.type[0]==="P"&&totals.discount.type[1]==="P"&&totals.discount.amount[0]!==totals.discount.amount[1]){extraPriceDiscounted=totals.discount.price[0]*(totals.discount.amount[0]/100)+totals.discount.price[1]*(totals.discount.amount[1]/100);}}else{if(totals.discount.amount[0]!=0&&totals.discount.amount[1]==0){if(totals.discount.type[0]==="D"){extraPriceDiscounted=totals.discount.amount[0];}}else{if(totals.discount.amount[0]==0&&totals.discount.amount[1]!=0){if(totals.discount.type[1]==="D"){extraPriceDiscounted=totals.discount.amount[1];}}}}}}}if(totals[paxName]!=undefined){var count=totals[paxName]["count"];if((count>0&&totals.discount==undefined)||(count>0&&clientSideData["CALLEE"]!=null&&clientSideData.CALLEE["CORPORATE_CODE_INPUT"]!=null&&clientSideData.CALLEE.CORPORATE_CODE_INPUT!=="")){if(totals[paxName].price!=undefined){if(clientSideData.PAGE_CODE=="UPSL"||clientSideData.PAGE_CODE=="RD_UPSL"||(clientSideData.IS_COMPANION_FLOW!=undefined&&clientSideData.IS_COMPANION_FLOW)){var price=totals[paxName].price.withoutTax;}else{var price=count*totals[paxName].price.withoutTax;}if(extraPriceDiscounted!=0){if((clientSideData.IS_COMPANION_FLOW!=undefined&&clientSideData.IS_COMPANION_FLOW)){price+=extraPriceDiscounted;}else{price+=count*extraPriceDiscounted;}}tmplData[paxName]={"count":count,"total":redemptionFlow?theUtils.formatPriceWithCurrency(price,"Points"):theUtils.formatPriceWithCurrency(price,currencyCode),"raw_total":price};if(clientSideData.PAGE_CODE=="UPSL"||clientSideData.PAGE_CODE=="RD_UPSL"||(clientSideData.IS_COMPANION_FLOW!=undefined&&clientSideData.IS_COMPANION_FLOW)){summed.withoutTax+=(totals[paxName].price.withoutTax);summed.taxes+=totals[paxName].price.tax;}else{summed.withoutTax+=count*(totals[paxName].price.withoutTax);summed.taxes+=count*totals[paxName].price.tax;}summed.priceReset=false;}else{tmplData[paxName]={"count":count,"total":"-","raw_total":0};}}else{if(totals[paxName].price!=undefined){var price=count*totals[paxName].price.withoutTax;if(clientSideData.PAGE_CODE=="UPSL"||clientSideData.PAGE_CODE=="RD_UPSL"||(clientSideData.IS_COMPANION_FLOW!=undefined&&clientSideData.IS_COMPANION_FLOW)){price=totals[paxName].price.withoutTax;}tmplData[paxName]={"count":count,"total":redemptionFlow?theUtils.formatPriceWithCurrency(price,"Points"):theUtils.formatPriceWithCurrency(price,currencyCode),"raw_total":price};if(clientSideData.PAGE_CODE=="UPSL"||clientSideData.PAGE_CODE=="RD_UPSL"||(clientSideData.IS_COMPANION_FLOW!=undefined&&clientSideData.IS_COMPANION_FLOW)){summed.withoutTax+=(totals[paxName].price.withoutTax);summed.taxes+=totals[paxName].price.tax;}else{summed.withoutTax+=price;summed.taxes+=count*totals[paxName].price.tax;}summed.priceReset=false;}else{tmplData[paxName]={"count":count,"total":"-","raw_total":price};}}}}function renderDetailedTotals(totals,currencyCode,withSummary,summaryNegative,priceType){if($("input[name='tttDecision']:checked:enabled").val()=="false"){var clonedTotals=jQuery.extend({},totals);clonedTotals.timeToThinkPrice=null;totals=clonedTotals;}var redemptionFlow=typeof totals!=="undefined"&&null!=totals&&totals["redemption"]!=="undefined"&&null!=totals["redemption"]&&totals["redemption"]==true;var detailsTmplData={};var resultTemplate;var confirmedTotal=0;summed={taxes:0,withoutTax:0,grandTotal:0,priceReset:true};if(null!=totals.cma&&totals.cma!=undefined&&null!=totals.cmp&&totals.cmp!=undefined){addPaxTotalToTmplData("cma",totals,currencyCode,detailsTmplData,summed);addPaxTotalToTmplData("cmp",totals,currencyCode,detailsTmplData,summed);}else{addPaxTotalToTmplData("adults",totals,currencyCode,detailsTmplData,summed);addPaxTotalToTmplData("children",totals,currencyCode,detailsTmplData,summed);addPaxTotalToTmplData("infants",totals,currencyCode,detailsTmplData,summed);}if(redemptionFlow){summed.grandTotal=summed.taxes;summed.points=summed.withoutTax;}else{if(totals.timeToThinkPrice!=null&&!clientSideData.IS_TIME_TO_THINK_TEASER_ON_MOBILE_ALPI){summed.grandTotal=summed.withoutTax+totals.timeToThinkPrice+summed.taxes;}else{summed.grandTotal=summed.withoutTax+summed.taxes;}}if(!clientSideData.FLOW_STATE.IS_ATC&&totals.discount!=undefined&&null!=totals.discount){var numOfAdults=totals["adults"]["count"];if(undefined!==totals.discount.totalWithoutDiscount){if(totals.discount.type==="D"){detailsTmplData["discount"]={total:theUtils.formatPriceWithCurrency(-totals.discount.amount,redemptionFlow?"Points":currencyCode),label:totals.discount.whichBound.toLowerCase()};}else{if(totals.discount.type==="P"){detailsTmplData["discount"]={total:totals.discount.amount+"%",label:totals.discount.whichBound.toLowerCase()};}}if(!detailsTmplData["discount"].isPriceDiscrepancyPresent){detailsTmplData["adults"].totalWithoutDiscount=theUtils.formatPriceWithCurrency(totals.discount.totalWithoutDiscount,redemptionFlow?"Points":currencyCode);}else{detailsTmplData["adults"].totalWithoutDiscount=undefined;}}else{if(totals.discount.type.length==1){var amountOut=totals.discount.amount[0];var priceOut=totals.discount.price[0];var typeOut=totals.discount.type[0];var label="ow";if(amountOut!=0){if(typeOut==="D"){detailsTmplData["discount"]={total:theUtils.formatPriceWithCurrency((-numOfAdults*amountOut),redemptionFlow?"Points":currencyCode),label:label};if(clientSideData.PAGE_CODE!="UPSL"&&clientSideData.PAGE_CODE!="RD_UPSL"){summed.grandTotal+=(-numOfAdults*amountOut);}detailsTmplData["adults"].totalWithoutDiscount=theUtils.formatPriceWithCurrency(detailsTmplData["adults"]["raw_total"]+numOfAdults*amountOut,redemptionFlow?"Points":currencyCode);}else{if(typeOut==="P"){detailsTmplData["discount"]={total:amountOut+"%",label:label};detailsTmplData["adults"].totalWithoutDiscount=theUtils.formatPriceWithCurrency(detailsTmplData["adults"]["raw_total"]+numOfAdults*priceOut*amountOut*0.01/(1-amountOut*0.01),redemptionFlow?"Points":currencyCode);}}}}else{if(totals.discount.type.length==2){var amountOut=totals.discount.amount[0];var typeOut=totals.discount.type[0];var amountIn=totals.discount.amount[1];var typeIn=totals.discount.type[1];var priceOut=totals.discount.price[0];var priceIn=totals.discount.price[1];if(amountOut!=0&&amountIn!=0){var label="both_bounds";if(typeOut==="D"&&typeIn==="D"){detailsTmplData["discount"]={total:theUtils.formatPriceWithCurrency((-numOfAdults*(amountOut+amountIn)),redemptionFlow?"Points":currencyCode),label:label};if(clientSideData.PAGE_CODE!="UPSL"&&clientSideData.PAGE_CODE!="RD_UPSL"){summed.grandTotal+=(-numOfAdults*(amountOut+amountIn));}detailsTmplData["adults"].totalWithoutDiscount=theUtils.formatPriceWithCurrency(detailsTmplData["adults"]["raw_total"]+numOfAdults*(amountOut+amountIn),redemptionFlow?"Points":currencyCode);}else{if(typeOut==="P"&&typeIn==="P"){if(amountOut==amountIn){detailsTmplData["discount"]={total:amountOut+"%",label:label};detailsTmplData["adults"].totalWithoutDiscount=theUtils.formatPriceWithCurrency(detailsTmplData["adults"]["raw_total"]*100/(100-amountOut),redemptionFlow?"Points":currencyCode);}else{var amount=priceOut*amountOut*0.01/(1-amountOut*0.01)+priceIn*amountIn*0.01/(1-amountIn*0.01);detailsTmplData["discount"]={total:theUtils.formatPriceWithCurrency((-numOfAdults*amount),redemptionFlow?"Points":currencyCode),label:label};detailsTmplData["adults"].totalWithoutDiscount=theUtils.formatPriceWithCurrency(detailsTmplData["adults"]["raw_total"]+numOfAdults*amount,redemptionFlow?"Points":currencyCode);}}else{if(typeOut==="D"&&typeIn==="P"){var amount=amountOut+priceIn*amountIn*0.01/(1-amountIn*0.01);detailsTmplData["discount"]={total:theUtils.formatPriceWithCurrency((-numOfAdults*amount),redemptionFlow?"Points":currencyCode),label:label};detailsTmplData["adults"].totalWithoutDiscount=theUtils.formatPriceWithCurrency(detailsTmplData["adults"]["raw_total"]+numOfAdults*amount,redemptionFlow?"Points":currencyCode);}else{if(typeOut==="P"&&typeIn==="D"){var amount=priceOut*amountOut*0.01/(1-amountOut*0.01)+amountIn;detailsTmplData["discount"]={total:theUtils.formatPriceWithCurrency((-numOfAdults*amount),redemptionFlow?"Points":currencyCode),label:label};detailsTmplData["adults"].totalWithoutDiscount=theUtils.formatPriceWithCurrency(detailsTmplData["adults"]["raw_total"]+numOfAdults*amount,redemptionFlow?"Points":currencyCode);}}}}}else{if(amountOut!=0&&amountIn==0){var label="outbound";if(typeOut==="D"){detailsTmplData["discount"]={total:theUtils.formatPriceWithCurrency((-numOfAdults*amountOut),redemptionFlow?"Points":currencyCode),label:label};if(clientSideData.PAGE_CODE!="UPSL"&&clientSideData.PAGE_CODE!="RD_UPSL"){summed.grandTotal+=(-numOfAdults*amountOut);}detailsTmplData["adults"].totalWithoutDiscount=theUtils.formatPriceWithCurrency(detailsTmplData["adults"]["raw_total"]+numOfAdults*amountOut,redemptionFlow?"Points":currencyCode);}else{if(typeOut==="P"){detailsTmplData["discount"]={total:amountOut+"%",label:label};detailsTmplData["adults"].totalWithoutDiscount=theUtils.formatPriceWithCurrency(detailsTmplData["adults"]["raw_total"]+numOfAdults*priceOut*amountOut*0.01/(1-amountOut*0.01),redemptionFlow?"Points":currencyCode);}}}else{if(amountOut==0&&amountIn!=0){var label="inbound";if(typeIn==="D"){detailsTmplData["discount"]={total:theUtils.formatPriceWithCurrency((-numOfAdults*amountIn),redemptionFlow?"Points":currencyCode),label:label};if(clientSideData.PAGE_CODE!="UPSL"&&clientSideData.PAGE_CODE!="RD_UPSL"){summed.grandTotal+=(-numOfAdults*amountIn);}detailsTmplData["adults"].totalWithoutDiscount=theUtils.formatPriceWithCurrency(detailsTmplData["adults"]["raw_total"]+numOfAdults*amountIn,redemptionFlow?"Points":currencyCode);}else{if(typeIn==="P"){detailsTmplData["discount"]={total:amountIn+"%",label:label};detailsTmplData["adults"].totalWithoutDiscount=theUtils.formatPriceWithCurrency(detailsTmplData["adults"]["raw_total"]+numOfAdults*priceIn*amountIn*0.01/(1-amountIn*0.01),redemptionFlow?"Points":currencyCode);}}}}}}}}}if(null!=totals.flightOptions&&totals.flightOptions!=undefined){detailsTmplData["flightOptions"]={total:theUtils.formatPriceWithCurrency(totals.flightOptions.amount,currencyCode)};summed.grandTotal=summed.grandTotal+totals.flightOptions.amount;}else{var numberOfChildren=rpModel.totals.children?rpModel.totals.children.count:0;var numberOfPassengers=rpModel.totals.adults?rpModel.totals.adults.count+numberOfChildren:0;var total=0;var totalBought=0;var totalSeats=[];var totalLuggage=[[]];var totalLuggageBought=[[]];for(var i in rpModel.bounds){totalSeats.push(0);totalLuggage.push([]);totalLuggageBought.push([]);}var noNewItems=true;for(var i in rpModel.bounds){if(null!=rpModel.bounds[i].luggage&&rpModel.bounds[i].luggage!=undefined){if(null!=rpModel.bounds[i].luggage.confirmedLuggage&&typeof rpModel.bounds[i].luggage.confirmedLuggage!="undefined"){totalBought+=rpModel.bounds[i].luggage.confirmedLuggage.price;for(var k in rpModel.bounds[i].luggage.confirmedLuggage.passengers){var travellerId=rpModel.bounds[i].luggage.confirmedLuggage.passengers[k].travellerID;totalLuggageBought[i][travellerId]=rpModel.bounds[i].luggage.confirmedLuggage.passengers[k].price;}}if(null!=rpModel.bounds[i].luggage.addedLuggage&&typeof rpModel.bounds[i].luggage.addedLuggage!=="undefined"){noNewItems=false;total+=rpModel.bounds[i].luggage.addedLuggage.price;for(var k in rpModel.bounds[i].luggage.addedLuggage.passengers){var travellerId=rpModel.bounds[i].luggage.addedLuggage.passengers[k].travellerID;totalLuggage[i][travellerId]=rpModel.bounds[i].luggage.addedLuggage.passengers[k].price;}}else{if(null!=rpModel.bounds[i].luggage.price&&typeof rpModel.bounds[i].luggage.price!=="undefined"){total+=rpModel.bounds[i].luggage.price;for(var k in rpModel.bounds[i].luggage.passengers){var travellerId=rpModel.bounds[i].luggage.passengers[k].travellerID;totalLuggage[i][travellerId]=rpModel.bounds[i].luggage.passengers[k].price;}}}}if(null!=rpModel.bounds[i].seatsInfo&&rpModel.bounds[i].seatsInfo!=undefined){if(null!=rpModel.bounds[i].seatsInfo.confirmedSeat&&typeof rpModel.bounds[i].seatsInfo.confirmedSeat!="undefined"){for(var j in rpModel.bounds[i].seatsInfo.confirmedSeat.seats){totalBought+=rpModel.bounds[i].seatsInfo.confirmedSeat.seats[j].price;}}for(var j in rpModel.bounds[i].seatsInfo.seats){noNewItems=false;total+=rpModel.bounds[i].seatsInfo.seats[j].price;totalSeats[i]+=rpModel.bounds[i].seatsInfo.seats[j].price;}}}if(total>0){var amountToBePaid=0;for(var i in rpModel.bounds){for(var j=1;j<=numberOfPassengers;j++){if(totalLuggage[i][j]){var bought=totalLuggageBought[i][j]||0;if(clientSideData.USE_FIRST_BAG){amountToBePaid+=totalLuggage[i][j];}else{amountToBePaid+=totalLuggage[i][j]-bought;}}}if(totalSeats[i]>0){amountToBePaid+=totalSeats[i];}}if(!noNewItems||clientSideData.PAGE_CODE!="FSRS"){detailsTmplData["flightOptions"]={total:theUtils.formatPriceWithCurrency(amountToBePaid,currencyCode)};summed.grandTotal=summed.grandTotal+totalBought+amountToBePaid;}else{if(clientSideData.PAGE_CODE=="FSRS"){summed.grandTotal=summed.grandTotal+totalBought+amountToBePaid;}}}else{detailsTmplData["flightOptions"];summed.grandTotal=summed.grandTotal+totalBought;}}if(null!=totals.installments&&typeof totals.installments!="undefined"){detailsTmplData["installments"]={amount:theUtils.formatPriceWithCurrency(totals.installments.amount,currencyCode),link:totals.installments.link};summed.grandTotal=summed.grandTotal+parseFloat(totals.installments.amount);}if(null!=totals.insurance&&typeof totals.insurance!="undefined"){detailsTmplData["insurance"]={amount:theUtils.formatPriceWithCurrency(totals.insurance.amount,currencyCode)};summed.grandTotal=summed.grandTotal+parseFloat(totals.insurance.amount);}if(null!=totals.rebook&&typeof totals.rebook!="undefined"){var isAtcRevPage=clientSideData.PAGE_CODE=="ATC_UPSL"||clientSideData.PAGE_CODE=="ATCPURF"||clientSideData.PAGE_CODE=="ATC_APIS";var isAtcRedPage=clientSideData.PAGE_CODE=="RD_ATC_AVAI"||clientSideData.PAGE_CODE=="RD_ATC_PURF"||clientSideData.PAGE_CODE=="RD_ATC_APIS";if(totals.rebook.price>0||typeof totals.rebook.price==="undefined"){if(isAtcRevPage||isAtcRedPage){detailsTmplData["rebookingFee"]={amount:theUtils.formatPriceWithCurrency(totals.rebook.price,currencyCode),is_waived:false};}else{summed.taxes+=parseFloat(totals.rebook.price);}summed.grandTotal+=parseFloat(totals.rebook.price);}else{if(isAtcRevPage||isAtcRedPage){detailsTmplData["rebookingFee"]={amount:isAtcRevPage?clientMessages["ALLP.text.RebookingFeeWaived"]:theUtils.formatPriceWithCurrency(0,currencyCode),is_waived:isAtcRevPage};}}}if(!summed.priceReset){detailsTmplData["serviceFee"]={total:theUtils.formatPriceWithCurrency(summed.taxes,currencyCode)};if(totals.isRdAtc){var taxesSum=totals.detailsType=="new"?summed.taxes:-summed.taxes;detailsTmplData.totalTaxes={fmtAmount:theUtils.formatPriceWithCurrency(taxesSum,currencyCode),amount:taxesSum};}}if(withSummary){var summaryTotal=summed.grandTotal;if(summaryNegative){summaryTotal*=-1;}if(priceType!=""){detailsTmplData["detailsSummary"]={total:summed.priceReset?"-":theUtils.formatPriceWithCurrency(summaryTotal,currencyCode),colorClass:(summaryTotal<0)?"em3":"em",showId:priceType};}else{detailsTmplData["detailsSummary"]={total:summed.priceReset?"-":theUtils.formatPriceWithCurrency(summaryTotal,currencyCode),colorClass:(summaryTotal<0)?"em3":"em"};}}if(totals.taxLink){detailsTmplData["showTaxLink"]=true;}if(clientSideData.SHOW_TAXT&&(priceType==""||priceType=="newPrice")){detailsTmplData["showTaxTooltip"]=true;}if(totals.timeToThinkPrice!=null&&!clientSideData.IS_TIME_TO_THINK_TEASER_ON_MOBILE_ALPI){var numberOfAdults=rpModel.totals.adults?rpModel.totals.adults.count:0;var numberOfChildren=rpModel.totals.children?rpModel.totals.children.count:0;var numberOfInfants=rpModel.totals.infants?rpModel.totals.infants.count:0;var totalPassengers=numberOfAdults+numberOfChildren+numberOfInfants;detailsTmplData["totalNoOfPax"]=totalPassengers;if((clientSideData.PAGE_CODE!="PURF")||(clientSideData.PAGE_CODE=="PURF"&&clientSideData.TIME_TO_THINK_SOLUTION_DATA!=null)){detailsTmplData["timeToThinkPrice"]=theUtils.formatPriceWithCurrency((totals.timeToThinkPrice),currencyCode);}}if(totals.isRdAtc){var pointsSum=totals.detailsType=="new"?summed.points:-summed.points;detailsTmplData.totalPoints={fmtAmount:theUtils.formatPriceWithCurrency(pointsSum,"Points"),amount:pointsSum};resultTemplate=tamUtils.getElementForTmpls($("#template_rdAtcTotalsDetails").tmpl({dtData:detailsTmplData}));}else{detailsTmplData.isAtcRev=clientSideData.FLOW_STATE.IS_ATC;resultTemplate=tamUtils.getElementForTmpls($("#template_totalsDetails").tmpl({dtData:detailsTmplData}));}return{renderedTmpl:resultTemplate,info:summed};}function calculateLuggageAmount(model){var numberOfChildren=rpModel.totals.children?rpModel.totals.children.count:0;var numberOfPassengers=rpModel.totals.adults?rpModel.totals.adults.count+numberOfChildren:0;var total=0;var totalBought=0;var totalLuggage=[[]];var totalLuggageBought=[[]];for(var i in rpModel.bounds){totalLuggage.push([]);totalLuggageBought.push([]);}var noNewItems=true;for(var i in rpModel.bounds){if(null!=rpModel.bounds[i].luggage&&rpModel.bounds[i].luggage!=undefined){if(null!=rpModel.bounds[i].luggage.confirmedLuggage&&typeof rpModel.bounds[i].luggage.confirmedLuggage!="undefined"){totalBought+=rpModel.bounds[i].luggage.confirmedLuggage.price;for(var k in rpModel.bounds[i].luggage.confirmedLuggage.passengers){var travellerId=rpModel.bounds[i].luggage.confirmedLuggage.passengers[k].travellerID;totalLuggageBought[i][travellerId]=rpModel.bounds[i].luggage.confirmedLuggage.passengers[k].price;}}if(null!=rpModel.bounds[i].luggage.addedLuggage&&typeof rpModel.bounds[i].luggage.addedLuggage!=="undefined"){noNewItems=false;total+=rpModel.bounds[i].luggage.addedLuggage.price;for(var k in rpModel.bounds[i].luggage.addedLuggage.passengers){var travellerId=rpModel.bounds[i].luggage.addedLuggage.passengers[k].travellerID;totalLuggage[i][travellerId]=rpModel.bounds[i].luggage.addedLuggage.passengers[k].price;}}else{if(null!=rpModel.bounds[i].luggage.price&&typeof rpModel.bounds[i].luggage.price!=="undefined"){total+=rpModel.bounds[i].luggage.price;for(var k in rpModel.bounds[i].luggage.passengers){var travellerId=rpModel.bounds[i].luggage.passengers[k].travellerID;totalLuggage[i][travellerId]=rpModel.bounds[i].luggage.passengers[k].price;}}}}}if(total>0){var amountToBePaid=0;for(var i in rpModel.bounds){for(var j=1;j<=numberOfPassengers;j++){if(totalLuggage[i][j]){var bought=totalLuggageBought[i][j]||0;if(clientSideData.USE_FIRST_BAG){amountToBePaid+=totalLuggage[i][j];}else{amountToBePaid+=totalLuggage[i][j]-bought;}}}}if(amountToBePaid){return theUtils.formatPrice(amountToBePaid);}else{return"";}}}function refreshStandardTotals(model){var redemptionFlow=typeof model.totals["redemption"]!=="undefined"&&model.totals["redemption"]==true;var totalTmplData={};var detailedTotals=renderDetailedTotals(model.totals,model.currencyCode,undefined,undefined,"");if(model.totals.currencyConvertor&&clientSideData.PAGE_CODE!="RD_UPSL"){totalTmplData["currencyConverter_html"]=model.totals.currencyConvertor;}totalTmplData.totalsDetails_html=detailedTotals.renderedTmpl;if(redemptionFlow){totalTmplData["totalPoints"]=detailedTotals.info.priceReset?"-":theUtils.formatPoints(detailedTotals.info.points);totalTmplData["totalPointsAmount"]=detailedTotals.info.priceReset?"-":theUtils.formatPriceWithCurrency(detailedTotals.info.points,"Points");totalTmplData["totalPriceAmount"]=detailedTotals.info.priceReset?"-":theUtils.formatPriceWithCurrency(detailedTotals.info.grandTotal,model.currencyCode);}else{totalTmplData["totalAmount"]=detailedTotals.info.priceReset?"-":theUtils.formatPriceWithCurrency(detailedTotals.info.grandTotal,model.currencyCode);}if(redemptionFlow){$("#rightPanelToggle .header-toggle-price").text(totalTmplData["totalPoints"]);}else{if((clientSideData.PAGE_CODE!="PURF"&&!clientSideData.IS_TIME_TO_THINK_TEASER_ON_MOBILE_ALPI&&model.totals.timeToThinkPrice!=null)||(clientSideData.PAGE_CODE=="PURF"&&clientSideData.TIME_TO_THINK_SOLUTION_DATA!=null&&$("input[name='tttDecision']:checked:enabled").val()=="true")){$("#rightPanelToggle .header-toggle-price").text(theUtils.formatPriceWithCurrency((model.totals.timeToThinkPrice),model.currencyCode));}else{$("#rightPanelToggle .header-toggle-price").text(totalTmplData["totalAmount"]);}}$("#rightPanelToggle .toggle-arrow").show();var totalOpened=$("aside.main section#totalOpened");var totalClosed=$("aside.main #totalClosed");if(totalOpened.length>0){totalOpened.html($("#template_totalPricesPanel").tmpl(totalTmplData));}else{var totalOfflineOpened=$("aside.main section#totalOfflineOpened");if(totalOfflineOpened.length>0){delete totalTmplData["totalAmount"];delete totalTmplData["totalPriceAmount"];delete totalTmplData["totalPointsAmount"];delete totalTmplData["currencyConverter_html"];if($.trim(totalTmplData["totalsDetails_html"])!=""){totalOfflineOpened.prev().removeClass("none");totalOfflineOpened.removeClass("none");totalOfflineOpened.html($("#template_totalPricesPanel").tmpl(totalTmplData));}else{totalOfflineOpened.prev().addClass("none");totalOfflineOpened.addClass("none");}}}var timeToThinkTotalOpened=$("aside.main section#timeToThinkTotalOpened");if(timeToThinkTotalOpened.length>0){var timeToThinkDetailsTmplData={};if(model.totals.timeToThinkPrice!=null){timeToThinkDetailsTmplData["timeToThinkPrice"]=theUtils.formatPriceWithCurrency((model.totals.timeToThinkPrice),model.currencyCode);timeToThinkDetailsTmplData["remainingTotalAmount"]=detailedTotals.info.priceReset?"-":theUtils.formatPriceWithCurrency((detailedTotals.info.grandTotal-model.totals.timeToThinkPrice),model.currencyCode);var timeToThinkRenderedTemplate=tamUtils.getElementForTmpls($("#template_timeToThinkTotalPricesPanel").tmpl({dtTimeToThinkData:timeToThinkDetailsTmplData}));timeToThinkTotalOpened.html(timeToThinkRenderedTemplate);}}if(redemptionFlow){$("#totalClosed").html(theUtils.formatPriceWithCurrency(detailedTotals.info.points,"Points"));}else{if(null!=model.currencyCode&&typeof model.currencyCode!=="undefined"){$("#totalClosed").html(theUtils.formatPriceWithCurrency(detailedTotals.info.grandTotal,model.currencyCode));}else{$("#totalClosed").html("-");}}model.totals["grandTotal"]={amount:detailedTotals.info.grandTotal,points:detailedTotals.info.points};initCurrencyConverter(model);if(model.totals.taxLink){$("#dtData.taxLink").click(function(){$("#taxb").dialog({autoOpen:true,draggable:false,width:800,modal:true,resizable:false,dialogClass:"responsive-dialog responsive-dialog-800"});});$("#dtData.taxLink").addClass("toggle");$("#dtData.taxLink").addClass("plus");}initTaxToolTip();}function refreshAtcTotals(model){var totalsTmplData={newPriceDetails_html:null,originalPriceDetails_html:null};if(model.totals.currencyConvertor){totalsTmplData["currencyConverter_html"]=model.totals.currencyConvertor;}var newPriceDetails=renderDetailedTotals(model.totals.newPrice,model.currencyCode,true,false,"newPrice");var originalPriceDetails=renderDetailedTotals(model.totals.originalPrice,model.currencyCode,true,true,"originalPrice");totalsTmplData["newPriceDetails_html"]=newPriceDetails.renderedTmpl;if(((model.totals.originalPriceDataAvailable==true&&(clientSideData.IS_ONLINE_PNR==true||clientSideData.IS_ONLINE_PNR==undefined)))||clientSideData.PAGE_CODE!="ATC_UPSL"&&clientSideData.PAGE_CODE!="ATCPURF"){totalsTmplData["originalPriceDetails_html"]=originalPriceDetails.renderedTmpl;}else{totalsTmplData["originalPriceDetails_html"]='<dl class="wrap"><dt class="fl none">'+clientMessages["RPANEL.text.totalPayedATC"]+'</dt><dd class="tr none" id="totalPayed">'+theUtils.formatPriceWithCurrency(model.totals.originalTotalPrice,model.totals.originalCurrency)+"</dd></dl>";}totalsTmplData["totalToBePaid"]={amount:theUtils.formatPriceWithCurrency(model.totals.totalToBePaid,model.currencyCode),showId:"totalToBePaid"};totalsTmplData["totalRefunded"]={amount:theUtils.formatPriceWithCurrency(model.totals.totalRefunded,model.currencyCode),showId:"totalToBeRefunded"};var balance=model.totals.totalToBePaid-model.totals.totalRefunded;totalsTmplData["totalBalance"]={amount:theUtils.formatPriceWithCurrency(balance,model.currencyCode)};if(null!=model.totals["installments"]&&typeof model.totals["installments"]!="undefined"){totalsTmplData["installments"]={amount:theUtils.formatPriceWithCurrency(model.totals.installments.amount,model.currencyCode),link:model.totals.installments.link};}totalsTmplData["balanceNegative"]=balance<0;$("aside.main section#totalOpened").html($("#template_ATC_totals").tmpl(totalsTmplData));initTaxToolTip();$("#tooltipToBePaid").qtip({content:{text:"<p>"+clientMessages["RPANEL.text.AtcToBePaidTooltip"]+"</p>"},position:{my:"bottom center",at:"top center"}});$("#tooltipTotalRefund").qtip({content:{text:"<p>"+clientMessages["RPANEL.text.AtcTotalRefundTooltip"]+"</p>"},position:{my:"bottom center",at:"top center"}});if(isNaN(balance)){balance=undefined;}$("#totalClosed").html(theUtils.formatPriceWithCurrency(balance,model.currencyCode));model.totals["grandTotal"]={amount:balance};initCurrencyConverter(model);}function refreshRdAtcTotals(model){var totalsTmplData={newPriceDetails_html:null,originalPriceDetails_html:null};if(model.totals.currencyConvertor){totalsTmplData["currencyConverter_html"]=model.totals.currencyConvertor;}model.totals.newPrice["redemption"]=true;model.totals.newPrice["isRdAtc"]=true;model.totals.newPrice["detailsType"]="new";var newPriceDetails=renderDetailedTotals(model.totals.newPrice,model.currencyCode,true,false);model.totals.originalPrice["redemption"]=true;model.totals.originalPrice["isRdAtc"]=true;model.totals.newPrice["detailsType"]="orignal";var originalPriceDetails=renderDetailedTotals(model.totals.originalPrice,model.currencyCode,true,true);totalsTmplData["newPriceDetails_html"]=newPriceDetails.renderedTmpl;var hasOriginalPriceDetails=(null!=model.totals.originalPrice.adults.price&&model.totals.originalPrice.adults.price!="undefined")||(null!=model.totals.originalPrice.children.price&&model.totals.originalPrice.children.price!="undefined")||(null!=model.totals.originalPrice.infants.price&&model.totals.originalPrice.infants.price!="undefined");if(hasOriginalPriceDetails){totalsTmplData["originalPriceDetails_html"]=originalPriceDetails.renderedTmpl;}else{totalsTmplData["originalPriceDetails_html"]='<dt class="fl none">'+clientMessages["RPANEL.text.TotalBaseFare"]+'</dt><dd class="tr none">'+theUtils.formatPriceWithCurrency(model.totals.originalPrice.totalPriceMiles,"Points")+"</dd>";}totalsTmplData["totalToBePaidCash"]={amount:theUtils.formatPriceWithCurrency(model.totals.totalToBePaid,model.currencyCode),isNotZero:model.totals.totalToBePaid!=0};totalsTmplData["totalToBePaidMiles"]={amount:theUtils.formatPriceWithCurrency(model.totals.totalToBePaidMiles,"Points"),isNotZero:model.totals.totalToBePaidMiles!=0};totalsTmplData["totalRefundedCash"]={amount:theUtils.formatPriceWithCurrency(-model.totals.totalRefunded,model.currencyCode),isNotZero:model.totals.totalRefunded!=0};totalsTmplData["totalRefundedMiles"]={amount:theUtils.formatPriceWithCurrency(-model.totals.totalRefundedMiles,"Points"),isNotZero:model.totals.totalRefundedMiles!=0};var balance=model.totals.totalToBePaid-model.totals.totalRefunded;totalsTmplData["balanceNegative"]=balance<0;totalsTmplData["totalBalance"]={amount:theUtils.formatPriceWithCurrency(balance,model.currencyCode)};$("aside.main section#totalOpened").html($("#template_RD_ATC_totals").tmpl(totalsTmplData));initTaxToolTip();$("#tooltipToBePaid").qtip({content:{text:"<p>"+clientMessages["RPANEL.text.AtcAwardToBePaidTooltip"]+"</p>"},position:{my:"bottom center",at:"top center"}});$("#tooltipTotalRefund").qtip({content:{text:"<p>"+clientMessages["RPANEL.text.AtcAwardTotalRefundTooltip"]+"</p>"},position:{my:"bottom center",at:"top center"}});var balanceMiles=model.totals.totalToBePaidMiles-model.totals.totalRefundedMiles;var html="<span class='h4 "+(balanceMiles>0?"em":(balanceMiles<0?"em3":""))+"'>";html+=theUtils.formatPriceWithCurrency(balanceMiles,"Points")+"</span> | ";html+="<span class='h4 "+(balance>0?"em":(balance<0?"em3":""))+"'>";html+=theUtils.formatPriceWithCurrency(balance,model.currencyCode)+"</span>";$("#totalClosed").html(html);}function initTaxToolTip(){if(clientSideData.SHOW_TAXT){$("#taxtIco").qtip({content:{text:$("#taxt").html()},position:{target:"event",effect:false,viewport:$(window),my:"bottom center",at:"top center",adjust:{method:"none shift"}},style:{tip:{width:23,height:13},width:300},show:{event:"mouseenter",solo:true},hide:{event:"mouseleave"}});}}function initCurrencyConverter(model){$("#CC_CURRENCY_FROM").val(model.currencyCode);$("#currencyConvertor select").selectBox();$("#tttCurrencyConvertor select").selectBox();var currencyConvertorId=$("#currencyConvertor select").next().attr("id");$(window).on("scroll",function(){$("#opt-"+currencyConvertorId).hide();});$("#currencyConvertor select, #tttCurrencyConvertor select").change(function(){var that=this;var currencyCode=$(this).val();if(currencyCode!=="tttCurrencyConvertor"){if($("#CC_CURRENCY_TO").val()!==currencyCode){$("#CC_CURRENCY_TO").val(currencyCode);if(this.id=="tttCurrencyConverterDropDown"&&model.totals.timeToThinkPrice!=null){$("#CC_PRICE").val(model.totals.timeToThinkPrice);}else{setPriceForCurrencyConverter(model);}var converterForm=$("#CONVERTER_FORM");var formData=converterForm.serialize();var action=converterForm[0].action;$.ajax({type:"POST",url:action,dataType:"json",data:formData,success:function(result,textStatus,XMLHttpRequest){if(typeof result==="undefined"||typeof result.mapDataUI=="undefined"||typeof result.mapDataUI.conversionResult=="undefined"||typeof result.mapDataUI.conversionResult.params=="undefined"||typeof result.mapDataUI.conversionResult.params.convertedPrice=="undefined"){return;}var convertedVal=result.mapDataUI.conversionResult.params.convertedPrice;if(that.id!="tttCurrencyConverterDropDown"&&typeof convertedVal!="undefined"){$("#convertedAmount").html(theUtils.formatPriceWithCurrency(convertedVal,currencyCode)).prev().removeClass("none");}if(that.id=="tttCurrencyConverterDropDown"){$("#timeToThinkConvertedAmount").html(theUtils.formatPriceWithCurrency(convertedVal,currencyCode)).prev().removeClass("none");}},error:function(XMLHttpRequest,textStatus,errorThrown){}});}}else{$("#convertedAmount").html("").prev().addClass("none");$("#CC_CURRENCY_TO").val("");}});setPriceForCurrencyConverter(model);$("#currencyConvertor select").change();}function setPriceForCurrencyConverter(model){var price=model.totals.grandTotal.amount;$("#CC_PRICE").val(price);}function setBaseCurrencyForCurrencyConverter(model){var c=model.currencyCode;$("#CC_CURRENCY_FROM").val(c);}function calculateFlyTime(segments){var duration=0;$.each(segments,function(){duration+=parseInt(this.duration);});return duration;}function refreshTotals(model){if(model===null){return;}var currencyConverter=tamUtils.getElementForTmpls($("#currencyConvertorWrap").tmpl({}));if(currencyConverter.length>0){model.totals.currencyConvertor=currencyConverter;}if(clientSideData.FLOW_STATE.IS_ATC&&null!=model.totals&&typeof model.totals!=="undefined"){refreshAtcTotals(model);}else{if(clientSideData.FLOW_STATE.IS_REBOOKING_REDEMPTION){refreshRdAtcTotals(model);}else{refreshStandardTotals(model);}}}function turnOnRedemptionMode(){rpModel.totals["redemption"]=true;refreshTotals(rpModel);}function missingLocationFallback(index,itemToFind,bOrELocation,iata){if(null!=clientSideData.ITINERARY_DATA&&typeof clientSideData.ITINERARY_DATA!=="undefined"){return clientSideData.ITINERARY_DATA[index][bOrELocation][itemToFind];}return iata;}function turnOffRedemptionMode(){rpModel.totals["redemption"]=false;refreshTotals(rpModel);}function getScrollStickyCssTopOffset(scrollSticky){var scrollStickyCssTopOffset=100;if(clientSideData.PAGE_CODE!="UPSL"){if($(".tam-header-container")[0]){scrollStickyCssTopOffset=60;}else{scrollStickyCssTopOffset=50;}scrollSticky.css("top",scrollStickyCssTopOffset);}return scrollStickyCssTopOffset;}function adjustTripSummaryPosition(bScrollUp){var scrollUp=false;var st=$(this).scrollTop();if(st<window.ddsLastScrollTop||bScrollUp){scrollUp=true;}window.ddsLastScrollTop=st;var scrollSticky=$("#scrollSticky");var footer=$("#"+clientSideData.PAGE_CODE.toLowerCase()+"_footer");var priceWrapper=$("#aside-price-wrapper");var tripWrapper=$("#aside-trip-wrapper");if(scrollSticky[0]&&footer[0]&&priceWrapper[0]&&tripWrapper[0]){var scrollStickyRect=scrollSticky[0].getBoundingClientRect();var footerRect=footer[0].getBoundingClientRect();var priceWrapperRect=priceWrapper[0].getBoundingClientRect();var tripWrapperRect=tripWrapper[0].getBoundingClientRect();var stickyBottomBox=$("#sticky-bottom-box");if(footerRect.bottom<scrollStickyRect.bottom&&!window.wdsResponsive.isMobileScreen){if(scrollSticky.has("#aside-trip-wrapper")){tripWrapper.appendTo(stickyBottomBox);}}if(footerRect.bottom<priceWrapperRect.bottom&&!window.wdsResponsive.isMobileScreen){if(scrollSticky.has("#aside-price-wrapper")){priceWrapper.appendTo(stickyBottomBox).css("margin-bottom",0);}}if(footerRect.bottom>300&&!window.wdsResponsive.isMobileScreen){if(scrollStickyRect.bottom<tripWrapperRect.top){if(stickyBottomBox.has("#aside-trip-wrapper")){tripWrapper.appendTo(scrollSticky);}}}if(tripWrapperRect.top<priceWrapperRect.top){if(stickyBottomBox.has("#aside-trip-wrapper")){if(!priceWrapper.find("#white-div-20").length){priceWrapper.prepend('<div id="white-div-20" style="height:20px;"></div>');$("#aside-passengers-wrapper").removeClass("mb20").addClass("mb0");}}}if($(window).scrollTop()==0){if(priceWrapper.find("#white-div-20").length){$("#white-div-20").remove();$("#aside-passengers-wrapper").removeClass("mb0").addClass("mb20");}if(stickyBottomBox.has("#aside-trip-wrapper")){var priceWrapperRect=priceWrapper[0].getBoundingClientRect();var tripWrapperRect=tripWrapper[0].getBoundingClientRect();var mainOuter=$("#mainOuter");if(tripWrapperRect.top<priceWrapperRect.bottom&&!window.wdsResponsive.isMobileScreen){$("#aside-trip-wrapper").appendTo(scrollSticky);var tripWrapperRect=tripWrapper[0].getBoundingClientRect();var mainInnerRect=$("#mainInner")[0].getBoundingClientRect();if(tripWrapperRect.bottom>mainInnerRect.bottom&&$("body").height()<=$(window).height()){mainOuter.css("min-height",tripWrapperRect.height+priceWrapperRect.height+"px");}}else{mainOuter.css("min-height","0px");}}}if(scrollUp){var scrollStickyCssTopOffset=getScrollStickyCssTopOffset(scrollSticky);if(footerRect.bottom>((priceWrapperRect.bottom-priceWrapperRect.top)+scrollStickyCssTopOffset)){priceWrapper.prependTo(scrollSticky).css("margin-bottom","15px");}}}}function setupStickyAside(){var windowContext=$(window);var stickyAnchorOffset=$("#sticky-anchor").offset();var scrollSticky=$("#scrollSticky");var loginPanel=$("#logpanel");var loginPanelCorporate=$("#corppanel");var loginPanelArrow=$("#logarrow");var loginPanelArrowCorporate=$("#logarrowcor");var scrollStickyCssTopOffset=getScrollStickyCssTopOffset(scrollSticky);var isAsideSticky=scrollSticky.hasClass("stick");var updateStickyAsidePosition=function(){var scrollStickyTopOffset=windowContext.scrollTop()+scrollStickyCssTopOffset;stickyAnchorOffset=$(document.getElementById("sticky-anchor")).offset();if(stickyAnchorOffset&&(scrollStickyTopOffset>stickyAnchorOffset.top)){if(!isAsideSticky){scrollSticky.addClass("stick");isAsideSticky=true;if(loginPanel.is(":visible")){loginPanel.slideUp();loginPanelArrow.removeClass("log-arrow-up").addClass("log-arrow-down");}if(loginPanelCorporate.is(":visible")){loginPanelCorporate.slideUp();loginPanelArrowCorporate.removeClass("log-arrow-up").addClass("log-arrow-down");}}}else{if(isAsideSticky){scrollSticky.removeClass("stick");isAsideSticky=false;}}adjustTripSummaryPosition();};windowContext.resize(updateStickyAsidePosition);windowContext.scroll(updateStickyAsidePosition);}function setupInboundOutboundLinks(){var outboundAnchor=$(document.getElementById("ob1"));var inboundAnchor=$(document.getElementById("ib1"));if(undefined!=outboundAnchor[0]&&undefined!=inboundAnchor[0]){var outboundLink=$(document.getElementById("ob-link"));var inboundLink=$(document.getElementById("ib-link"));outboundLink.click(function(){scrollToAnchor(outboundAnchor,"slow");});inboundLink.click(function(){scrollToAnchor(inboundAnchor,"slow");});function scrollToAnchor(anchor,duration){var targetOffset=anchor.offset().top-80;$("html,body").animate({scrollTop:targetOffset},duration);}var scrollResizeFunction=function(){if((inboundAnchor.offset().top>($(window).scrollTop()+$(window).height()-20))){outboundLink.addClass("button").removeClass("selected");$(".ob-link > span").removeClass("arrows-up-white").addClass("arrows-up-grey");inboundLink.removeClass("button").addClass("selected");$(".ib-link > span").removeClass("arrows-down-grey").addClass("arrows-down-white");}else{inboundLink.addClass("button").removeClass("selected");$(".ib-link > span").removeClass("arrows-down-white").addClass("arrows-down-grey");outboundLink.removeClass("button").addClass("selected");$(".ob-link > span").removeClass("arrows-down-white").removeClass("arrows-up-grey").addClass("arrows-up-white");}};$(window).resize(scrollResizeFunction);$(window).scroll(scrollResizeFunction);$(document).on("usplAjaxInboundSuccess",function(){scrollToAnchor(inboundAnchor,0);});}}$(document).ready(function(){if(window.wdsResponsive&&window.wdsResponsive.initDialogOpenCloseEventHandler){window.wdsResponsive.initDialogOpenCloseEventHandler("#taxb, #rd_atc_taxb");}window.ddsLastScrollTop=0;var scrollResizeFunction=function(){if($("#rightPanel").length>0){$("#scrollSticky.stick").css("left",$("#rightPanel").offset().left-$(this).scrollLeft());}};$(window).resize(scrollResizeFunction);$(window).scroll(scrollResizeFunction);$("#flightSummaryArticle .toggle.plus").on("click",function(){$(".qtip-content").parent().hide();});$(document).bind("loadRightPanel",function(event,params){rpModel=params;refreshRightPanel(rpModel);$("#flightSummaryInterstice").hide();$("#flightSummaryArticle").show();});$(document).bind("updateBound",function(event,params){var boundId=params.boundId;if(null!=boundId&&typeof boundId!=="undefined"){delete boundId;}rpModel["bounds"][boundId]=params;refreshBound(rpModel,boundId);});$(document).bind("showBoundAsUncombinable",function(event,params){var boundId=params.boundId;showBoundAsUncombinable(boundId);});$(document).bind("updateCabins",function(event,params){var boundId=params.boundId;var bound=rpModel["bounds"][boundId];for(var i=0;i<bound.segments.length;i++){if(null!=params.cabins[i]&&params.cabins[i]!=undefined){bound.segments[i]["cabin"]=params.cabins[i];}}refreshBounds(rpModel,boundId);});$(document).bind("updateLuggage",function(event,params){var boundId=params.boundId;if(null!=params.luggage&&params.luggage!=undefined){rpModel["bounds"][boundId].luggage=params.luggage;}refreshBounds(rpModel,boundId);refreshTotals(rpModel);});$(document).bind("removeLuggage",function(event,params){var boundId=params.boundId;var bound=rpModel["bounds"][boundId];if(null!=bound.luggage&&typeof bound.luggage!=="undefined"){delete bound.luggage;}refreshBounds(rpModel,boundId);refreshTotals(rpModel);});$(document).bind("updateSeats",function(event,params){var boundId=params.boundId;rpModel["bounds"][boundId].seatsInfo=params.seatsInfo;refreshBounds(rpModel,boundId);refreshTotals(rpModel);});$(document).bind("removeSeats",function(event,params){var boundId=params.boundId;var bound=rpModel["bounds"][boundId];if(null!=bound&&bound!=undefined){delete bound.seatsInfo;refreshBounds(rpModel,boundId);refreshTotals(rpModel);}});$(document).bind("removeAddedSeats",function(event,params){var boundId=params.boundId;var bound=rpModel["bounds"][boundId];if(null!=bound&&bound!=undefined){if(null!=bound.seatsInfo&&typeof bound.seatsInfo!=="undefined"&&null!=bound.seatsInfo.seats&&typeof bound.seatsInfo.seats!=="undefined"){delete bound.seatsInfo.seats;}refreshBounds(rpModel,boundId);refreshTotals(rpModel);}});$(document).bind("showUpsellTeaser",function(event,params){rpModel["upsellTeaser"]=params;refreshUpsellTeaser(rpModel);});$(document).bind("hideUpsellTeaser",function(event){rpModel["upsellTeaser"]=undefined;refreshUpsellTeaser(rpModel);});$(document).bind("updateTotals",function(event,params){if(params.currencyCode){rpModel["currencyCode"]=params.currencyCode;}rpModel["totals"]=params;refreshTotals(rpModel);$("#flightSummaryInterstice").hide();$("#flightSummaryArticle").show();});$(document).bind("addInstallments",function(event,params){if(clientSideData.FLOW==="REBOOKING"){rpModel.totals["installments"]=params;}else{rpModel.totals["installments"]=params;}refreshTotals(rpModel);});$(document).bind("removeInstallments",function(event,params){if(typeof rpModel.totals.installments!="undefined"){delete rpModel.totals.installments;}refreshTotals(rpModel);});$(document).bind("addInsurance",function(event,params){rpModel.totals["insurance"]=params;refreshTotals(rpModel);});$(document).bind("removeInsurance",function(event,params){if(typeof rpModel.totals.insurance!="undefined"){delete rpModel.totals.insurance;}refreshTotals(rpModel);});$(document).bind("clearTotalPrices",function(event,params){var totals=rpModel["totals"];var isAtc=clientSideData.IS_ATC=="TRUE";if(null!=totals&&totals!=undefined){if(isAtc){if(null!=totals.newPrice.adults&&totals.newPrice.adults!=undefined&&null!=totals.newPrice.adults.price&&totals.newPrice.adults.price!=undefined){delete totals.newPrice.adults.price;}if(null!=totals.newPrice.children&&totals.newPrice.children!=undefined&&null!=totals.newPrice.children.price&&totals.newPrice.children.price!=undefined){delete totals.newPrice.children.price;}if(null!=totals.newPrice.infants&&totals.newPrice.infants!=undefined&&null!=totals.newPrice.infants.price&&totals.newPrice.infants.price!=undefined){delete totals.newPrice.infants.price;}if(null!=totals.newPrice.discount&&totals.newPrice.discount!=undefined){delete totals.newPrice.discount;}if(null!=totals.newPrice.rebook&&totals.newPrice.rebook!=undefined&&null!=totals.newPrice.rebook.price&&totals.newPrice.rebook.price!=undefined){delete totals.newPrice.rebook.price;}if(null!=totals.totalToBePaid&&totals.totalToBePaid!=undefined){delete totals.totalToBePaid;}if(null!=totals.totalRefunded&&totals.totalRefunded!=undefined){delete totals.totalRefunded;}}else{if(null!=totals.adults&&totals.adults!=undefined&&null!=totals.adults.price&&totals.adults.price!=undefined){delete totals.adults.price;}if(null!=totals.children&&totals.children!=undefined&&null!=totals.children.price&&totals.children.price!=undefined){delete totals.children.price;}if(null!=totals.infants&&totals.infants!=undefined&&null!=totals.infants.price&&totals.infants.price!=undefined){delete totals.infants.price;}if(null!=totals.discount&&totals.discount!=undefined){delete totals.discount;}}}refreshTotals(rpModel);});$(document).bind("removeLoadingIconFromPriceSection",function(){$("#totalOpened").removeClass("interstice");});$(document).bind("displayLoadingIconOnPriceSection",function(){$("#totalOpened").addClass("interstice");$("#totalClosed").html("");});if(null!=clientSideData.DEFAULT_RIGHTPANEL_MODEL&&clientSideData.DEFAULT_RIGHTPANEL_MODEL!=undefined){rpModel=$.extend(true,{},clientSideData.DEFAULT_RIGHTPANEL_MODEL);refreshRightPanel(rpModel);$("#flightSummaryInterstice").hide();$("#flightSummaryArticle").show();}$(document).on("click",".atc_boxp .toggle, .rd_atc_boxp .toggle",function(){if($(this).attr("id")=="convTrigger"){return true;}$(this).closest("div").children(":not(.section-header)").children(":not(.summary)").toggleClass("none");$(this).find("smaller").toggleClass("minus");$(this).find("smaller").toggleClass("plus");adjustTripSummaryPosition();});$(document).on("click","#priceSummaryArticle h4.toggle",function(){var bScrollUp=false;if($("section#totalOpened").is(":visible")!=true){bScrollUp=true;}adjustTripSummaryPosition(bScrollUp);});$(document).on("click","#priceSummaryArticle #convTrigger, #flightSummaryArticle",function(){adjustTripSummaryPosition();});setupStickyAside();setupInboundOutboundLinks();if(clientSideData.WDS_SHOW_PRICE_PANEL_EXPANDED){if(clientSideData.FLOW_STATE.IS_REBOOKING_REDEMPTION){$(".rd_atc_boxp .toggle").trigger("click");}else{$(".atc_boxp .toggle").trigger("click");}}var switchClickHandler=function(e){window.wdsFlowswitchPopin.openDialog({callback:function(){window.location.href=$(e.currentTarget).attr("data-href");}});};if(clientSideData.IS_FULLPOINTS_ACTIVATED_FOR_BOOKING_REDEMPTION){if(clientSideData.SWITCH_TO_FULLPOINTS_ENABLED){$("#redmeptionLinkButton").on("click",switchClickHandler);}if(clientSideData.SWITCH_TO_TAM_ENABLED){$("#revenueLinkButton").on("click",switchClickHandler);}}if(clientSideData.IS_TIME_TO_THINK_TEASER_ON_MOBILE_ALPI){$("#timeToThinkSubmitButton").on("click",function(){var rpModel=$.extend(true,{},clientSideData.DEFAULT_RIGHTPANEL_MODEL);if(rpModel.totals.timeToThinkPrice!=null){var timeToThinkPriceForAllPax=theUtils.formatPriceWithCurrency(rpModel.totals.timeToThinkPrice,rpModel.currencyCode);$("#aside-timetothink-wrapper").hide();clientSideData.IS_TIME_TO_THINK_TEASER_ON_MOBILE_ALPI=false;clientSideData.IS_TIME_TO_THINK_SELECTED_ON_ALPI=true;refreshStandardTotals(rpModel);$("#rightPanelToggle .header-toggle-price").text(timeToThinkPriceForAllPax);}});}});