var flightDetailsFactory=(function(){var flightDetailsClass=(function(){var template_body=$('<script id="flightDetailsTemplate" type="text/x-jquery-tmpl">'+"{{if Row}}"+'<tr class="details dotted border-bottom {{if Row.Internal.first}} first {{/if}} {{if Row.Internal.tr_class && Row.Internal.activeColumnIndex != Row.Internal.nrOfColumns}}bordert{{else}}border{{/if}} {{if Row.Internal.firstTime}}none{{/if}}">'+"{{if Row.Internal.first}}"+'<td class="rowspan" rowspan="{{html Row.Data.rowsCount}}" colspan="2">'+'{{if Row.Internal.showSeatMap}}<button class="short block wrap seatMap"><small class="fl ico gseat"></small><span>{{html Row.Data.buttons.view_seatmap}}</span></button>{{/if}}'+'<button class="short block br wrap compareFare"><small class="fl ico zoom"></small><span>{{html Row.Data.buttons.compare_fare}}</span></button>'+'{{if Row.Internal.showLegalNotice}}<button class="short block br wrap legalNotice"><small class="fl ico book"></small>{{html Row.Data.buttons.legal_notice}}</button>{{/if}}'+"</td>"+"{{/if}}"+'<td class="right {{if Row.Internal.active && Row.Internal.active[0] == \'selected\'}} ffamilyr1{{/if}}" colspan="2">'+'<img alt="" class="fl" src="${Row.Data.icon}">&nbsp;'+'<strong class="fl grid2-2">${Row.Data.service}&nbsp;'+'{{if Row.Data.name == "BaggageAllowance"}}<small class="ico info tooltip-link baggageAllowanceLink"></small>{{/if}}</strong>'+"</td>"+"{{each Row.Data.ff_values}}"+"<td class=\"tc {{if Row.Internal.active && (Row.Internal.active[$index] == 'selected')}} ffamilyr${$index+1}{{/if}}{{if Row.Internal.active &&"+"Row.Internal.active[$index] == 'nextSelected'}} ffamilyr${$index+2}{{/if}}{{if Row.Internal.active"+'&& Row.Internal.active[$index] == \'previousSelected\'}}cfamily${$index+1}{{/if}}{{if Row.Internal.last}} last{{/if}}"><div class="cell-inside">{{html $value}}</div></td>'+"{{/each}}"+"</tr>"+"{{if Row.Internal.last && Row.Internal.activeColumnIndex != Row.Internal.nrOfColumns}}"+'<tr class="details mark {{if Row.Internal.firstTime}}none{{/if}}">'+'<td colspan="4" class="indent grid-1 {{if Row.Internal.active && Row.Internal.active[0] == \'selected\'}} ffamilyr1{{/if}}"></td>'+"{{each Row.Data.ff_values}}"+"<td class=\"pnone-imp tc right grid-1 {{if Row.Internal.active && (Row.Internal.active[$index] == 'selected')}} ffamilyr${$index+1}{{/if}}{{if Row.Internal.active &&"+"Row.Internal.active[$index] == 'nextSelected'}} ffamilyr${$index+2}{{/if}}{{if Row.Internal.active"+"&& Row.Internal.active[$index] == 'previousSelected'}}cfamily${$index+1}{{/if}}\">"+"{{if Row.Internal.active[$index] == 'previousSelected' }}"+'<span class="slope family sfamily${$index+1}"></span>'+"{{/if}}"+"</td>"+"{{/each}}"+"</tr>"+"{{/if}}"+"{{/if}}"+"<\/script>");var template_body_multiplusBenefits=$('<script id="flightDetailsNoBenefits" type="text/x-jquery-tmpl">'+"{{if Row}}"+'<tr class="details dotted borderb borderall {{if Row.Internal.first}} first {{/if}} {{if Row.Internal.tr_class && Row.Internal.activeColumnIndex != Row.Internal.nrOfColumns}}bordert{{else}}border{{/if}} {{if Row.Internal.firstTime}}none{{/if}}">'+"{{if Row.Internal.first}}"+'<td class="rowspan vertical-allign" rowspan="{{html (Row.Data.rowsCount)}}" colspan="2">'+'{{if Row.Internal.showSeatMap}}<button class="midst seatMap"><small class="fl ico gseat"></small>{{html Row.Data.buttons.view_seatmap}}</button>{{/if}}'+'{{if Row.Internal.showLegalNotice}}<button class="midst br legalNotice"><small class="fl ico book"></small>{{html Row.Data.buttons.legal_notice}}</button>{{/if}}'+"</td>"+"{{/if}}"+'{{if Row.Data.name != "Fidelidadepoints"}}'+'<td class="right {{if Row.Internal.active && Row.Internal.active[0] == \'selected\'}} ffamilyr1{{/if}}" colspan="2">'+'<img alt="" class="fl" src="${Row.Data.icon}">&nbsp;'+'<strong class="fl grid2-2 font-12">${Row.Data.service}&nbsp;'+'{{if Row.Data.name == "BaggageAllowance"}}<small class="ico info tooltip-link baggageAllowanceLink"></small>{{/if}}</strong>'+"</td>"+"{{each Row.Data.ff_values}}"+"<td class=\"pad5 tc {{if Row.Internal.active && (Row.Internal.active[$index] == 'selected')}} ffamilyr${$index+1}{{/if}}{{if Row.Internal.active &&"+"Row.Internal.active[$index] == 'nextSelected'}} ffamilyr${$index+2}{{/if}}{{if Row.Internal.active"+'&& Row.Internal.active[$index] == \'previousSelected\'}}cfamily${$index+1}{{/if}}{{if Row.Internal.last}} last{{/if}}"><div class="cell-inside font-12">{{html $value}}</div></td>'+"{{/each}}"+"{{/if}}"+"{{if Row.Internal.last && Row.Internal.activeColumnIndex != Row.Internal.nrOfColumns}}"+'<tr class="details mark {{if Row.Internal.firstTime}}none{{/if}}">'+'<td colspan="4" class="indent grid-1 border-right {{if Row.Internal.active && Row.Internal.active[0] == \'selected\'}} ffamilyr1{{/if}}"></td>'+"{{each Row.Data.ff_values}}"+"<td class=\"pnone-imp tc right grid-1 borderr {{if Row.Internal.active && (Row.Internal.active[$index] == 'selected')}} ffamilyr${$index+1}{{/if}}{{if Row.Internal.active &&"+"Row.Internal.active[$index] == 'nextSelected'}} ffamilyr${$index+2}{{/if}}{{if Row.Internal.active"+"&& Row.Internal.active[$index] == 'previousSelected'}}cfamily${$index+1}{{/if}}\">"+"{{if Row.Internal.active[$index] == 'previousSelected' }}"+'<span class="slope arrow family sfamily${$index+1}"></span>'+"{{/if}}"+"</td>"+"{{/each}}"+"</tr>"+"{{/if}}"+"</tr>"+"{{/if}}"+"<\/script>");var template_footer=$('<script id="flightDetailsFooterTemplate" type="text/x-jquery-tmpl">'+'<tr class="details last teaserInfo">'+'<td colspan="{{html teaser_colspan}}" class="family{{html activeColumnIndex+2}} family relative">'+"{{if upgrade_teaser}}"+'<p class="hr upgrade-main {{html activeColumnIndex+2}} {{if firstTime}}none{{/if}}" data-ff="{{html activeColumnIndex+2}}">'+'<button class="fr">{{html upgrade}}</button>'+"<strong>{{html upgrade_teaser}}</strong>"+"{{if upgrade_teaser_details}}"+"<br>{{html upgrade_teaser_details}}"+"{{/if}}"+"</p>"+'<p class="caption3 tr upgrade-toggle"><strong class="em">{{html show}} <small class="ico hide"></small></strong> &nbsp;</p>'+"{{else}}"+'<p class="caption3 tr"><strong class="em">{{html show}} <small class="ico {{html show_icon}}"></small></strong> &nbsp;</p>'+"{{/if}}"+"</td>"+"</tr>"+"<\/script>");var multiplus_template_footer=$('<script id="flightDetailsFooterTemplate" type="text/x-jquery-tmpl">'+'<tr class="details last teaserInfo">'+'<td colspan="{{html teaser_colspan}}" class="family{{html activeColumnIndex+2}} family relative">'+"{{if upgrade_teaser}}"+'<p class="hr upgrade-main {{html activeColumnIndex+2}} {{if firstTime}}none{{/if}}" data-ff="{{html activeColumnIndex+2}}">'+"{{html upgrade_teaser}}"+"</p>"+'<p class="caption3 tr upgrade-toggle"></p>'+"{{/if}}"+"</td>"+"</tr>"+"<\/script>");var template_warnings=$('<script id="flightWarningTemplate" type="text/x-jquery-tmpl">'+'<tr class="details vcp none">'+'<td colspan="8"><div class="warning w4"></div></td>'+"</tr>"+'<tr class="details connectionindifferentairportwarning none">'+'<td colspan="8"><div class="warning w4"></div></td>'+"</tr>"+"<\/script>");var template_popin=$('<script id="template_popin" type="text/x-jquery-tmpl">'+"<div>"+'<header class="caption4">'+'<h3 class="h6">{{html title}}</h3>'+"</header>"+'<section style="background: none repeat scroll 0 0 #FFFFFF;padding: 8px;">'+'<p class="hr">{{html text}}</p>'+"</section>"+'<footer class="wrap caption4 default"></footer>'+"</div>"+"<\/script>");var chosenFlightPattern=/^radio_(\d)_(\d+)_(\w+)_[\w_]*$/;var buttonHeight=20;var standardButtonHeight=100;var paddingBottom="18px";var config=[];var removeWrongSignsInPrice=function(price){return price;};config.correctConfigObjectByAvailableBenefits=function(benefits){var notAvailable=clientMessages[clientSideData.MSG_PAGE_CODE+".text.BenefitNotAvailable"];for(row in this){if(typeof this[row]!="function"&&typeof this[row].Row!=="undefined"){var result_ff_values=[];var values_count=0;for(ff_value_idx in this[row].Row.Data.ff_values){if(this[row].Row.Data.ff_values.hasOwnProperty(ff_value_idx)){var ff_value=this[row].Row.Data.ff_values[ff_value_idx];if(benefits[~~ff_value_idx][~~row]){result_ff_values.push(ff_value);values_count++;}else{result_ff_values.push(notAvailable);}}}if(0!==values_count){this[row].Row.Data.ff_values=result_ff_values;}else{var current=this[row];if(current.Row.Internal.last&&!current.Row.Internal.first){var prev=this[(~~row)-1];if("undefined"!==typeof prev){prev.Row.Internal.last=current.Row.Internal.last;}}if(current.Row.Internal.first&&!current.Row.Internal.last){var next=this[(~~row)+1];if("undefined"!==typeof next){next.Row.Internal.first=current.Row.Internal.first;next.Row.Internal.showSeatMap=current.Row.Internal.showSeatMap;next.Row.Internal.showLegalNotice=current.Row.Internal.showLegalNotice;next.Row.Data.buttons=current.Row.Data.buttons;}}delete this[row];}}}for(var i=0;i<this.length;){if("undefined"===typeof this[i]){this.splice(i,1);}else{i++;}}if(0<this.length){this[0].Row.Data["rowsCount"]=this.length;}return this;};config.correctConfigObjectByActivePosition=function(active,section){var nextAllowed=true;var td=section.find("td.ff.selectedFF");if(td.next().hasClass("disabled")||td.next().hasClass("noselect")){nextAllowed=false;}for(row in this){if(typeof this[row]!="function"&&typeof this[row].Row!=="undefined"){this[row].Row.Internal["activeColumnIndex"]=active;this[row].Row.Internal["nrOfColumns"]=this[row].Row.Data["ff_values"].length-1;this[row].Row.Internal["collspan"]=this[row].Row.Data["ff_values"].length+4;var activeColumn=[];for(var i=0;i<this[row].Row.Data.ff_values.length;i++){if(typeof this[row].Row.Data.ff_values[i]!="function"){if(this[row].Row.Data.ff_values[i]==""||this[row].Row.Data.ff_values[i]=="empty"){this[row].Row.Data.ff_values[i]=this[row].Row.Data.default_val;}if(activeColumn.length==0){activeColumn[this[i].Row.Data.ff_values.length-1]=undefined;}if(i==active){activeColumn[active]="selected";}else{if(i==active-1){activeColumn[active-1]="nextSelected";}else{if(i==active+1&&nextAllowed){activeColumn[active+1]="previousSelected";}}}}}for(key in this){if(typeof this[key]!="function"&&typeof this[key].Row!=="undefined"){this[key].Row.Internal["active"]=activeColumn;}}}}return this;};config.correctConfigObjectByArrowPosition=function(active,flightNr,section,firstTime){var lastPosition=undefined;for(var key in this){if(typeof this[key]!="function"&&typeof this[key].Row!=="undefined"){if(typeof lastPosition==="undefined"){lastPosition=key;}else{if(key>lastPosition){if(typeof this[key].Row.Data.default_val!=="undefined"){lastPosition=key;}}}}}this[lastPosition].Row.Internal["last"]=true;var first=true;for(var key in this){if(typeof this[key]!="function"&&-1<key&&typeof this[key].Row!=="undefined"){this[key].Row.Internal["firstTime"]=firstTime;if(first){this[key].Row.Internal["first"]=true;var tmpConf=this.getSeatMapFormConfigObject(flightNr,section);if(tmpConf.length>0&&!clientSideData.FLOW_STATE.IS_ATC){this[key].Row.Internal["showSeatMap"]=true;if(typeof this[key].Row.Internal["buttonsMarginTop"]==="undefined"){this[key].Row.Internal["buttonsMarginTop"]=standardButtonHeight;}}else{this[key].Row.Internal["showSeatMap"]=false;if(typeof this[key].Row.Internal["buttonsMarginTop"]==="undefined"){this[key].Row.Internal["buttonsMarginTop"]=standardButtonHeight+buttonHeight;}else{this[key].Row.Internal["buttonsMarginTop"]+=buttonHeight;}}first=false;}else{this[key].Row.Internal["first"]=false;}for(var i in this[key].Row.Data["ff_values"]){if(typeof this[key].Row.Data["ff_values"][i]!="function"&&typeof this[key].Row.Data["ff_values"][i]!=="undefined"){if(key==lastPosition){if(active==i){this[lastPosition].Row.Internal["tr_class"]="bordert";}}}}}}return this;};config.getTeaserConfigObject=function(active,section,messages){var teaserConfig=[];var update_teaser=true;var firstTime=false;var teaser_colspan=null;var teaser_message=messages.teaserMessage;var teaser_details_message=messages.teaserDetailsMessage;var negative_teaser_message=messages.teaserMessageNegative;var _teaserAmount="{{amount}}";var _teaserFF="{{fare_family}}";var td=section.find("td.ff.selectedFF");var currentPrice=removeWrongSignsInPrice(jQuery.trim(td.data("cellValue")));if(td.next().is("td.ff")){var nextPrice=removeWrongSignsInPrice(td.next().data("cellValue"));}var switchCurrency=false;var nextFFprice="";var roundedPriceVal=Math.round((nextPrice-currentPrice)*100)/100;if(switchCurrency){nextFFprice=Math.abs(roundedPriceVal)+" "+messages.currency;}else{nextFFprice=messages.currency+" "+Math.abs(roundedPriceVal);}var thFamily=section.find("thead tr th.family");if(thFamily.length<1){var stickyHeader=$(".sticky-thead-out");if(section.hasClass("inbound")){stickyHeader=$(".sticky-thead-in");}thFamily=stickyHeader.find("thead tr th.family");}var nextFFName=thFamily.eq(td.parent().find("td.ff").index(td)+1).text();if(roundedPriceVal<0){teaser_message=negative_teaser_message.replace(_teaserAmount,nextFFprice).replace(_teaserFF,nextFFName);}teaser_message=teaser_message.replace(_teaserAmount,nextFFprice).replace(_teaserFF,nextFFName);for(var key in this){if(typeof this[key]!="function"&&typeof this[key].Row!=="undefined"&&typeof this[key].Row.Data["ff_values"]!=="undefined"){if(typeof this[key].Row.Data["ff_values"][active]==="undefined"){update_teaser=false;break;}teaser_colspan=this[key].Row.Internal["collspan"];firstTime=this[key].Row.Internal["firstTime"];if(this[key].Row.Data["ff_values"].length-1==active){teaser_message=null;}break;}}if(td.next().hasClass("disabled")||td.next().hasClass("noselect")){teaser_message=null;}if(update_teaser){var ffObject=section.find("td.selectedFF").next().eq(0).attr("class").match(/ff-(\w+)/);var teaser_message_details=ffObject?clientSideData.teaserDetailedMessages[ffObject[1]]:null;teaserConfig[0]={upgrade:messages.upgrade,upgrade_teaser:teaser_message,upgrade_teaser_details:teaser_message_details,teaser_colspan:teaser_colspan,activeColumnIndex:active,show:messages.hide,show_icon:"hide",firstTime:firstTime};}if(firstTime){teaserConfig[0].show=messages.show;teaserConfig[0].show_icon="show";}return teaserConfig;};config.getSeatMapFormConfigObject=function(flightNr,section){var seatMapConfig=[];var flightNrArray=flightNr.split("_");var ffName=section.find("td.selectedFF").eq(0).attr("class").match(/ff-(\w+)/)[1];for(var key in this){if(typeof this[key]!="function"&&typeof this[key].Row!=="undefined"&&typeof this[key].Row.Data["ff_values"]!=="undefined"&&typeof this[key].Row.Data["seatMap"]!=="undefined"){var sectionConf="";var boundLoc="";if(section.hasClass("outbound")){sectionConf="OUTBOUND";boundLoc=clientMessages["SEAT.text.Outbound"];}else{if(section.hasClass("inbound")){sectionConf="INBOUND";boundLoc=clientMessages["SEAT.text.Inbound"];}}for(var seatMapFlightIt in this[key].Row.Data["seatMap"][sectionConf]){if(typeof this[key].Row.Data["seatMap"][sectionConf][seatMapFlightIt]!="function"&&jQuery.inArray(seatMapFlightIt,flightNrArray)!=-1){var restricted=this[key].Row.Data["seatMap"][sectionConf][seatMapFlightIt]["restricted"].split(";");if($.inArray(ffName,restricted)!=-1){continue;}var tmp={"colspan":this[key].Row.Internal["collspan"],"flightNumber":seatMapFlightIt,"BOUND":boundLoc};for(var seatMapKey in this[key].Row.Data["seatMap"][sectionConf][seatMapFlightIt]){if(typeof this[key].Row.Data["seatMap"][sectionConf][seatMapFlightIt][seatMapKey]!="function"){tmp[seatMapKey]=this[key].Row.Data["seatMap"][sectionConf][seatMapFlightIt][seatMapKey];}}seatMapConfig[seatMapConfig.length]=tmp;}}break;}}return seatMapConfig;};config.getCompareConfigurationOb=function(){for(var key in this){if(typeof this[key]!="function"&&typeof this[key].Row!=="undefined"&&typeof this[key].Row.Data["compare"]!=="undefined"){return this[key].Row.Data["compare"];}}return null;};config.getLegalNotice=function(active,section){for(var key in this){if(typeof this[key]!="function"&&typeof this[key].Row!=="undefined"&&typeof this[key].Row.Data["legalNotice"]!=="undefined"){if(typeof this[key].Row.Data["legalNotice"][active]==="undefined"||clientSideData.FLOW_STATE.IS_ATC){this[key].Row.Internal["showLegalNotice"]=false;if(typeof this[key].Row.Internal["buttonsMarginTop"]==="undefined"){this[key].Row.Internal["buttonsMarginTop"]=standardButtonHeight+buttonHeight;}else{this[key].Row.Internal["buttonsMarginTop"]+=buttonHeight;}}else{this[key].Row.Internal["showLegalNotice"]=true;if(typeof this[key].Row.Internal["buttonsMarginTop"]==="undefined"){this[key].Row.Internal["buttonsMarginTop"]=standardButtonHeight;}}return this[key].Row.Data["legalNotice"][active];}}return null;};config.checkCssConditions=function(response){for(row in this){if(typeof this[row]!="function"&&typeof this[row].Row!=="undefined"){if(typeof this[row].Row.Internal!=="undefined"&&this[row].Row.Internal["last"]&&this[row].Row.Internal["activeColumnIndex"]==this[row].Row.Internal["nrOfColumns"]){var ob=$("'"+response+"'");response=$("<div>").append(ob).remove().html();}}}return response;};var _getPricesToGA=function(boundInfo,adtNb,chdNb,infNb){var price=0;if(typeof boundInfo.listTravelerTypePriceWithoutTax.ADT!=="undefined"){price+=boundInfo.listTravelerTypePriceWithoutTax.ADT*adtNb;}if(typeof boundInfo.listTravelerTypePriceWithoutTax.CHD!=="undefined"){price+=boundInfo.listTravelerTypePriceWithoutTax.CHD*chdNb;}if(typeof boundInfo.listTravelerTypePriceWithoutTax.INF!=="undefined"){price+=boundInfo.listTravelerTypePriceWithoutTax.INF*infNb;}return price*theCO_UPSLForm.getExchangeRateOnCoUpsl();};var _showhideClickCallback=function(el,messages){if(el.find("small").hasClass("hide-white")||el.find("small").hasClass("hide")){el.closest("table").find("tr.details").not(".vcp").not(el.parent().parent()).addClass("none").each(function(){$(this).find("td").addClass("none");});el.prev().addClass("none");el.find("strong").html(messages.show+' <small class="ico show"></small>');}else{el.closest("table").find("tr.details").not(".vcp").not(el.parent().parent()).removeClass("none").each(function(){$(this).find("td").removeClass("none");});el.prev().removeClass("none");el.find("strong").html(messages.hide+' <small class="ico hide"></small>');}};var _updateClickCallback=function(el,section){var hideTeaser=function(section){section.find("tr.teaserInfo p.hr").hide();section.find("tr.details td[class*='cfamily']").removeClass(function(){var classes=$(this).attr("class").split(/\s/);for(aClass in classes){if(typeof classes[aClass]!="function"){var res=classes[aClass].match(/cfamily\d+/);if(res!=null){return res[0];}}}return null;});section.find("tr.details td span[class*='sfamily']").hide();section.find("tr.details.slope").hide();};var td=section.find("td.ff.selectedFF");if(td.next().is("td.ff")){td.next().trigger("click");if(clientSideData.IS_OWD){setTimeout(function(){hideTeaser(section);},2100);}else{hideTeaser(section);}}};var _listen=function(ob){ob.section.on("click","small.baggageAllowanceLink",(function(messages){return function(){tamUtils.popSizedWin(messages.baggageAllowanceLink,600,400);};})(ob.messages));ob.section.on("click","tr.last td p.tr",(function(messages){return function(){_showhideClickCallback($(this),messages);};})(ob.messages));ob.section.on("click","tr.teaserInfo button",(function(section){return function(){return _updateClickCallback($(this),section);};})(ob.section));ob.section.on("click","button.seatMap",function(){var tdClicked=ob.section.find("td.ff.selectedFF");var trClicked=tdClicked.parent();var flights=ob.flightNumber.split("_");var config=[];for(var key in flights){if(typeof flights[key]!="function"&&flights.hasOwnProperty(key)){if(typeof trClicked.data("seatMapConfig")[flights[key]]!=="undefined"){var innerConfig={};innerConfig[flights[key]]=trClicked.data("seatMapConfig")[flights[key]];innerConfig[flights[key]]["OUTPUT_TYPE"]="2";innerConfig[flights[key]]["BOOKING_CLASS"]=jQuery.trim(tdClicked.data("cell-rbd-"+key));innerConfig[flights[key]]["FARE_BASIS"]=jQuery.trim(tdClicked.data("cellFareclass"));config[config.length]=innerConfig;}}}seatMap.prepare(config);seatMap.show(true);return false;});ob.section.on("click","button.compareFare",function(){tamUtils.popSizedWin(ob.compareConfiguration.link,ob.compareConfiguration.width,ob.compareConfiguration.height);return false;});ob.section.on("click","button.legalNotice",function(){if(typeof ob.legalNotice!=="undefined"){var configLN=[{"title":clientMessages[clientSideData.MSG_PAGE_CODE+".text.FareRules"],"text":ob.legalNotice}];var popin=$(tamUtils.getElementForTmpls(template_infoPopin.tmpl(configLN)));popin.dialog({autoOpen:true,draggable:false,width:800,modal:true,resizable:false});}return false;});};var flightDetailsClass=function(section,messages){this.section=section;this.messages=messages;this.flightNumber=null;this.displayBenefits=true;this.compareConfiguration=null;this.legalNotice=null;this.firstTime=true;_listen(this);};flightDetailsClass.prototype={update:function(detailsOb,clickedEl,activeColumn,flightNumber,benefits){var insertOb=clickedEl.parent();while(typeof insertOb.next()!="undefined"&&insertOb.next().is("tr")&&insertOb.next().hasClass("flightNextSegment")){insertOb=insertOb.next();}this.flightNumber=flightNumber;this.benefits=benefits;this.section.find("td").each(function(){if(typeof $(this).attr("class")!=="undefined"){var res=$(this).attr("class").match(/family(\d+)/);if(res!=null&&res[1]!=="undefined"){$(this).removeClass("family"+res[1]);}}});clickedEl.addClass("family"+(~~activeColumn+1));this.section.find("tr.details").remove();var temporary_config=jQuery.extend(true,detailsOb,config);this.compareConfiguration=temporary_config.getCompareConfigurationOb();this.legalNotice=temporary_config.getLegalNotice(activeColumn,this.section);var currentConfig=temporary_config.correctConfigObjectByActivePosition(activeColumn,this.section).correctConfigObjectByArrowPosition(activeColumn,this.flightNumber,this.section,this.firstTime);var response="";var row_config=currentConfig.getTeaserConfigObject(activeColumn,this.section,this.messages);if(row_config.length>0){if(clientSideData.IS_REDEMPTION){response+=$("<div>").append(multiplus_template_footer.tmpl(row_config).clone()).remove().html();}else{response+=$("<div>").append(template_footer.tmpl(row_config).clone()).remove().html();}}row_config=currentConfig.getSeatMapFormConfigObject(this.flightNumber,this.section);if(row_config.length>0){var seatMapConfig={};for(var key in row_config){if(row_config.hasOwnProperty(key)){seatMapConfig[row_config[key].flightNumber]=row_config[key];}}clickedEl.parent().data("seatMapConfig",seatMapConfig);}var currentConfigFirstRow=currentConfig[0];var currentConfig=currentConfig.correctConfigObjectByAvailableBenefits(this.benefits);var finalTemplateBody=null;if(clientSideData.IS_REDEMPTION||(!clientSideData.IS_REDEMPTION&&0==currentConfig.length)){finalTemplateBody=template_body_multiplusBenefits.tmpl(currentConfig,currentConfig.length).clone();}else{finalTemplateBody=template_body.tmpl(currentConfig,currentConfig.length).clone();}var template_warning=template_warnings.tmpl().clone();response=$("<div>").append(finalTemplateBody).remove().html()+response;response+=$("<div>").append(template_warning).remove().html();response=currentConfig.checkCssConditions(response);this.firstTime=false;this.section.find(".legend").show();insertOb.after(response);},resetFirstTime:function(){this.firstTime=true;}};return flightDetailsClass;})();return{create:function(section,messages){return new flightDetailsClass(section,messages);}};})();