var isCallOngoing=false;function Search(){var self=this;this.corporateCodeIsCheckedOk=true;this.corporateCodeManagerCpt=0;this.corporateCheckOngoing=false;this.manageAffinityDeeplink();this.init();this.prepareCacheObjForDeeplink();if(clientSideData.PAGE_CODE=="HOME_SEARCH"||clientSideData.PAGE_CODE=="SEARCH"||clientSideData.PAGE_CODE=="GENERR"){$.jStorage.set("outboundPreselected",null);$.jStorage.set("inboundPreselected",null);}this.onlineSearchForm=wdk.form("SEARCH_FORM",{errorPanel:$("#pageError"),check:function(){$("#bepageError").errorPanel();var bDate=this.input("B_DATE_1");var eDate=this.input("B_DATE_2");var dest_outbound=this.input("B_LOCATION_1");var dest_inbound=this.input("E_LOCATION_1");var search_to=this.input("search_to");var search_from=this.input("search_from");var tripType=this.input("TRIP_TYPE");if(clientSideData.PAGE_CODE=="HOME_SEARCH"||clientSideData.PAGE_CODE=="SEARCH"||clientSideData.PAGE_CODE=="GENERR"){var corporateCode=this.input("CORPORATE_CODE_INPUT");}var useMyPoints=this.input("passenger_useMyPoints");var errorText="";var hasError=false;if(clientSideData.WDS_DISABLE_FLOW_SPECIFIC_LOCATIONS==false){if($("input[name='TRIP_TYPE']:checked").val()!="M"){var foundFrom=false;var foundTo=false;if(useMyPoints.prop("checked")){$.each(clientSideData.REDEMPTION_AIRPORTS,function(){if(this.IATA==$(search_to).attr("data-code")){foundTo=true;}if(this.IATA==$(search_from).attr("data-code")){foundFrom=true;}});}else{$.each(clientSideData.REVENUE_AIRPORTS,function(){if(this.IATA==$(search_to).attr("data-code")){foundTo=true;}if(this.IATA==$(search_from).attr("data-code")){foundFrom=true;}});}if(!foundFrom){if(clientSideData.PAGE_CODE=="HOME_SEARCH"){hasError=true;errorText+=$.trim(clientMessages["HOME_SEARCH.error.OutboundIsInvalidForYourFlow"])+".";outboundError=true;$("#search_from").addClass("em");}else{search_from.check(function(){$(this).removeClass("em");$(this).addClass("em");return false;},clientMessages["ALLP.error.OutboundIsInvalidForYourFlow"]);}$("#search_from").val("");}if(!foundTo){if(clientSideData.PAGE_CODE=="HOME_SEARCH"){hasError=true;errorText+=$.trim(clientMessages["HOME_SEARCH.error.InboundIsInvalidForYourFlow"])+".";outboundError=true;$("#search_to").addClass("em");}else{search_to.check(function(){$(this).removeClass("em");$(this).addClass("em");return false;},clientMessages["ALLP.error.InboundIsInvalidForYourFlow"]);}$("#search_to").val("");}}}$("#search_outbound_date, #search_inbound_date").removeClass("em");if(tripType.value()=="M"||clientSideData.SKIP_RT_VALIDATION==true){return true;}if(clientSideData.PAGE_CODE=="HOME_SEARCH"){dest_outbound.check(function(){var outboundError=false;if(hasError==false){$("#search_from").removeClass("em");}if(dest_outbound.value()==""||search_from.value()==""){hasError=true;errorText+=$.trim(clientMessages["HOME_SEARCH.error.PleaseFillTheOutbound"])+".";outboundError=true;$("#search_from").addClass("em");}return !outboundError;}," ");dest_inbound.check(function(){var inboundError=false;if(hasError==false){$("#search_to").removeClass("em");}if(dest_inbound.value()==""||search_to.value()==""){if(hasError){errorText+=", ";}hasError=true;errorText+=$.trim(clientMessages["HOME_SEARCH.error.PleaseFillTheInbound"])+".";inboundError=true;$("#search_to").addClass("em");}return !inboundError;}," ");if(!clientSideData["IS_CORPORATE_FLOW"]&&clientSideData.PAGE_CODE=="HOME_SEARCH"||clientSideData.PAGE_CODE=="SEARCH"||clientSideData.PAGE_CODE=="GENERR"){corporateCode.check(function(){self.corporateCheckOngoing=false;if(corporateCode.val()!==""){corporateCode.val($.trim($("#search_promo").val()));if(corporateCode.val()!==""){self.corporateCheckOngoing=true;self.corporateCodeForm.submit();}}else{if(corporateCode.val()==""){return true;}}return self.corporateCodeIsCheckedOk;}," ");}var checkDateVar=self.checkDates();dest_inbound.check(function(){if(hasError||checkDateVar.hasError){if(checkDateVar.homeSearchErrors!=""){errorText+=checkDateVar.homeSearchErrors;}}return !hasError&&!checkDateVar.hasError;}," ");if(hasError||checkDateVar.hasError){alert(errorText);}return !hasError&&!checkDateVar.hasError;}else{if(clientSideData.PAGE_CODE=="RD_UPSL"||clientSideData.PAGE_CODE=="UPSL"||clientSideData.PAGE_CODE=="CP_UPSL"){var checkDateVar=self.checkDates();bDate.check(function(){if(checkDateVar.hasError){return false;}return true;});}else{self.checkDates();}search_from.check(function(){$(this).removeClass("em");if(dest_outbound.val()==""||search_from.val()==""){$(this).addClass("em");return false;}else{return true;}},clientMessages["ALLP.error.PleaseFillTheOutbound"]);search_to.check(function(){$(this).removeClass("em");if(dest_inbound.val()==""||search_to.val()==""){$(this).addClass("em");return false;}else{return true;}},clientMessages["ALLP.error.PleaseFillTheInbound"]);tripType.check(function(){var retValue=$("input[name='TRIP_TYPE']:checked",$("form[name='SEARCH_FORM']")).length==0;return !retValue;},clientMessages["ALLP.text.PleaseSelectTheTypeOfTrip"]);}},prepareSubmit:function(){if($("input[name='TRIP_TYPE']:checked").val()!="M"){$("input[name='B_LOCATION_1']").val($("#search_from").attr("data-code"));$("input[name='E_LOCATION_1']").val($("#search_to").attr("data-code"));}var tripType=this.input("TRIP_TYPE");var useMyPoints=this.input("passenger_useMyPoints");var search_adults=this.input("adults");var search_children=this.input("children");var search_infants=this.input("infants");var mcabin=this.input("MARKETING_CABIN");var siteCode="";if(useMyPoints.prop("checked")){siteCode="JJRDJJRD";}else{siteCode="JJBKJJBK";}var previousSiteCode=this.input("SITE").value();if(previousSiteCode!==siteCode){var jSessionIdIndexInURL=this[0].action.toLowerCase().indexOf(";jsessionid");if(-1!==jSessionIdIndexInURL){this[0].action=this[0].action.substr(0,jSessionIdIndexInURL);}}this.input("SITE").value(siteCode);if($("input[name='TRIP_TYPE'][value='M']",$("#SEARCH_FORM")).prop("checked")==false||$("input[name='TRIP_TYPE'][value='M']",$("#SEARCH_FORM")).prop("checked")==undefined){if($("#search_outbound_date").val()==""&&$("#search_inbound_date").val()==""&&$("input[name='TRIP_TYPE'][value='R']",$("#SEARCH_FORM")).prop("checked")){this.input("B_DATE_1").val("");this.input("B_DATE_2").val("");}if($("#search_outbound_dates").val()==""&&$("input[name='TRIP_TYPE'][value='O']",$("#SEARCH_FORM")).prop("checked")){this.input("B_DATE_1").val("");}}var cacheObj=JSON.parse($.jStorage.get("wts"))||{bounds:[]};if(tripType.value()=="M"){for(var i=0;i<4;i++){var bLoc=this.input("B_LOCATION_"+(i+1));var eLoc=this.input("E_LOCATION_"+(i+1));var bDate=this.input("B_DATE_"+(i+1));if($("fieldset#multicityBound"+(i+1)).hasClass("none")==false){if(typeof cacheObj.bounds==="undefined"){cacheObj.bounds={};}cacheObj.bounds[i]={bLocation:bLoc.value(),eLocation:eLoc.value(),bDate:bDate.value()};}else{bLoc.prop("disabled",true);eLoc.prop("disabled",true);bDate.prop("disabled",true);cacheObj.bounds[i]=null;}}}else{var bLoc=this.input("B_LOCATION_1");var eLoc=this.input("E_LOCATION_1");var bDate=this.input("B_DATE_1");if(cacheObj==undefined||cacheObj.bounds==undefined){cacheObj.bounds={};}cacheObj.bounds[10]={bLocation:bLoc.value(),eLocation:eLoc.value(),bDate:bDate.value()};if(tripType.value()=="R"){cacheObj.bounds[11]={bDate:this.input("B_DATE_2").value()};}else{cacheObj.bounds[11]=null;}}var commonDataObj={};commonDataObj["tripType"]=tripType.value();commonDataObj["useMyPoints"]=useMyPoints.value();commonDataObj["adults"]=search_adults.value();commonDataObj["children"]=search_children.value();commonDataObj["infants"]=search_infants.value();commonDataObj["mcabin"]=mcabin.value();if(tripType.value()=="M"){cacheObj["multicityCommon"]=commonDataObj;}else{cacheObj["roundtripCommon"]=commonDataObj;}var searchCookie=JSON.stringify(cacheObj);$.jStorage.set("wts",searchCookie);$("input[name='SEARCH_COOKIE']",$("#SEARCH_FORM")).val(searchCookie);self.saveLastSearchDestinationCookie(this);$.blockUI();isCallOngoing=true;}});if(clientSideData.PAGE_CODE=="HOME_SEARCH"||clientSideData.PAGE_CODE=="SEARCH"||clientSideData.PAGE_CODE=="GENERR"){this.manageBookingForm=wdk.form("MANAGE_BOOKING_FORM",{errorPanel:$("#pageError"),check:function(){$("#bepageError").errorPanel();var searchCode=this.input("REC_LOC");var lastName=this.input("DIRECT_RETRIEVE_LASTNAME");var eTkt=this.input("TICKET_NUMBER");var departureDate=this.input("DEPARTURE_DATE_MANAGE_BOOKING");var hasError=false;var errorText="";if(clientSideData.PAGE_CODE=="HOME_SEARCH"){var selectedManageBooking="pnr";if(clientSideData.ENABLE_RETRIEVE_WITH_ETKT==true){selectedManageBooking=$('[name="radio2"]:checked').val();}if(selectedManageBooking.toLowerCase()=="pnr"){lastName.check(function(){var lastErr=false;if(lastName.val()==""){if(hasError){errorText+=" ";}hasError=true;lastErr=true;errorText+=clientMessages["HOME_SEARCH.text.PleaseFillPassengerFamilyName"];lastName.addClass("em");}return !lastErr;}," ");searchCode.check(function(){var codeErr=false;if(searchCode.val()==""){if(hasError){errorText+=", ";}hasError=true;codeErr=true;errorText+=clientMessages["HOME_SEARCH.text.MissingPTROrETicket"];searchCode.addClass("em");}if(/^[a-z0-9]{5,6}$/gi.test(searchCode.value())==false){if(hasError){errorText+=", ";}hasError=true;codeErr=true;errorText+=clientMessages["HOME_SEARCH.text.InvalidPNRPattern"];searchCode.addClass("em");}return !codeErr;}," ");lastName.check(function(){var lastErr=false;if(lastName.value()==""){if(hasError){errorText+=", ";}hasError=true;errorText+=clientMessages["HOME_SEARCH.text.PleaseFillPassengerFamilyName"];lastErr=true;}return !lastErr;}," ");if(hasError){alert(errorText+".");}return !hasError;}else{eTkt.check(function(){var codeErr=false;if(eTkt.val()==""){if(hasError){errorText+=", ";}hasError=true;codeErr=true;errorText+=clientMessages["HOME_SEARCH.error.PleaseEnterTheEticketNumber"];searchCode.addClass("em");}return !codeErr;}," ");departureDate.check(function(){var lastErr=false;if(departureDate.value()==""){if(hasError){errorText+=", ";}hasError=true;errorText+=clientMessages["HOME_SEARCH.error.PleaseSelectTheDepartureDate"];lastErr=true;}return !lastErr;}," ");if(hasError){alert(errorText+".");}return !hasError;}}else{searchCode.check(function(){return/^[a-z0-9]{5,6}$/gi.test(searchCode.value());},clientMessages["SEARCH.text.InvalidPNRPattern"]);}},prepareSubmit:function(){var selectedManageBooking="pnr";if(clientSideData.ENABLE_RETRIEVE_WITH_ETKT==true){selectedManageBooking=$('[name="radio2"]:checked').val();}if(selectedManageBooking.toLowerCase()=="pnr"){this.input("DEPARTURE_DATE_MANAGE_BOOKING").attr("disabled","disabled");this.input("ETCKT_NUMBER").attr("disabled","disabled");this.input("radio2").attr("disabled","disabled");}else{var date=this.input("DEPARTURE_DATE_MANAGE_BOOKING");if(date.length>0){var tempDate=date.val().split("/");if(tempDate.length!=3&&tempDate.length>0&&tempDate[0]!==""){}else{var tempPatternedDate=tempDate[2]+tempDate[1]+tempDate[0];if(theUtils.isUSMarket()==true){tempPatternedDate=tempDate[2]+tempDate[0]+tempDate[1];}}this.input("DEPARTURE_DATE_MANAGE_BOOKING").value(tempPatternedDate);}this.input("REC_LOC").attr("disabled","disabled");this.input("DIRECT_RETRIEVE_LASTNAME").attr("disabled","disabled");}$.blockUI();isCallOngoing=true;}});this.onlineCheckinForm=wdk.form("ONLINE_CHECKIN_FORM",{errorPanel:$("#pageError"),check:function(){$("#bepageError").errorPanel();var _isTam=(this.input("radio1").value()==="TAM")?true:false;var tam_pnr_number=this.input("PNR_NUMBER");var tam_etckt_number=this.input("ETCKT_NUMBER");var tam_departure_date=this.input("DEPARTURE_DATE");var tam_readTermns=this.input("Acknowledgements_checkbox");var lan_recordLocator=this.input("PNR_NUMBER_LAN");var lan_lastName=this.input("LAST_NAME_LAN");var lan_readTermns=this.input("Acknowledgements_checkbox_lan");var _hasError=false;var _errorText="";var _validationConfig;var _removeError=function(el){el.removeClass("em");};var _addError=function(el){el.addClass("em");};if(clientSideData.PAGE_CODE=="HOME_SEARCH"){_validationConfig={avoidAddingTooltip:true,avoidAddingToPanel:true};}else{_validationConfig={avoidAddingTooltip:true};}var _readTerms;if(_isTam){_readTerms=tam_readTermns;tam_departure_date.check(function(){var _dateRegex;if(theUtils.isUSMarket()){_dateRegex=/^(0?[1-9]|1[012])[\/](0?[1-9]|[12][0-9]|3[01])[\/]\d{4}$/;}else{_dateRegex=/^(0?[1-9]|[12][0-9]|3[01])[\/](0?[1-9]|1[012])[\/]\d{4}$/;}if(!_dateRegex.test(tam_departure_date.value())){_errorText+=(_hasError)?" "+clientMessages[clientSideData.PAGE_CODE+".error.InvalidCheckinDate"]:clientMessages[clientSideData.PAGE_CODE+".error.InvalidCheckinDate"];_hasError=true;_addError(tam_departure_date);return false;}else{_removeError(tam_departure_date);return true;}},clientMessages[clientSideData.PAGE_CODE+".text.PlsSelectDepartureDate"],_validationConfig);tam_departure_date.check(function(){if(tam_departure_date.value()===""){_errorText=clientMessages[clientSideData.PAGE_CODE+".text.PlsSelectDepartureDate"];_hasError=true;_addError(tam_departure_date);return false;}else{if(!_hasError){_removeError(tam_departure_date);return true;}}},clientMessages[clientSideData.PAGE_CODE+".text.InvalidCheckinDate"],_validationConfig);tam_pnr_number.check(function(){if(tam_pnr_number.value()!=""&&!/^[a-z0-9]{5,6}$/gi.test(tam_pnr_number.value())){_errorText+=(_hasError)?" "+clientMessages[clientSideData.PAGE_CODE+".text.InvalidPNRPattern"]:clientMessages[clientSideData.PAGE_CODE+".text.InvalidPNRPattern"];_hasError=true;_addError(tam_pnr_number);_removeError(tam_etckt_number);return false;}else{if(tam_pnr_number.value()==""&&tam_etckt_number.value()==""){_errorText+=(_hasError)?" "+clientMessages[clientSideData.PAGE_CODE+".text.MissingPTROrETicket"]:clientMessages[clientSideData.PAGE_CODE+".text.MissingPTROrETicket"];_hasError=true;_addError(tam_pnr_number);_addError(tam_etckt_number);return false;}else{_removeError(tam_pnr_number);_removeError(tam_etckt_number);return true;}}},clientMessages[clientSideData.PAGE_CODE+".text.MissingPTROrETicket"],_validationConfig);}else{_readTerms=lan_readTermns;lan_recordLocator.check(function(){if(!/^[a-z0-9]{5,6}$/gi.test(lan_recordLocator.value())){_errorText+=(_hasError)?" "+clientMessages[clientSideData.PAGE_CODE+".text.InvalidPNRPattern"]:clientMessages[clientSideData.PAGE_CODE+".text.InvalidPNRPattern"];_hasError=true;_addError(lan_recordLocator);return false;}else{_removeError(lan_recordLocator);return true;}},clientMessages[clientSideData.PAGE_CODE+".text.InvalidPNRPattern"],_validationConfig);lan_lastName.check(function(){if(lan_lastName.value()===""){_errorText+=(_hasError)?" "+clientMessages[clientSideData.PAGE_CODE+".text.PleaseFillPassengerFamilyName"]:clientMessages[clientSideData.PAGE_CODE+".text.PleaseFillPassengerFamilyName"];_hasError=true;_addError(lan_lastName);return false;}else{_removeError(lan_lastName);return true;}},clientMessages[clientSideData.PAGE_CODE+".text.PleaseFillPassengerFamilyName"],_validationConfig);}_readTerms.check(function(){if(_readTerms.value()=="on"){_readTerms.closest("label").removeClass("em");return true;}else{_readTerms.closest("label").addClass("em");_errorText+=(_hasError)?" "+clientMessages[clientSideData.PAGE_CODE+".text.PleaseAcceptTermsConditions"]:clientMessages[clientSideData.PAGE_CODE+".text.PleaseAcceptTermsConditions"];_hasError=true;return false;}},clientMessages[clientSideData.PAGE_CODE+".text.PleaseAcceptTermsConditions"],_validationConfig);if(_hasError){if(clientSideData.PAGE_CODE=="HOME_SEARCH"){alert(_errorText);}return false;}return true;},prepareSubmit:function(){var selectedAirline=$('[name="radio1"]:checked',$("form[name='ONLINE_CHECKIN_FORM']")).val();theUtils.setCookiesInUrl($("form[name='ONLINE_CHECKIN_FORM']"));if(selectedAirline.toLowerCase()=="tam"){var pnrValue=$.trim(this.input("PNR_NUMBER").value());var eTicketValue=$.trim(this.input("ETCKT_NUMBER").value());if(pnrValue.length>0){this.input("IDENTIFICATION_TYPE").value("PNR");this.input("REC_LOC").value(pnrValue);}else{this.input("IDENTIFICATION_TYPE").value("ETKT");this.input("REC_LOC").value(eTicketValue);}this.input("DEPARTURE_DATE").attr("disabled","disabled");this.input("PNR_NUMBER").attr("disabled","disabled");this.input("ETCKT_NUMBER").attr("disabled","disabled");this.input("pnr").attr("disabled","disabled");this.input("apellido").attr("disabled","disabled");this.input("forced_home").attr("disabled","disabled");this.input("radio1").attr("disabled","disabled");this.input("ETCKT_NUMBER").attr("disabled","disabled");this.input("Acknowledgements_checkbox").attr("disabled","disabled");this.input("WDS_NAVIGATION_TAB").attr("disabled","disabled");}else{var pnrValue=$.trim(this.input("PNR_NUMBER_LAN").value());var lastNameValue=$.trim(this.input("LAST_NAME_LAN").value());this.input("pnr").value(pnrValue);this.input("apellido").value(lastNameValue);this.input("ln").attr("disabled","disabled");this.input("SITE").attr("disabled","disabled");this.input("WDS_MARKET").attr("disabled","disabled");this.input("LANGUAGE").attr("disabled","disabled");this.input("CHECKIN_DEPARTURE_DATE").attr("disabled","disabled");this.input("IDENTIFICATION_TYPE").attr("disabled","disabled");this.input("REC_LOC").attr("disabled","disabled");this.input("radio1").attr("disabled","disabled");this.input("DEPARTURE_DATE").attr("disabled","disabled");this.input("PNR_NUMBER_LAN").attr("disabled","disabled");this.input("ETCKT_NUMBER").attr("disabled","disabled");this.input("LAST_NAME_LAN").attr("disabled","disabled");this.input("Acknowledgements_checkbox_lan").attr("disabled","disabled");this.input("Acknowledgements_checkbox").attr("disabled","disabled");this.input("WDS_NAVIGATION_TAB").attr("disabled","disabled");this.input("__utma").attr("disabled","disabled");this.input("__utmb").attr("disabled","disabled");this.input("__utmc").attr("disabled","disabled");this.input("__utmx").attr("disabled","disabled");this.input("__utmz").attr("disabled","disabled");this.input("__utmv").attr("disabled","disabled");this.input("__utmk").attr("disabled","disabled");}_gaq.push(["_linkByPost",this]);$.blockUI();isCallOngoing=true;}});}this.getPassengersLimit=function(){return parseInt(clientMessages["GLBL.text.PASSENGERS_LIMIT"],10);};this.corporateCodeForm=wdk.form("CORPORATE_CODE_FORM",{ajaxSubmit:true,ajaxOptions:{dataType:"json",success:function(json){if(json.mapDataUI.PROMOCODE_VALIDATION.CORPORATE_CODE_VALIDATION=="KO"){self.corporateCodeIsCheckedOk=false;$("#search_promo").val("");if(clientSideData.PAGE_CODE=="SEARCH"){wdk.form("CORPORATE_CODE_FORM").wdkform("option","errorPanel").errorPanel("addError",null,null,json.mapDataUI.PROMOCODE_VALIDATION.CORPORATE_CODE_VALIDATION_ERROR);$("body").scrollTop(0);}else{alert(json.mapDataUI.PROMOCODE_VALIDATION.CORPORATE_CODE_VALIDATION_ERROR);}self.corporateCodeManagerCpt++;if(self.corporateCodeManagerCpt==3){$("#promocodebox").remove();}$("#passenger_useMyPoints").removeAttr("disabled");$("#passenger_useMyPoints").parents("p").eq(0).removeClass("none");$("input[name='CORPORATE_CODE']","#CORPORATE_CODE_FORM").val("");}else{self.corporateCodeIsCheckedOk=true;$("#passenger_useMyPoints").attr("disabled","disabled");$("#passenger_useMyPoints").parents("p").eq(0).addClass("none");}self.corporateCheckOngoing=false;},error:function(){}},errorPanel:$("#pageError")});this.listen();}Search.prototype.defaultConfObj={"trigger":"passenger_useMyPoints","cab":"MARKETING_CABIN","formName":"SEARCH_FORM"};Search.prototype.isRedemptionCheckbox=$("#passenger_useMyPoints");Search.prototype.cabinOptionsList={"cabins":{"redemption":clientSideData.WDS_MARKETING_CABINS_REDEMPTION,"revenue":clientSideData.WDS_MARKETING_CABINS_REVENUE}};Search.prototype.prepareCacheObjForDeeplink=function(){if(document.referrer==""||document.referrer.indexOf("EscolherVooHorario")!=-1||document.referrer.indexOf(clientSideData.WDS_WEBAPP_URL)!=-1||document.referrer.indexOf(clientSideData.PORTAL_DOMAIN.replace("www.",""))){var commonDataObj={};if(clientSideData.ENTRY_REQUEST.TRIP_TYPE!=undefined){commonDataObj["tripType"]=clientSideData.ENTRY_REQUEST.TRIP_TYPE;}if(clientSideData.ENTRY_REQUEST.passenger_useMyPoints!=undefined){commonDataObj["useMyPoints"]=clientSideData.ENTRY_REQUEST.passenger_useMyPoints;}if(clientSideData.ENTRY_REQUEST.adults!=undefined){commonDataObj["adults"]=clientSideData.ENTRY_REQUEST.adults;}if(clientSideData.ENTRY_REQUEST.children!=undefined){commonDataObj["children"]=clientSideData.ENTRY_REQUEST.children;}if(clientSideData.ENTRY_REQUEST.infants!=undefined){commonDataObj["infants"]=clientSideData.ENTRY_REQUEST.infants;}if(clientSideData.ENTRY_REQUEST.MARKETING_CABIN!=undefined){commonDataObj["mcabin"]=clientSideData.ENTRY_REQUEST.MARKETING_CABIN;}if(clientSideData.ENTRY_REQUEST.B_LOCATION_1!=undefined&&clientSideData.ENTRY_REQUEST.E_LOCATION_1!=undefined&&clientSideData.ENTRY_REQUEST.B_DATE_1!=undefined){var cacheObj=JSON.parse($.jStorage.get("wts"))||{bounds:[]};if(typeof cacheObj.bounds==="undefined"){cacheObj.bounds={};}cacheObj.bounds[10]={bLocation:clientSideData.ENTRY_REQUEST.B_LOCATION_1,eLocation:clientSideData.ENTRY_REQUEST.E_LOCATION_1,bDate:clientSideData.ENTRY_REQUEST.B_DATE_1};if(clientSideData.ENTRY_REQUEST.B_DATE_2!=undefined){cacheObj.bounds[11]={bDate:clientSideData.ENTRY_REQUEST.B_DATE_2};}cacheObj["roundtripCommon"]=commonDataObj;var searchCookie=JSON.stringify(cacheObj);$.jStorage.set("wts",searchCookie);}}};Search.prototype.saveCacheObjForAwardPromo=function(){var commonDataObj={};var cacheObj={bounds:[]};commonDataObj["useMyPoints"]="true";cacheObj["multicityCommon"]=commonDataObj;cacheObj["roundtripCommon"]=commonDataObj;var searchCookie=JSON.stringify(cacheObj);$.jStorage.set("wts",searchCookie);};Search.prototype.saveLastSearchDestinationCookie=function(searchForm){var d=new Date();d.setTime(d.getTime()+(30*24*60*60*1000));var expires="expires="+d.toGMTString();document.cookie="DWM_LAST_SEARCH_DESTINATION="+searchForm.input("E_LOCATION_1").value()+"; "+expires+"; path=/";};Search.prototype.saveCacheObj=function(){var tripType=this.onlineSearchForm.input("TRIP_TYPE");var useMyPoints=this.onlineSearchForm.input("passenger_useMyPoints");var search_adults=this.onlineSearchForm.input("adults");var search_children=this.onlineSearchForm.input("children");var search_infants=this.onlineSearchForm.input("infants");var marketingCabin=this.onlineSearchForm.input("MARKETING_CABIN");var cacheObj=JSON.parse($.jStorage.get("wts"))||{bounds:[]};if(typeof cacheObj.bounds==="undefined"){cacheObj.bounds={};}if(tripType.value()=="M"){for(var i=0;i<4;i++){var bLoc=this.onlineSearchForm.input("B_LOCATION_"+(i+1));var eLoc=this.onlineSearchForm.input("E_LOCATION_"+(i+1));var bDate=this.onlineSearchForm.input("B_DATE_"+(i+1));if($("fieldset#multicityBound"+(i+1)).hasClass("none")==false){cacheObj.bounds[i]={bLocation:bLoc.value(),eLocation:eLoc.value(),bDate:bDate.value()};}else{bLoc.prop("disabled",true);eLoc.prop("disabled",true);bDate.prop("disabled",true);cacheObj.bounds[i]=null;}}}else{var bLoc=this.onlineSearchForm.input("B_LOCATION_1");var eLoc=this.onlineSearchForm.input("E_LOCATION_1");var bDate=this.onlineSearchForm.input("B_DATE_1");if(cacheObj==undefined||cacheObj.bounds==undefined){cacheObj.bounds={};}cacheObj.bounds[10]={bLocation:bLoc.value(),eLocation:eLoc.value(),bDate:bDate.value()};if(tripType.value()=="R"){cacheObj.bounds[11]={bDate:this.onlineSearchForm.input("B_DATE_2").value()};}else{cacheObj.bounds[11]=null;}}cacheObj["tripType"]=tripType.value();var commonDataObj={};commonDataObj["useMyPoints"]=useMyPoints.value();commonDataObj["adults"]=search_adults.value();commonDataObj["children"]=search_children.value();commonDataObj["infants"]=search_infants.value();commonDataObj["mcabin"]=marketingCabin.value();if(tripType.value()=="M"){cacheObj["multicityCommon"]=commonDataObj;}else{cacheObj["roundtripCommon"]=commonDataObj;}var searchCookie=JSON.stringify(cacheObj);$.jStorage.set("wts",searchCookie);$("input[name='SEARCH_COOKIE']",$("#SEARCH_FORM")).val(searchCookie);};Search.prototype.init=function(){var self=this;this.manageTabsNavigation();this.initMultiCityLink("MULTICITY_FORM","multiCityLink");this.initDatePickers("SEARCH_FORM");$("#onlineSearchSubmitButton").unbind("click");$("#onlineSearchSubmitButton").click(function(e){if(($("#passenger_useMyPoints").prop("checked")&&clientSideData.SITE=="JJBKJJBK")||(!$("#passenger_useMyPoints").prop("checked")&&clientSideData.SITE=="JJRDJJRD")){$("<input />").attr("type","hidden").attr("name","initial_referrer").attr("value",clientSideData.initial_referrer).appendTo("#SEARCH_FORM");}if($("input[name='TRIP_TYPE']:checked",$("form[name='SEARCH_FORM']")).val()=="M"){var multicityValidation=multicitySearch.validateBounds();if(multicityValidation==true){multicitySearch.submitMulticity();}}else{$("#SEARCH_FORM").submit();}});if(clientSideData.SHOW_REGISTRATION_POPIN){$("#successful_registration_popin").dialog({autoOpen:true,draggable:false,width:640,modal:true,resizable:false});$("#ebuyerRegistrationSuccessPopinClose").on("click",function(){$("#successful_registration_popin").dialog("close");});}$(document).delegate("#SEARCH_FORM","submit",function(e){var form=wdk.form("SEARCH_FORM");var options=form.wdkform("option");var hasValidationErrors=options.errorPanel.errorPanel("hasError");if(!hasValidationErrors){var useMyPointsCheck=$("[id='passenger_useMyPoints']").attr("checked")!=null;var isRoundTripOrOneWay=$("input[name='TRIP_TYPE']:checked",$("form[name='SEARCH_FORM']")).val()!="M";if(clientSideData.SWITCH_TO_FULLPOINTS_ENABLED&&useMyPointsCheck&&!self.isWdsFlowswitchPopinClosed&&isRoundTripOrOneWay&&!clientSideData.IS_FULL_POINTS_SITE){e.preventDefault();e.stopImmediatePropagation();$.unblockUI();window.wdsFlowswitchPopin.openDialog({callback:function(){self.isWdsFlowswitchPopinClosed=true;var searchForm=$("#SEARCH_FORM");searchForm.submit();}});self.isWdsFlowswitchPopinClosed=false;}}});$("#manageBookingSubmitButton").unbind("click");$("#manageBookingSubmitButton").click(function(){$("#MANAGE_BOOKING_FORM").submit();});$("#ONLINE_CHECKIN_FORM input:disabled").prop("disabled",false).filter(":not(input[name=radio1])").first().prop("checked",true);$("#checkin").unbind("click");$("#checkin").click(function(){$("#ONLINE_CHECKIN_FORM").submit();});if($.browser.msie&&parseInt($.browser.version,10)==7){setTimeout(function(){$("#MARKETING_CABIN").selectBox("destroy").selectBox();},1);}if(clientSideData["REQUESTED_REC_LOC"]!=null&&clientSideData["REQUESTED_REC_LOC"]!=undefined){$("input[name='REC_LOC']").val(clientSideData["REQUESTED_REC_LOC"]);}if(clientSideData["REQUESTED_LAST_NAME"]!=null&&clientSideData["REQUESTED_LAST_NAME"]!=undefined){$("input[name='DIRECT_RETRIEVE_LASTNAME']").val(clientSideData["REQUESTED_LAST_NAME"]);}};Search.prototype.listen=function(){var self=this;this.manageTabsNavigationListeners();if(clientSideData.PAGE_CODE=="HOME_SEARCH"||clientSideData.PAGE_CODE=="SEARCH"||clientSideData.PAGE_CODE=="GENERR"){this.toggleLanTamCheckin();this.toggleManageBooking();this.initCheckinOnlinePicker();this.initManageBookingPicker();this.bindDynamicValidation();}this.bindDestPickers();if(clientSideData.PAGE_CODE=="SEARCH"||clientSideData.PAGE_CODE=="GENERR"){this.bindMulticityDestpickers();}this.bindLinks();this.initTripTypeManager("SEARCH_FORM");this.initPassengersManager();if(typeof clientSideData.CALLEE!=="undefined"&&clientSideData.CALLEE.COMMING_FROM_AFFINITY==="TRUE"){var cacheObj=JSON.parse($.jStorage.get("wts"))||{bounds:[]};var paxes=theUtils.checkPaxTypeAmount(clientSideData.CALLEE);cacheObj["inbound"]=clientSideData.CALLEE.AFFINITY_SEARCH_PARAMETER_E_LOCATION_1;cacheObj["tripType"]=clientSideData.CALLEE.TRIP_TYPE;cacheObj["outbound"]=clientSideData.CALLEE.AFFINITY_SEARCH_PARAMETER_B_LOCATION_1;cacheObj["useMyPoints"]=clientSideData.CALLEE.passenger_useMyPoints;cacheObj["adults"]=paxes.ADT;cacheObj["children"]=paxes.CHD;cacheObj["infants"]=paxes.INF;cacheObj["cff"]=clientSideData.CALLEE.AFFINITY_SEARCH_PARAMETER_FARE_FAMILY_1;cacheObj["bDate"]=clientSideData.CALLEE.AFFINITY_SEARCH_PARAMETER_B_DATE_1;commingBDate=clientSideData.CALLEE.AFFINITY_SEARCH_PARAMETER_B_DATE_2;if(typeof commingBDate!=="undefined"){cacheObj["eDate"]=commingBDate;}var searchCookie=JSON.stringify(cacheObj);$.jStorage.set("wts",searchCookie);$("input[name='SEARCH_COOKIE']",$("#SEARCH_FORM")).val(searchCookie);}var preselectedTab=clientSideData["PRESELECTED_TRIP_TYPE"];if(typeof multicitySearch!="undefined"){multicitySearch.init();}if(clientSideData.IS_COMPANION_FLOW==false){this.initCorporateCodeManager();if(clientSideData.PAGE_CODE=="HOME_SEARCH"||clientSideData.PAGE_CODE=="SEARCH"||clientSideData.PAGE_CODE=="GENERR"){self.fillFormWithCookies();}else{var now=new Date();var bDate=$("#SEARCH_FORM input[name='B_DATE_1']").val();if(bDate!=null&&bDate!=""){var bDatepick=new Date(bDate.substring(0,4)+"/"+bDate.substring(4,6)+"/"+bDate.substring(6,8));if(bDatepick<now){bDatepick=now;bDate=dateFormat(now,clientMessages["GLBL.pattern.AeREDateYearMonthDay"])+"0000";}$("#search_outbound_date").datepicker("setDate",bDatepick);}var eDate=$("#SEARCH_FORM input[name='B_DATE_2']").val();if(eDate!=null&&eDate!=""){var eDatepick=new Date(eDate.substring(0,4)+"/"+eDate.substring(4,6)+"/"+eDate.substring(6,8));if(eDatepick<now){eDatepick=now;eDate=dateFormat(now,clientMessages["GLBL.pattern.AeREDateYearMonthDay"])+"0000";}$("#search_inbound_date").datepicker("setDate",eDatepick);}this.initUseMyPointsManager(this.defaultConfObj);if(clientSideData.PAGE_CODE=="CP_UPSL"){$("input[name='TRIP_TYPE'][value='R']",$("#SEARCH_FORM")).trigger("click");}else{$("#SEARCH_FORM input[name='TRIP_TYPE']").filter(":checked").trigger("click");}}}else{if(!clientSideData.HOTEL_FLOW&&!clientSideData.CAR_FLOW){this.initUseMyPointsManager({"trigger":"passenger_useMyPoints","cab":"MARKETING_CABIN","formName":"SEARCH_FORM"});}}$("span.selectBox-arrowOnInput").click(function(e){if($(this).prev().prop("disabled")==false){destinationPickerHelper.destPickerOpened=false;$(this).prev().focus();$(this).prev().trigger("click");}});if((clientSideData.PAGE_CODE=="HOME_SEARCH"||clientSideData.PAGE_CODE=="SEARCH"||clientSideData.PAGE_CODE=="GENERR")&&(typeof clientSideData["WDS_NAVIGATION_TAB"]!="undefined"&&clientSideData["WDS_NAVIGATION_TAB"]!=null)){this.manageTabsNavigation(clientSideData["WDS_NAVIGATION_TAB"]);}if(preselectedTab=="multicity"){$("input[name='TRIP_TYPE'][value='M']",$("form[name='SEARCH_FORM']")).prop("checked",true).click();}else{if(preselectedTab=="oneway"){$("input[name='TRIP_TYPE'][value='O']",$("form[name='SEARCH_FORM']")).prop("checked",true).click();}}};Search.prototype.bindMulticityDestpickers=function(){var multicityBounds=new Array();for(var i=1;i<5;i++){multicityBounds[i]=new destinationPicker();multicityBounds[i].init("multicity_search_from_"+i,"multicity_search_to_"+i,i,"multicity_search_date_"+i);multicityBounds[i].bindDestPickers();multicityBounds[i].bindAirportSelection();}};Search.prototype.setDisabledProperty=function(disable){var self=this;var tripType=$("input[name='TRIP_TYPE']:checked","form#SEARCH_FORM").val();if(tripType=="O"){self.disableRoundTripInputs(!disable);$("#search_inbound_date").prop("disable",disable);}else{if(tripType=="R"){self.disableRoundTripInputs(!disable);}else{if(tripType=="M"){self.disableRoundTripInputs(disable);multicitySearch.disableOrEnableFields();}}}};Search.prototype.disableRoundTripInputs=function(disable){var roundtripInputs=[];roundtripInputs[0]="#search_inbound_date";roundtripInputs[1]="#search_outbound_date";roundtripInputs[2]="#search_from";roundtripInputs[3]="#search_to";for(var i=0;i<roundtripInputs.length;i++){$(roundtripInputs[i]).prop("disabled",disable);}};Search.prototype.disableMultiCityInputs=function(disable){var multicityInputs=[];multicityInputs[0]="#multicity_search_from_1";multicityInputs[1]="#multicity_search_to_1";multicityInputs[2]="#multicity_search_date_1";multicityInputs[3]="#multicity_search_from_2";multicityInputs[4]="#multicity_search_to_2";multicityInputs[5]="#multicity_search_date_2";multicityInputs[6]="#multicity_search_from_3";multicityInputs[7]="#multicity_search_to_3";multicityInputs[8]="#multicity_search_date_3";multicityInputs[9]="#multicity_search_from_4";multicityInputs[10]="#multicity_search_to_4";multicityInputs[11]="#multicity_search_date_4";for(var i=0;i<multicityInputs.length;i++){$(multicityInputs[i]).prop("disabled",disable);}};Search.prototype.bindLinks=function(){var self=this;$("#moreThan9Passengers").click(function(){window.open(clientMessages["ALLP.text.url.MoreNinePassengers"]);return false;});$("#multiCityLink").click(function(){$.blockUI();window.setTimeout(function(){$("form[name='MULTICITY_FORM']").submit();},500);});$("#multiCityWDSLink").click(function(){$.blockUI();window.setTimeout(function(){$("form[name='GO_TO_SEARCH_MTCT']").submit();},500);});$("#affinityLink").click(function(){$.blockUI();$("form[id='affinityRedemptionForm']").submit();});$("#affinityRevenueLink").click(function(){$.blockUI();$("form[id='affinityRevenueForm']").submit();});$("#passenger_useMyPoints").click(function(){self.checkAndUpdateSite();});$("#promocodelink").click(function(){var form=$("form[id='awardPromocodeForm']");if(form.length==0){$("#promocodeLink")[0].click();}else{self.saveCacheObjForAwardPromo();form.submit();}});};Search.prototype.checkAndUpdateSite=function(){var self=this;self.initUseMyPointsManager({"trigger":"passenger_useMyPoints","cab":"MARKETING_CABIN","formName":"SEARCH_FORM"});};Search.prototype.initTripTypeManager=function(formId){var self=this;var formDOM=$("form[id='"+formId+"']");var alreadyPrefilled={roundTrip:false,multicity:false};$("input#roundtrip",formDOM).click(function(){self.setDisabledProperty(true);$("input[name='TRIP_TYPE'][value='O'],input[name='TRIP_TYPE'][value='M']",formDOM).removeAttr("checked");$("input[name='TRIP_TYPE'][value='R']",formDOM).attr("checked","checked");$("fieldset#originAndDestination, fieldset#selectTripDates, #moreThan9Passengers").removeClass("none");$("fieldset#multicitySearch").addClass("none");$("input[name='B_LOCATION_2'], input[name='B_LOCATION_3'], input[name='B_LOCATION_4'], input[name='E_LOCATION_2'], input[name='E_LOCATION_3'], input[name='E_LOCATION_4'], input[name='B_DATE_3'], input[name='B_DATE_4']",formDOM).attr("disabled","disabled");$("input[name='B_DATE_2']",formDOM).removeAttr("disabled");$("#search_inbound_date, #search_outbound_date",formDOM).prop("disabled",false);$("#search_inbound_date, #search_outbound_date",formDOM).removeClass("disabled");$("#useMyPointsWrapper, #promocodebox").removeClass("none");$("input[name='passenger_useMyPoints']",formDOM).removeAttr("disabled");$("#search_inbound_date_ico").show();$("#search_inbound_date").next(".ui-datepicker-trigger").show();if($("#search_outbound_date").val()){$("#search_inbound_date").datepicker("option","defaultDate",$("#search_outbound_date").datepicker("getDate"));}$("legend","fieldset#numberOfPassengers").text(function(i,text){return text.replace("3","4");});self.checkAndUpdateSite();if(!alreadyPrefilled.roundTrip&&(clientSideData.IS_COMPANION_FLOW==false&&clientSideData.PAGE_CODE=="HOME_SEARCH"||clientSideData.PAGE_CODE=="SEARCH"||clientSideData.PAGE_CODE=="GENERR")){self.fillBoundsWithCookies();alreadyPrefilled.roundTrip=true;}self.checkAndUpdateSite();});$("input#oneway",formDOM).click(function(){self.setDisabledProperty(true);$("input[name='TRIP_TYPE'][value='R'],input[name='TRIP_TYPE'][value='M']",formDOM).removeAttr("checked");$("input[name='TRIP_TYPE'][value='O']",formDOM).attr("checked","checked");$("fieldset#originAndDestination, fieldset#selectTripDates, #moreThan9Passengers").removeClass("none");$("fieldset#multicitySearch").addClass("none");$("input[name='B_DATE_2']",formDOM).attr("disabled","disabled").val("");$("#search_outbound_date, input[name='B_DATE_1']",formDOM).removeAttr("disabled");$("input[name='B_LOCATION_2'], input[name='B_LOCATION_3'], input[name='B_LOCATION_4'], input[name='E_LOCATION_2'], input[name='E_LOCATION_3'], input[name='E_LOCATION_4'], input[name='B_DATE_3'], input[name='B_DATE_4']",formDOM).attr("disabled","disabled");$("#search_inbound_date",formDOM).attr("disabled","disabled");$("#useMyPointsWrapper, #promocodebox").removeClass("none");$("input[name='passenger_useMyPoints']",formDOM).removeAttr("disabled");$("#search_inbound_date",formDOM).addClass("disabled").removeClass("em").parents("label").removeClass("em");$("#search_inbound_date",formDOM).val("");$("#search_inbound_date",formDOM).prop("disabled",true);$("#search_inbound_date").next(".ui-datepicker-trigger").hide();$("legend","fieldset#numberOfPassengers").text(function(i,text){return text.replace("3","4");});self.checkAndUpdateSite();if(!alreadyPrefilled.roundTrip&&(clientSideData.IS_COMPANION_FLOW==false&&clientSideData.PAGE_CODE=="HOME_SEARCH"||clientSideData.PAGE_CODE=="SEARCH"||clientSideData.PAGE_CODE=="GENERR")){self.fillBoundsWithCookies();alreadyPrefilled.roundTrip=true;}self.checkAndUpdateSite();});$("input#multicity",formDOM).click(function(){$("input[name='TRIP_TYPE'][value='R'],input[name='TRIP_TYPE'][value='O']",formDOM).removeAttr("checked");$("input[name='TRIP_TYPE'][value='M']",formDOM).attr("checked","checked");$("fieldset#multicitySearch").removeClass("none");$("fieldset#originAndDestination, fieldset#selectTripDates, #moreThan9Passengers").addClass("none");$("input[name='B_DATE_1'], input[name='B_DATE_2']",formDOM).removeAttr("disabled","disabled");$("input[name='B_LOCATION_2'], input[name='B_LOCATION_3'], input[name='B_LOCATION_4'], input[name='E_LOCATION_2'], input[name='E_LOCATION_3'], input[name='E_LOCATION_4'], input[name='B_DATE_3'], input[name='B_DATE_4']",formDOM).removeAttr("disabled","disabled");$("#search_inbound_date, #search_outbound_date",formDOM).attr("disabled","disabled");$("legend","fieldset#numberOfPassengers").text(function(i,text){return text.replace("4","3");});$("#useMyPointsWrapper, #promocodebox").addClass("none");$("input[name='passenger_useMyPoints']",formDOM).attr("disabled","disabled");if(!alreadyPrefilled.multicity&&(clientSideData.IS_COMPANION_FLOW==false&&clientSideData.PAGE_CODE=="HOME_SEARCH"||clientSideData.PAGE_CODE=="SEARCH"||clientSideData.PAGE_CODE=="GENERR")){self.fillBoundsWithCookies();alreadyPrefilled.multicity=true;}self.configureMarketingCabin();});if(clientSideData.IS_COMPANION_FLOW==true){$("input[name='TRIP_TYPE']:checked",formDOM).click();}};Search.prototype.initCorporateCodeManager=function(){var self=this;self.corporateCheckOngoing=false;if(!clientSideData["IS_CORPORATE_FLOW"]){$("#search_promo").blur(function(){if($("#search_promo").val()!==""){$(this).val($.trim($("#search_promo").val().toUpperCase()));if($("#search_promo").val()!==""){self.corporateCheckOngoing=true;$("input[name='CORPORATE_CODE']","#CORPORATE_CODE_FORM").val($(this).val());self.corporateCodeForm.submit();}}else{$("#passenger_useMyPoints").removeAttr("disabled");$("#passenger_useMyPoints").parents("p").eq(0).removeClass("none");$("input[name='CORPORATE_CODE']","#CORPORATE_CODE_FORM").val("");}return false;});}$("#search_promo").bind({"keyup":function(event){var fieldValue=$(this).val().toUpperCase();var result="";for(var i=0;i<fieldValue.length;i++){var keyCode=fieldValue.charCodeAt(i);if((keyCode>64&&keyCode<91)||(keyCode>96&&keyCode<123)||keyCode==8||keyCode==9||keyCode==32||(keyCode>=48&&keyCode<=57)){result+=fieldValue.charAt(i);}}$(this).val(result);}});};Search.prototype.initPassengersManager=function(){var self=this;var formDOM=$("form[name='SEARCH_FORM']");var adultsSelect=$(formDOM).find("#adults");var childrenSelect=$(formDOM).find("#children");var infantsSelect=$(formDOM).find("#infants");$(adultsSelect).change(function(){var adults=$(this).val();var children=$(childrenSelect).val();var infants=$(infantsSelect).val();var infs=(adults==9)?9:~~(adults)+1;var maxChdNo=((self.getPassengersLimit()+1)-adults)>self.getChildrenLimitMax()?self.getChildrenLimitMax()+1:(self.getPassengersLimit()+1)-adults;$(childrenSelect).find("option").remove();for(var i=0;i<maxChdNo;i++){$(childrenSelect).append("<option value='"+i+"'>"+i+"</option>");}$(childrenSelect).selectBox("destroy").selectBox();$(childrenSelect).selectBox("value",children);$(infantsSelect).find("option").remove();for(var i=0;i<infs;i++){$(infantsSelect).append("<option value='"+i+"'>"+i+"</option>");}$(infantsSelect).selectBox("destroy").selectBox();$(infantsSelect).selectBox("value",infants);});$(childrenSelect).change(function(){var adults=$(adultsSelect).val();var children=$(this).val();var infants=$(infantsSelect).val();var infs=~~(adults)+1;var maxAdtNo=(self.getAdultsLimitMax()+1)-children;$(adultsSelect).find("option").remove();for(var i=self.getAdultsLimitMin();i<maxAdtNo;i++){$(adultsSelect).append("<option value='"+i+"'>"+i+"</option>");}$(adultsSelect).selectBox("destroy").selectBox();$(adultsSelect).selectBox("value",adults);$(infantsSelect).find("option").remove();for(var i=0;i<infs;i++){$(infantsSelect).append("<option value='"+i+"'>"+i+"</option>");}$(infantsSelect).selectBox("destroy").selectBox();$(infantsSelect).selectBox("value",infants);});$(adultsSelect).trigger("change");$(adultsSelect).selectBox("destroy").selectBox();};Search.prototype.getChildrenLimitMax=function(){return clientSideData.WDS_CUSTOM_CHILD_LIMIT;};Search.prototype.getChildrenLimitMin=function(){return 0;};Search.prototype.getAdultsLimitMax=function(){return clientSideData.WDS_CUSTOM_ADULT_LIMIT;};Search.prototype.getAdultsLimitMin=function(){return clientSideData.WDS_ADULT_LIMIT_MIN;};Search.prototype.bindDynamicValidation=function(){var onlineCheckinForm=$("form[name='ONLINE_CHECKIN_FORM']");Search.prototype.makeAccentlessField.call(onlineCheckinForm,onlineCheckinForm,"PNR_NUMBER",true,false);Search.prototype.makeAccentlessField.call(onlineCheckinForm,onlineCheckinForm,"ETCKT_NUMBER",true,false);if(clientSideData.WDS_DISABLE_LAN_CHECKIN==false){Search.prototype.makeAccentlessField.call(onlineCheckinForm,onlineCheckinForm,"PNR_NUMBER_LAN",true,false);Search.prototype.makeAccentlessField.call(onlineCheckinForm,onlineCheckinForm,"LAST_NAME_LAN",true,false);}var manageBookingForm=$("form[name='MANAGE_BOOKING_FORM']");Search.prototype.makeAccentlessField.call(manageBookingForm,manageBookingForm,"REC_LOC",true,false);Search.prototype.makeAccentlessField.call(manageBookingForm,manageBookingForm,"DIRECT_RETRIEVE_LASTNAME",true,true);Search.prototype.makeAccentlessField.call(manageBookingForm,manageBookingForm,"TICKET_NUMBER",true,true);};Search.prototype.makeAccentlessField=function(targetForm,targetField,acceptNumbers,acceptSpace){targetForm.find("input[name='"+targetField+"']").bind({"keypress":function(event){var key=String.fromCharCode(event.charCode||event.keyCode).ignoreAccent();var keyCode=key.charCodeAt(0);if(!((keyCode>64&&keyCode<91)||(keyCode>96&&keyCode<123)||keyCode==8||keyCode==9||(acceptSpace&&keyCode==32)||keyCode==37||keyCode==39||(acceptNumbers&&keyCode>=48&&keyCode<=57))){event.preventDefault();}},"keyup":function(event){var fieldValue=$(this).val().ignoreAccent().toUpperCase();var result="";for(var i=0;i<fieldValue.length;i++){var keyCode=fieldValue.charCodeAt(i);if((keyCode>64&&keyCode<91)||(keyCode>96&&keyCode<123)||keyCode==8||keyCode==9||(acceptSpace&&keyCode==32)||(acceptNumbers&&keyCode>=48&&keyCode<=57)){result+=fieldValue.charAt(i);}}$(this).val(result);}});};Search.prototype.toggleLanTamCheckin=function(){var self=this;var buttonOnlineCheckinChangeAirline=$("input[name='radio1']",$("#home_checkin, #onlineCheckinPanel"));var buttonToBeClicked=$("input[name='radio1'][checked='checked']",$("#home_checkin, #onlineCheckinPanel"));this.manageOnlineCheckinFields(buttonToBeClicked);buttonOnlineCheckinChangeAirline.click(function(){self.manageOnlineCheckinFields(this);});};Search.prototype.toggleManageBooking=function(){var self=this;var buttonManageBooking=$("input[name='radio2']",$("#home_manage, #manageBookingPanel"));var buttonToBeClicked=$("input[name='radio2'][checked='checked']",$("#home_manage, #manageBookingPanel"));this.manageBookingFields(buttonToBeClicked);buttonManageBooking.click(function(){self.manageBookingFields(this);});};Search.prototype.triggerIcon=function(input,inst){var patt=/[A-z0-9-_]*\.[A-z]*$/g;var iconElem=$("#"+$(input).attr("id")).parent().find(".ui-datepicker-trigger").eq(0);if(iconElem.attr("src")==undefined){iconElem=$(iconElem).find("img");}if(iconElem.attr("src")!=null){var newPath=iconElem.attr("src").replace(patt,"");iconElem.attr("src",newPath+"calendar2.png");}};Search.prototype.showDatePickerOnLeftSideOfInput=function(input,inst){var offset=$(input).offset();window.setTimeout(function(){inst.dpDiv.css({left:(offset.left-$(inst.dpDiv).width()+$(input).width()+7)+"px"});},1);};Search.prototype.onDateSelected=function(date){var formDOM=$("form[name='SEARCH_FORM']");var self=theSearch;self.commonDateSelect(date,formDOM,this);self.configureMarketingCabin();};Search.prototype.initDatePickers=function(formId){var self=this;var calendarButtonImage=clientSideData.WDS_WEBAPP_URL+"/tam_56.32_290917/air/skin/tam/"+clientSideData.SKIN+"/img/calendar1.png";if(clientSideData.ENABLE_DARK_SITE){calendarButtonImage=clientSideData.WDS_WEBAPP_URL+"/tam_56.32_290917/air/skin/tam/"+clientSideData.SKIN+"/img/calendar2.png";}var formDOM=$("form[id='"+formId+"']");var searchDatePickerConfig={onSelect:self.onDateSelected,onClose:self.onDateSelected,beforeShow:self.triggerIcon,numberOfMonths:2,showButtonPanel:true,buttonImage:calendarButtonImage,buttonText:""};searchDatePickerConfig["maxDate"]=tamUtils.getMaxDate();$("#search_outbound_date, #search_inbound_date").change(function(){var inputToChange="B_DATE_1";if($(this).attr("id")=="search_inbound_date"){inputToChange="B_DATE_2";}if($(this).val()==""){$("#SEARCH_FORM input[name='"+inputToChange+"']").val("");}});if(clientSideData.IS_COMPANION_FLOW==true){var datePickersConfigOutbound={onSelect:self.onDateSelected(formDOM),onClose:self.onDateSelected(formDOM),beforeShow:self.triggerIcon,numberOfMonths:2,showButtonPanel:true,buttonImage:calendarButtonImage,buttonText:""};var datePickersConfigInbound={onSelect:self.onDateSelected(formDOM),onClose:self.onDateSelected(formDOM),beforeShow:self.triggerIcon,numberOfMonths:2,showButtonPanel:true,buttonImage:calendarButtonImage,buttonText:""};var companionFlowDateLimits=clientSideData.COMPANION_LIMITED_DATES;if(companionFlowDateLimits.OUTBOUND_1!=""){datePickersConfigOutbound["minDate"]=theUtils.parseDate(companionFlowDateLimits.OUTBOUND_1);}if(companionFlowDateLimits.OUTBOUND_2!=""){datePickersConfigOutbound["maxDate"]=theUtils.parseDate(companionFlowDateLimits.OUTBOUND_2);}if(companionFlowDateLimits.INBOUND_1!=""){datePickersConfigInbound["minDate"]=theUtils.parseDate(companionFlowDateLimits.INBOUND_1);}if(companionFlowDateLimits.INBOUND_2!=""){datePickersConfigInbound["maxDate"]=theUtils.parseDate(companionFlowDateLimits.INBOUND_2);}if($("#search_outbound_date").parents("#rightPanelArticle").length>0){$("#search_outbound_date").datepicker($.extend({},tamUtils.defaultDatePickerConfigurationObject,datePickersConfigOutbound,{beforeShow:self.showDatePickerOnLeftSideOfInput}));}else{$("#search_outbound_date").datepicker($.extend({},tamUtils.defaultDatePickerConfigurationObject,datePickersConfigOutbound));}if($("#search_inbound_date").parents("#rightPanelArticle").length>0){$("#search_inbound_date").datepicker($.extend({},tamUtils.defaultDatePickerConfigurationObject,datePickersConfigInbound,{beforeShow:self.showDatePickerOnLeftSideOfInput}));}else{$("#search_inbound_date").datepicker($.extend({},tamUtils.defaultDatePickerConfigurationObject,datePickersConfigInbound));}}else{if($("#search_outbound_date, #search_inbound_date").parents("#rightPanelArticle").length>0){$("#search_outbound_date, #search_inbound_date").datepicker($.extend({},tamUtils.defaultDatePickerConfigurationObject,searchDatePickerConfig,{beforeShow:self.showDatePickerOnLeftSideOfInput}));}else{$("#search_outbound_date, #search_inbound_date").datepicker($.extend({},tamUtils.defaultDatePickerConfigurationObject,searchDatePickerConfig));}if(($.browser.msie&&~~($.browser.version)<9)){$("#search_outbound_date, #search_inbound_date").each(function(){$(this).after("<input type='text' style='  border: medium none;color: #FFFFFF;font-size: 1px;height: 1px;left: 4px;line-height: 1px;position: absolute;top: 23px;width: 1px;' readonly='true'></input>");$(this).next("input").attr("tabindex",$(this).attr("tabindex"));});}}$("#search_outbound_date, #search_inbound_date").focus(function(){if(clientSideData.PAGE_CODE=="HOME_SEARCH"&&this.id=="search_outbound_date"){$("#ui-datepicker-div .ui-priority-secondary").after('<span class="info-bound">'+clientMessages["ALLP.text.DatepickerOutbound"]+"</span>");}else{if(clientSideData.PAGE_CODE=="HOME_SEARCH"&&this.id=="search_inbound_date"){$("#ui-datepicker-div .ui-priority-secondary").after('<span class="info-bound">'+clientMessages["ALLP.text.DatepickerInbound"]+"</span>");}}});theUtils.addHighlightingBehavior("search_outbound_date","search_inbound_date");};Search.prototype.commonDateSelect=function(date,formDOM,self){var currenrDate=$(self).val();var datepicker=self;var errorMsgToAdd="";if(theUtils.isUSMarket()){_dateRegex=/^(0?[1-9]|1[012])[\/](0?[1-9]|[12][0-9]|3[01])[\/]\d{4}$/;}else{_dateRegex=/^(0?[1-9]|[12][0-9]|3[01])[\/](0?[1-9]|1[012])[\/]\d{4}$/;}if(!_dateRegex.test(currenrDate)){if(datepicker.id==="search_outbound_date"||datepicker.id==="car_date_1"){errorMsgToAdd=clientMessages["ALLP.error.InvalidOutboundDate"];}else{if(datepicker.id==="hotel_date_1"){errorMsgToAdd=clientMessages["ALLP.error.InvalidArrivalDate"];}else{if(datepicker.id==="hotel_date_2"){errorMsgToAdd=clientMessages["ALLP.error.InvalidDepartureDate"];}else{errorMsgToAdd=clientMessages["ALLP.error.InvalidInboundDate"];}}}$(datepicker).addClass("em").parent().addClass("em");return false;}else{if(datepicker.id==="car_date_1"||datepicker.id==="car_date_2"){theUtils.removeErrorToForm(wdk.form("CAR_FORM"),errorMsgToAdd,[]);}else{if(datepicker.id==="hotel_date_1"||datepicker.id==="hotel_date_2"){theUtils.removeErrorToForm(wdk.form("HOTEL_FORM"),errorMsgToAdd,[]);}else{theUtils.removeErrorToForm(wdk.form("SEARCH_FORM"),errorMsgToAdd,[]);}}$(self).removeClass("em").parent().removeClass("em");}var tempDate=date.split("/");if(tempDate.length!=3&&tempDate.length>0&&tempDate[0]!==""){return false;}else{var tempPatternedDate=[tempDate[0],tempDate[1],tempDate[2]];if(theUtils.isUSMarket()==true){tempPatternedDate=[tempDate[1],tempDate[0],tempDate[2]];}if(date==""){var i=theUtils.isUSMarket()?1:0;tempPatternedDate[i]=undefined;}var firstDate=undefined;var secondDate=undefined;var dateToBeSet=undefined;var validateDependancies=function(firstId,firstInputId,secondId,secondInputId,roundCondition){var increaceDateByOneDay=function(actualDate){return new Date(actualDate.getFullYear(),actualDate.getMonth(),actualDate.getDate()+1);};var decreaceDateByOneDay=function(actualDate){return new Date(actualDate.getFullYear(),actualDate.getMonth(),actualDate.getDate()-1);};firstDate=$("#"+firstId).datepicker("getDate");if(firstDate==null||firstDate==""){$("input[name="+firstInputId+"]",formDOM).val("");}else{dateToBeSet=tempPatternedDate[2].toString()+tempPatternedDate[1].toString()+tempPatternedDate[0].toString();if(firstId!="car_date_1"&&firstId!="car_date_2"&&firstId!="hotel_date_1"&&firstId!="hotel_date_2"){dateToBeSet+="0000";}$("input[name="+firstInputId+"]",formDOM).val(dateToBeSet);if(roundCondition){secondDate=$("#"+secondId).datepicker("getDate");if(secondDate==null||secondDate==""){$("input[name="+secondInputId+"]",formDOM).val("");$("#"+secondId).datepicker("option","defaultDate",date);}else{var equalDate=date;if(firstId=="car_date_1"){equalDate=increaceDateByOneDay($(self).datepicker("getDate"));}else{if(firstId=="car_date_2"){equalDate=decreaceDateByOneDay($(self).datepicker("getDate"));}else{if(firstId=="hotel_date_1"){equalDate=increaceDateByOneDay($(self).datepicker("getDate"));}else{if(firstId=="hotel_date_2"){equalDate=decreaceDateByOneDay($(self).datepicker("getDate"));}}}}if(firstId=="search_outbound_date"||firstId=="car_date_1"||firstId=="hotel_date_1"){if(firstDate>secondDate||((firstId=="car_date_1"||firstId=="hotel_date_1")&&firstDate.getTime()==secondDate.getTime())){$("#"+secondId).datepicker("setDate",equalDate);var beDate=dateToBeSet;if(firstId=="car_date_1"||firstId=="hotel_date_1"){beDate=theUtils.createBEDate($("#"+secondId).val());}$("input[name="+secondInputId+"]",formDOM).val(beDate);}}else{if(firstDate<secondDate||((firstId=="car_date_2"||firstId=="hotel_date_2")&&firstDate.getTime()==secondDate.getTime())){$("#"+secondId).datepicker("setDate",equalDate);var beDate=dateToBeSet;if(firstId=="car_date_2"||firstId=="hotel_date_2"){beDate=theUtils.createBEDate($("#"+secondId).val());}$("input[name="+secondInputId+"]",formDOM).val(beDate);}}}}}};if(self.id=="search_outbound_date"){validateDependancies("search_outbound_date","B_DATE_1","search_inbound_date","B_DATE_2",$("input[name='TRIP_TYPE']:checked",formDOM).val()=="R");}else{if(self.id=="search_inbound_date"){validateDependancies("search_inbound_date","B_DATE_2","search_outbound_date","B_DATE_1",true);}else{if(self.id=="car_date_1"){validateDependancies("car_date_1","CAR_B_DATE_1","car_date_2","CAR_B_DATE_2",true);}else{if(self.id=="car_date_2"){validateDependancies("car_date_2","CAR_B_DATE_2","car_date_1","CAR_B_DATE_1",true);}else{if(self.id=="hotel_date_1"){validateDependancies("hotel_date_1","hotel_b_date_1","hotel_date_2","hotel_b_date_2",true);}else{if(self.id=="hotel_date_2"){validateDependancies("hotel_date_2","hotel_b_date_2","hotel_date_1","hotel_b_date_1",true);}}}}}}}var patt=/[A-z0-9-_]*\.[A-z]*$/g;var iconElem=$("#"+self.id).parent().find(".ui-datepicker-trigger").eq(0);if(iconElem.attr("src")==undefined){iconElem=$(iconElem).find("img");}var newPath=iconElem.attr("src").replace(patt,"");iconElem.attr("src",newPath+"calendar1.png");$(self).next("input").focus();$("#ui-datepicker-div").hide();};Search.prototype.checkDates=function(){$("#search_outbound_date, #search_inbound_date").removeClass("em");$("#search_outbound_date, #search_inbound_date").parent().removeClass("em");var self=this;var returnConfig={hasError:false,homeSearchErrors:""};var formDOM=$("form[name='SEARCH_FORM']");var useMyPointsCheckboxName="passenger_useMyPoints";var fromField="B_LOCATION_1";var toField="E_LOCATION_1";var isRoundTrip=($(formDOM).find("input[name='TRIP_TYPE']:checked").val()=="R");var useMyPointsCheckbox=formDOM.find("input[name='"+useMyPointsCheckboxName+"']");var date1=$("#search_outbound_date").val();var date2=$("#search_inbound_date").val();var invalidOutbound=false,invalidInbound=false;var hasDateError=false;var patternedDate1=self.getPatternedDate(date1),patternedDate2=undefined,outboundPatternedDate=undefined,inboundPatternedDate=undefined;var todayTmp=new Date();var today=new Date(todayTmp.getFullYear(),todayTmp.getMonth(),todayTmp.getDate());var timeZoneOffset=today.getTimezoneOffset()*60000;var offset=timeZoneOffset<0?timeZoneOffset*-1:timeZoneOffset;if(typeof patternedDate1!="undefined"){outboundPatternedDate=new Date(patternedDate1[2],patternedDate1[1]-1,patternedDate1[0]);outboundPatternedDate.setTime(outboundPatternedDate.getTime()+offset);}if(isRoundTrip){patternedDate2=self.getPatternedDate(date2);if(typeof patternedDate2!="undefined"){inboundPatternedDate=new Date(patternedDate2[2],patternedDate2[1]-1,patternedDate2[0]);inboundPatternedDate.setTime(inboundPatternedDate.getTime()+offset);}}var nextYearDateTmp=new Date();var datesValidity=~~clientSideData["WDS_MAX_DATE_REVENUE"];if(useMyPointsCheckbox.prop("checked")){var departureAirport=formDOM.find("input[name='"+fromField+"']").val();var arrivalAirport=formDOM.find("input[name='"+toField+"']").val();if(theUtils.isSouthAmerican(departureAirport)&&theUtils.isSouthAmerican(arrivalAirport)){datesValidity=~~clientSideData["WDS_MAX_DATE_REDEMPTION_DOM"];}else{datesValidity=~~clientSideData["WDS_MAX_DATE_REDEMPTION_INT"];}}nextYearDateTmp.setDate(today.getDate()+datesValidity);var nextYearDate=new Date(nextYearDateTmp.getFullYear(),nextYearDateTmp.getMonth(),nextYearDateTmp.getDate());nextYearDate.setHours("23");nextYearDate.setMinutes("59");if($("#search_outbound_date").val()==""||outboundPatternedDate==undefined||outboundPatternedDate.getFullYear()!=patternedDate1[2]||outboundPatternedDate.getMonth()+1!=patternedDate1[1]||outboundPatternedDate.getDate()!=patternedDate1[0]){$("#search_outbound_date").val("");$("input[name='B_DATE_1']",$("form[name='SEARCH_FORM']")).val("");invalidOutbound=true;if(clientSideData.PAGE_CODE=="HOME_SEARCH"){returnConfig.hasError=true;returnConfig.homeSearchErrors+=" "+clientMessages["ALLP.error.InvalidOutboundDate"];$("#search_outbound_date").addClass("em");$("#search_outbound_date").parent().addClass("em");}else{theUtils.addErrorToForm(wdk.form("SEARCH_FORM"),clientMessages["ALLP.error.InvalidOutboundDate"],$("#search_outbound_date"));}}if(!invalidOutbound){if(outboundPatternedDate<today){$("#search_outbound_date").val("");$("input[name='B_DATE_1']",$("form[name='SEARCH_FORM']")).val("");if(clientSideData.PAGE_CODE=="HOME_SEARCH"){returnConfig.hasError=true;returnConfig.homeSearchErrors+=" "+clientMessages["ALLP.error.InvalidDateBeforeToday"];$("#search_outbound_date").addClass("em");$("#search_outbound_date").parent().addClass("em");}else{theUtils.addErrorToForm(wdk.form("SEARCH_FORM"),clientMessages["ALLP.error.InvalidDateBeforeToday"],$("#search_outbound_date"));}}if((outboundPatternedDate>nextYearDate)){$("#search_outbound_date").val("");$("input[name='B_DATE_1']",$("form[name='SEARCH_FORM']")).val("");if(clientSideData.PAGE_CODE=="HOME_SEARCH"){returnConfig.hasError=true;returnConfig.homeSearchErrors+=" "+clientMessages["ALLP.error.OutboundDateExceedsLimit"].replace("{0}",parseInt(datesValidity)-1);$("#search_outbound_date").addClass("em");$("#search_outbound_date").parent().addClass("em");}else{theUtils.addErrorToForm(wdk.form("SEARCH_FORM"),clientMessages["ALLP.error.OutboundDateExceedsLimit"].replace("{0}",parseInt(datesValidity)-1),$("#search_outbound_date"));}}}if(isRoundTrip){if($("#search_inbound_date").val()==""||inboundPatternedDate==undefined||inboundPatternedDate.getFullYear()!=patternedDate2[2]||inboundPatternedDate.getMonth()+1!=patternedDate2[1]||inboundPatternedDate.getDate()!=patternedDate2[0]){$("#search_inbound_date").val("");$("input[name='B_DATE_2']",$("form[name='SEARCH_FORM']")).val("");invalidInbound=true;if(clientSideData.PAGE_CODE=="HOME_SEARCH"){returnConfig.hasError=true;returnConfig.homeSearchErrors+=" "+clientMessages["ALLP.error.InvalidInboundDate"];$("#search_inbound_date").addClass("em");$("#search_inbound_date").parent().addClass("em");}else{theUtils.addErrorToForm(wdk.form("SEARCH_FORM"),clientMessages["ALLP.error.InvalidInboundDate"],$("#search_inbound_date"));}}if(!invalidInbound){if(inboundPatternedDate<today){$("#search_inbound_date").val("");$("input[name='B_DATE_2']",$("form[name='SEARCH_FORM']")).val("");if(clientSideData.PAGE_CODE=="HOME_SEARCH"){returnConfig.hasError=true;returnConfig.homeSearchErrors+=" "+clientMessages["ALLP.error.InvalidDateBeforeToday"];$("#search_inbound_date").addClass("em");$("#search_inbound_date").parent().addClass("em");}else{theUtils.addErrorToForm(wdk.form("SEARCH_FORM"),clientMessages["ALLP.error.InvalidDateBeforeToday"],$("#search_inbound_date"));}}if(inboundPatternedDate>nextYearDate){$("#search_inbound_date").val("");$("input[name='B_DATE_2']",$("form[name='SEARCH_FORM']")).val("");if(clientSideData.PAGE_CODE=="HOME_SEARCH"){returnConfig.hasError=true;returnConfig.homeSearchErrors+=" "+clientMessages["ALLP.error.InboundDateExceedsLimit"].replace("{0}",parseInt(datesValidity)-1);$("#search_inbound_date").addClass("em");$("#search_inbound_date").parent().addClass("em");}else{theUtils.addErrorToForm(wdk.form("SEARCH_FORM"),clientMessages["ALLP.error.InboundDateExceedsLimit"].replace("{0}",parseInt(datesValidity)-1),$("#search_inbound_date"));}}if(!invalidOutbound){if(outboundPatternedDate>inboundPatternedDate){$("#search_outbound_date").val("");$("#search_inbound_date").val("");$("input[name='B_DATE_1']",$("form[name='SEARCH_FORM']")).val("");$("input[name='B_DATE_2']",$("form[name='SEARCH_FORM']")).val("");if(clientSideData.PAGE_CODE=="HOME_SEARCH"){returnConfig.hasError=true;returnConfig.homeSearchErrors+=" "+clientMessages["ALLP.error.InvalidCombinationDates"];$("#search_inbound_date").addClass("em");$("#search_inbound_date").parent().addClass("em");}else{theUtils.addErrorToForm(wdk.form("SEARCH_FORM"),clientMessages["ALLP.error.InvalidCombinationDates"],$("#search_outbound_date"));}}}}}if(clientSideData.IS_COMPANION_FLOW==true&&(clientSideData.PAGE_CODE=="SEARCH"||clientSideData.PAGE_CODE=="GENERR")){if(date1==date2){var formObj=$("form[name='SEARCH_FORM']");if(($("input[name='B_ANY_TIME_1']").length>0)&&($("input[name='B_ANY_TIME_2']").length>0)){$("input[name='B_ANY_TIME_1']").val("TRUE");$("input[name='B_ANY_TIME_2']").val("TRUE");}else{formObj.append('<input type="hidden" name="B_ANY_TIME_1" value="TRUE"/>');formObj.append('<input type="hidden" name="B_ANY_TIME_2" value="TRUE"/>');}}else{$("input[name='B_ANY_TIME_1']").attr("disabled",true);$("input[name='B_ANY_TIME_2']").attr("disabled",true);}}return returnConfig;};Search.prototype.getPatternedDate=function(date){if(date!=""){var tmp=date.split("/");if(theUtils.isUSMarket()){return[tmp[1],tmp[0],tmp[2]];}else{return tmp;}}return undefined;};Search.prototype.isDateAfter=function(myDate,numberOfDays){var todayTmp=new Date();var limitDate=new Date(todayTmp.getFullYear(),(todayTmp.getMonth()),todayTmp.getDate()+~~numberOfDays);var requestedDate=new Date(myDate[2],myDate[1]-1,myDate[0]);return requestedDate>limitDate;};Search.prototype.manageTabsNavigationListeners=function(){var self=this;$("#onlineSearchButton").click(function(){clientSideData.CAR_FLOW=false;$("#onlineSearchButton").removeClass("unselect").addClass("selected");$("#onlineCheckinButton, #manageBookingButton, #searchCar, #searchHotel").addClass("unselect").removeClass("selected");self.manageTabsNavigation();});$("#onlineCheckinButton").click(function(){$("#onlineCheckinButton").removeClass("unselect").addClass("selected");$("#onlineSearchButton, #manageBookingButton, #searchCar, #searchHotel").addClass("unselect").removeClass("selected");self.manageTabsNavigation("WEBCHECKIN");});$("#manageBookingButton").click(function(){$("#manageBookingButton").removeClass("unselect").addClass("selected");$("#onlineSearchButton, #onlineCheckinButton, #searchCar, #searchHotel").addClass("unselect").removeClass("selected");self.manageTabsNavigation("RETRIEVEPNR");});$("#searchCar").click(function(){clientSideData.CAR_FLOW=true;$(this).removeClass("unselect").addClass("selected");$("#onlineSearchButton, #manageBookingButton, #onlineCheckinButton, #searchHotel").addClass("unselect").removeClass("selected");self.manageTabsNavigation("CARSEARCH");});$("#searchHotel").click(function(){$(this).removeClass("unselect").addClass("selected");$("#onlineSearchButton, #manageBookingButton, #onlineCheckinButton, #searchCar").addClass("unselect").removeClass("selected");self.manageTabsNavigation("HOTELSEARCH");});switch(clientSideData.WDS_NAVIGATION_TAB){case"WEBCHECKIN":$("#onlineCheckinButton").trigger("click");break;case"RETRIEVEPNR":$("#manageBookingButton").trigger("click");break;case"CARSEARCH":$("#searchCar").trigger("click");break;case"HOTELSEARCH":$("#searchHotel").trigger("click");break;default:$("#onlineSearchButton").trigger("click");break;}};Search.prototype.manageTabsNavigation=function(viewName){var self=this;$("#tooltip_countries").hide();$("#ui-datepicker-div").hide();if(isCallOngoing==false){$("#manageBookingPanel, #onlineCheckinPanel, #onlineSearchPanel, #home_online, #home_manage, #home_checkin, #home_car, #home_hotel, #onlineCar, #onlineHotel, #onlineCheckinButton li small, #manageBookingButton li small, #onlineSearchButton li small,  #searchCar li small, #searchHotel li small").addClass("none");switch(viewName){case"WEBCHECKIN":$("#manageBooking, #onlineSearch, #onlineCar, #onlineHotel").addClass("none");$("#onlineCheckin, #home_checkin, #onlineCheckinPanel, #onlineCheckinButton li small").removeClass("none");break;case"RETRIEVEPNR":$("#onlineSearch, #onlineCheckin, #onlineCar, #onlineHotel").addClass("none");$("#manageBooking, #home_manage, #manageBookingPanel, #manageBookingButton li small").removeClass("none");break;case"CARSEARCH":carSearch.init();$("#manageBooking, #onlineSearch, #onlineCheckin, #onlineHotel").addClass("none");$("#carSearch, #home_car, #onlineCar, #searchCar li small").removeClass("none");break;case"HOTELSEARCH":hotelSearch.init();$("#manageBooking, #onlineSearch, #onlineCheckin, #onlineCar").addClass("none");$("#hotelSearch, #home_hotel, #onlineHotel, #searchHotel li small").removeClass("none");break;default:$("#manageBooking, #onlineCheckin, #onlineHotel, #onlineCar").addClass("none");$("#onlineSearch, #home_online, #onlineSearchPanel, #onlineSearchButton li small").removeClass("none");break;}}};Search.prototype.initMultiCityLink=function(formName,linkId){var multiCityLink=$("a#"+linkId);$(multiCityLink).bind("click",function(){window.setTimeout(function(){$("form[name='"+formName+"']").submit();},500);});};Search.prototype.initCheckinOnlinePicker=function(){var maxDateValue="+3d";var datePickersConfig={onSelect:dateSelect,onClose:dateSelect,maxDate:maxDateValue,beforeShow:triggerIcon,numberOfMonths:2,showButtonPanel:true,buttonImage:clientSideData.WDS_WEBAPP_URL+"/tam_56.32_290917/air/skin/tam/"+clientSideData.SKIN+"/img/calendar1.png",buttonText:""};var departureDatePicker=$("#DEPARTURE_DATE");departureDatePicker.datepicker($.extend({},tamUtils.defaultDatePickerConfigurationObject,datePickersConfig));function dateSelect(date){var departureDatePicker=$("#DEPARTURE_DATE");var tempDate=date.split("/");var onlineCheckinForm=$("form[name='ONLINE_CHECKIN_FORM']");if(tempDate.length==3){var tempPatternedDate=[tempDate[0],tempDate[1],tempDate[2]];if(theUtils.isUSMarket()){tempPatternedDate=[tempDate[1],tempDate[0],tempDate[2]];}$("input[name='CHECKIN_DEPARTURE_DATE']",onlineCheckinForm).value(tempPatternedDate[0]+"/"+tempPatternedDate[1]+"/"+tempPatternedDate[2]);}else{departureDatePicker.val("");$("input[name='CHECKIN_DEPARTURE_DATE']",onlineCheckinForm).value("");}var patt=/[A-z0-9-_]*\.[A-z]*$/g;var newPath=$("#DEPARTURE_DATE").next(".ui-datepicker-trigger").attr("src").replace(patt,"");$("#DEPARTURE_DATE").next(".ui-datepicker-trigger").attr("src",newPath+"calendar1.png");}function triggerIcon(input,inst){var patt=/[A-z0-9-_]*\.[A-z]*$/g;var newPath=$("#DEPARTURE_DATE").next(".ui-datepicker-trigger").attr("src").replace(patt,"");$("#DEPARTURE_DATE").next(".ui-datepicker-trigger").attr("src",newPath+"calendar2.png");}$("#DEPARTURE_DATE").next(".ui-datepicker-trigger").click(function(){var patt=/[A-z0-9-_]*\.[A-z]*$/g;var newPath=$(this).find("img").attr("src").replace(patt,"");$(this).find("img").attr("src",newPath+"calendar2.png");$("#DEPARTURE_DATE").datepicker("show");});};Search.prototype.initManageBookingPicker=function(){var datePickersConfig={onSelect:dateSelect,onClose:dateSelect,beforeShow:triggerIcon,numberOfMonths:2,showButtonPanel:true,buttonImage:clientSideData.WDS_WEBAPP_URL+"/tam_56.32_290917/air/skin/tam/"+clientSideData.SKIN+"/img/calendar1.png",buttonText:""};var departureDatePicker=$("#DEPARTURE_DATE_MANAGE_BOOKING");departureDatePicker.datepicker($.extend({},tamUtils.defaultDatePickerConfigurationObject,datePickersConfig));function dateSelect(date){var departureDatePicker=$("#DEPARTURE_DATE_MANAGE_BOOKING");var tempDate=date.split("/");var manageBookingForm=$("form[name='MANAGE_BOOKING_FORM']");if(tempDate.length==3){var tempPatternedDate=[tempDate[0],tempDate[1],tempDate[2]];if(theUtils.isUSMarket()){tempPatternedDate=[tempDate[1],tempDate[0],tempDate[2]];}$("input[name='MANAGE_BOOKING_DEPARTURE_DATE']",manageBookingForm).value(tempPatternedDate[0]+"/"+tempPatternedDate[1]+"/"+tempPatternedDate[2]);}else{departureDatePicker.val("");$("input[name='MANAGE_BOOKING_DEPARTURE_DATE']",manageBookingForm).value("");}var patt=/[A-z0-9-_]*\.[A-z]*$/g;var newPath=$("#DEPARTURE_DATE_MANAGE_BOOKING").next(".ui-datepicker-trigger").attr("src").replace(patt,"");$("#DEPARTURE_DATE_MANAGE_BOOKING").next(".ui-datepicker-trigger").attr("src",newPath+"calendar1.png");}function triggerIcon(input,inst){var patt=/[A-z0-9-_]*\.[A-z]*$/g;var newPath=$("#DEPARTURE_DATE_MANAGE_BOOKING").next(".ui-datepicker-trigger").attr("src").replace(patt,"");$("#DEPARTURE_DATE_MANAGE_BOOKING").next(".ui-datepicker-trigger").attr("src",newPath+"calendar2.png");}$("#DEPARTURE_DATE_MANAGE_BOOKING").next(".ui-datepicker-trigger").click(function(){var patt=/[A-z0-9-_]*\.[A-z]*$/g;var newPath=$(this).find("img").attr("src").replace(patt,"");$(this).find("img").attr("src",newPath+"calendar2.png");$("#DEPARTURE_DATE_MANAGE_BOOKING").datepicker("show");});};Search.prototype.findDefaultCabin=function(flowType){var defaultMCabin=clientSideData.WDS_DEFAULT_MARKETING_CABIN;if(this.isRedemptionView()){if($(clientSideData.WDS_MARKETING_CABINS_REDEMPTION).filter(function(){return this.name===defaultMCabin;}).length==0){defaultMCabin=null;}if($(clientSideData.WDS_MARKETING_CABINS_REDEMPTION).filter(function(){return this.name===clientSideData.WDS_DEFAULT_MCABIN_REDEMPTION_OVERRIDE;}).length>0){defaultMCabin=clientSideData.WDS_DEFAULT_MCABIN_REDEMPTION_OVERRIDE;}}else{if($(clientSideData.WDS_MARKETING_CABINS_REVENUE).filter(function(){return this.name===defaultMCabin;}).length==0){defaultMCabin=null;}if($(clientSideData.WDS_MARKETING_CABINS_REVENUE).filter(function(){return this.name===clientSideData.WDS_DEFAULT_MCABIN_REVENUE_OVERRIDE;}).length>0){defaultMCabin=clientSideData.WDS_DEFAULT_MCABIN_REVENUE_OVERRIDE;}}return defaultMCabin;};Search.prototype.findLastBoundDepartureDate=function(){lastBoundDate=0;$("input:hidden[value!=''][name^='B_DATE_']",$("#SEARCH_FORM")).each(function(){var theDate=parseInt(this.value);if(lastBoundDate<theDate){lastBoundDate=theDate;}});return lastBoundDate/10000;};Search.prototype.configureMarketingCabin=function(confObj){if(typeof confObj==="undefined"||confObj==null){confObj=this.defaultConfObj;}var cacheObj=JSON.parse($.jStorage.get("wts"))||{bounds:[]};var formDOM=$("#SEARCH_FORM");var mcabinSelectElem=$("#MARKETING_CABIN",formDOM);var mcabinPreselect=formDOM.find("#"+confObj.cab).val();if((mcabinPreselect==undefined)&&(cacheObj["roundtripCommon"]!==undefined)){mcabinPreselect=cacheObj["roundtripCommon"]["mcabin"];}var defaultMCabin={};defaultMCabin.name=this.findDefaultCabin();var tripType=$("input[name='TRIP_TYPE'][checked='checked']",formDOM).val();var theCabinOptionsList;var domesticFunc;if(this.isRedemptionView()){theCabinOptionsList=this.cabinOptionsList.cabins.redemption;}else{theCabinOptionsList=this.cabinOptionsList.cabins.revenue;}domesticFunc=theUtils.isDomestic.bind(theUtils);var isDomesticRoute=true;var allAirports=$("input[name^='B_LOCATION_']:enabled,input[name^='E_LOCATION_']:enabled");if(allAirports.length>2){allAirports=$("#rightPanelArticle input[name^='B_LOCATION_'],#rightPanelArticle input[name^='E_LOCATION_']");}allAirports=$.map(allAirports,function(val,i){return $(val).val();}).filter(function(str){return str!="";});$.each(allAirports,function(index,val){isDomesticRoute=isDomesticRoute&&domesticFunc(val);});if(isDomesticRoute||(allAirports.length<1)){theCabinOptionsList=[defaultMCabin];}else{$("option",$(mcabinSelectElem)).remove();}isMCabinOverrideByDeeplink=(clientSideData.ENTRY_REQUEST.MARKETING_CABIN!=null)&&($.inArray(clientSideData.ENTRY_REQUEST.MARKETING_CABIN,theCabinOptionsList)<0);if(isMCabinOverrideByDeeplink&&((mcabinPreselect==undefined)||($.inArray(mcabinPreselect,theCabinOptionsList)<0))){mcabinPreselect=clientSideData.ENTRY_REQUEST.MARKETING_CABIN;}if(isDomesticRoute&&theCabinOptionsList.length>1){delete theCabinOptionsList["1"];}for(var i=0;i<theCabinOptionsList.length;i++){var marketingCabin=theCabinOptionsList[i];if(marketingCabin!=null){var option=$("<option></option>").attr("value",marketingCabin.name).text(clientMessages["ALLP.text.MarketingCabin."+marketingCabin.name]);if(marketingCabin.name==mcabinPreselect){option.prop("selected",true);}$(mcabinSelectElem).append(option);}}$(mcabinSelectElem).selectBox("destroy").selectBox();if(theCabinOptionsList.length>1){$(".cabin_search").show();}else{$(".cabin_search").hide();}$("#promocodebox, #multiCityLink, #multiCityWDSLink").addClass("none").next("br").addClass("none");var pageCode=clientSideData.PAGE_CODE;if($("#miniSearchPageCode").length>0){pageCode=$("#miniSearchPageCode").val();}var isFullpointsActivatedForBookingRedemption=clientSideData.IS_FULLPOINTS_ACTIVATED_FOR_BOOKING_REDEMPTION;if(tripType!="M"){$("#promocodebox, #multiCityLink, #multiCityWDSLink").removeClass("none").next("br").removeClass("none");$(".cabin_search").parents("fieldset").eq(0).addClass("boxl");}else{if(isFullpointsActivatedForBookingRedemption){$("#onlineSearchSubmitButton").html(clientMessages[pageCode+".text.Search"]);}}if($("#passenger_useMyPoints").prop("checked")){$("#promocodebox, #multiCityLink, #multiCityWDSLink").addClass("none").next("br").addClass("none");$("#promocodelink").removeClass("none").next("br").removeClass("none");if(tripType!="M"&&isFullpointsActivatedForBookingRedemption){$("#onlineSearchSubmitButton").html(clientMessages["SEARCH.text.Multiplus.searchSubmit"]);}}else{$("#promocodebox, #multiCityLink, #multiCityWDSLink").removeClass("none").next("br").removeClass("none");$("#promocodelink").addClass("none").next("br").addClass("none");if(!clientSideData.IS_FULL_POINTS_SITE){$("#onlineSearchSubmitButton").html(clientMessages[pageCode+".text.Search"]);}}};Search.prototype.initUseMyPointsManager=function(confObj){this.configureMarketingCabin(confObj);};Search.prototype.isRedemptionView=function(){var result=this.isRedemptionCheckbox.prop("checked");return result;};Search.prototype.bindDestPickers=function(){var primeBookingDestPicker=new destinationPicker();var self=this;primeBookingDestPicker.init("search_from","search_to","1","search_outbound_date");primeBookingDestPicker.bindAirportSelection();if(clientSideData.WDS_DISABLE_FLOW_SPECIFIC_LOCATIONS==false){var topDestinations=clientSideData.TOP_DESTINATION_AIRPORTS;var topDestinationsRedemption=[];$.each(topDestinations,function(){if(this.isRedemption==true){topDestinationsRedemption[topDestinationsRedemption.length]=(this);}});if(self.isRedemptionCheckbox.attr("checked")!=undefined){primeBookingDestPicker.setConfig({"airList":clientSideData.REDEMPTION_AIRPORTS,"topDestinationAirports":topDestinationsRedemption});}else{primeBookingDestPicker.setConfig({"airList":clientSideData.REVENUE_AIRPORTS,"topDestinationAirports":clientSideData.TOP_DESTINATION_AIRPORTS});}self.isRedemptionCheckbox.change(function(){var isChecked=$(this).attr("checked")==undefined?false:true;if(isChecked){primeBookingDestPicker.setConfig({"airList":clientSideData.REDEMPTION_AIRPORTS,"topDestinationAirports":topDestinationsRedemption});primeBookingDestPicker.bindAirportSelection();self.handleAirportListChange(clientSideData.REDEMPTION_AIRPORTS);}else{primeBookingDestPicker.setConfig({"airList":clientSideData.REVENUE_AIRPORTS,"topDestinationAirports":clientSideData.TOP_DESTINATION_AIRPORTS});primeBookingDestPicker.bindAirportSelection();self.handleAirportListChange(clientSideData.REVENUE_AIRPORTS);}});}primeBookingDestPicker.bindDestPickers();};Search.prototype.handleAirportListChange=function(list){var foundFrom=false;var foundTo=false;var fromVal=$("#search_from").attr("data-code");var toVal=$("#search_to").attr("data-code");$.each(list,function(){if(this.IATA==fromVal){foundFrom=true;}if(this.IATA==toVal){foundTo=true;}});if(!foundFrom){$("#search_from").val("");$("#search_from").data("code","");}if(!foundTo){$("#search_to").val("");$("#search_to").data("code","");}};Search.prototype.getBoundDataFromCache=function(cacheObj,bound,field){var result=null;if(typeof cacheObj!=="undefined"&&typeof cacheObj.bounds!=="undefined"&&cacheObj.bounds!=null&&typeof cacheObj.bounds[bound]!=="undefined"&&cacheObj.bounds[bound]!=null&&typeof cacheObj.bounds[bound][field]!=="undefined"){result=cacheObj.bounds[bound][field];}return result;};Search.prototype.fillFormWithCookies=function(){var self=this;var form=$("form[id='SEARCH_FORM']");var cacheObj=JSON.parse($.jStorage.get("wts"))||{bounds:[]};var tripType=cacheObj["tripType"];if(cacheObj["roundtripCommon"]!=undefined){tripType=cacheObj["roundtripCommon"]["tripType"];}$("input[name='TRIP_TYPE']:checked",form).removeAttr("checked");if(tripType!=null&&tripType!="undefined"&&clientSideData.PAGE_CODE=="HOME_SEARCH"&&tripType=="M"){$("input[name='TRIP_TYPE'][value='R']",form).trigger("click");}else{if(tripType!=null&&tripType!="undefined"){$("input[name='TRIP_TYPE'][value='"+tripType+"']",form).trigger("click");}else{$("input[name='TRIP_TYPE'][value='R']",form).trigger("click");}}};Search.prototype.fillCommonWithCookies=function(commonDataObj){var self=this;var form=$("form[id='SEARCH_FORM']");var useMyPoints=commonDataObj["useMyPoints"];if(useMyPoints==="true"){$("#passenger_useMyPoints").click();}var searchAdults=commonDataObj["adults"];if(searchAdults!=null){var adtSelect=$("select[name='adults']",form);adtSelect.value(searchAdults).selectBox("destroy").selectBox();adtSelect.change();}var searchChildren=commonDataObj["children"];if(searchChildren!=null){var chdSelect=$("select[name='children']",form);chdSelect.val(searchChildren).selectBox("destroy").selectBox();chdSelect.change();}var searchInfants=commonDataObj["infants"];if(searchInfants!=null){var infSelect=$("select[name='infants']",form);infSelect.val(searchInfants).selectBox("destroy").selectBox();infSelect.change();}var mCabin=commonDataObj["mcabin"];if(mCabin!=null){var cabinSelect=$("select[name='MARKETING_CABIN']");$("option[value="+mCabin+"]",cabinSelect).attr("selected","selected");cabinSelect.selectBox("destroy").selectBox();}};Search.prototype.fillBoundsWithCookies=function(){var self=this;var form=$("form[id='SEARCH_FORM']");var cacheObj=JSON.parse($.jStorage.get("wts"))||{bounds:[]};var tt=$("input[name='TRIP_TYPE']:checked",form).val();var now=new Date();var chosenCommonData={};if(typeof commonData==="undefined"){commonData={};}if(tt!="M"){chosenCommonData=cacheObj["roundtripCommon"];var bDate1=self.getBoundDataFromCache(cacheObj,10,"bDate");if(bDate1!=null&&bDate1!=""){var bDatepick=new Date(bDate1.substring(0,4)+"/"+bDate1.substring(4,6)+"/"+bDate1.substring(6,8));if(bDatepick<now){bDatepick=now;bDate1=dateFormat(now,clientMessages["GLBL.pattern.AeREDateYearMonthDay"])+"0000";}$("#search_outbound_date").datepicker("setDate",bDatepick);$("input[name='B_DATE_1']",form).val(bDate1);}if(tt=="R"){var bDate2=self.getBoundDataFromCache(cacheObj,11,"bDate");if(bDate2!=null&&bDate2!=""){var eDatepick=new Date(bDate2.substring(0,4)+"/"+bDate2.substring(4,6)+"/"+bDate2.substring(6,8));if(eDatepick<now){eDatepick=now;bDate2=dateFormat(now,clientMessages["GLBL.pattern.AeREDateYearMonthDay"])+"0000";}$("#search_inbound_date").datepicker("setDate",eDatepick);$("input[name='B_DATE_2']",form).val(bDate2);}}else{$("#search_inbound_date").val("");$("input[name='B_DATE_2']",form).val("");}var bLoc1=self.getBoundDataFromCache(cacheObj,10,"bLocation");if(bLoc1!=null){$("#search_from").attr("data-code",bLoc1).blur();$("input[name='B_LOCATION_1']",form).val(bLoc1);}var eLoc1=self.getBoundDataFromCache(cacheObj,10,"eLocation");if(eLoc1!=null){$("#search_to").attr("data-code",eLoc1).blur();$("input[name='E_LOCATION_1']",form).val(eLoc1);}}else{chosenCommonData=cacheObj["multicityCommon"];if(clientSideData.MULTICITY.WDS_MULTICITY_FLOW_MARKET==true){if(typeof multicitySearch!=="undefined"&&multicitySearch){multicitySearch.setPrefillMode(true);}for(var i=1;i<=4;i++){var multiBDate=self.getBoundDataFromCache(cacheObj,i-1,"bDate");if(multiBDate!=null&&multiBDate!=""){var eDatepick=new Date(multiBDate.substring(0,4)+"/"+multiBDate.substring(4,6)+"/"+multiBDate.substring(6,8));$("#multicity_search_date_"+i).datepicker("setDate",eDatepick);$("input[name='B_DATE_"+i+"']",form).val(multiBDate);if(i==1){$("#multicity_search_date_2").datepicker("option","defaultDate",eDatepick);$("#multicity_search_date_3").datepicker("option","defaultDate",eDatepick);$("#multicity_search_date_4").datepicker("option","defaultDate",eDatepick);}else{if(i==2){$("#multicity_search_date_3").datepicker("option","defaultDate",eDatepick);$("#multicity_search_date_4").datepicker("option","defaultDate",eDatepick);}else{if(i==3){$("#multicity_search_date_4").datepicker("option","defaultDate",eDatepick);}}}}var multiBLoc=self.getBoundDataFromCache(cacheObj,i-1,"bLocation");if(multiBLoc!=null){$("#multicity_search_from_"+i).attr("data-code",multiBLoc).blur();$("input[name='B_LOCATION_"+i+"']",form).val(multiBLoc);}var multiELoc=self.getBoundDataFromCache(cacheObj,i-1,"eLocation");if(multiELoc!=null){$("#multicity_search_to_"+i).attr("data-code",multiELoc).blur();$("input[name='E_LOCATION_"+i+"']",form).val(multiELoc);}if(i>2&&multiBDate!=null&&multiBLoc!=null&&multiELoc!=null&&typeof(cacheObj.bounds[i-1])!=="undefined"&&cacheObj.bounds[i-1]!=null&&$("#multicityBound"+i).hasClass("none")==true){$("fieldset#multicitySearch .addFlight button").click();}}if(typeof multicitySearch!=="undefined"&&multicitySearch){multicitySearch.setPrefillMode(false);}}}if(typeof chosenCommonData!=="undefined"){this.fillCommonWithCookies(chosenCommonData);}};Search.prototype.getLocationName=function(Iata){var airportList=this.airList;if(typeof airportList!="undefined"&&airportList.length){for(var i=0;i<airportList.length;i++){if(Iata==airportList[i].IATA){if(airportList[i].name!=airportList[i].airport){return airportList[i].name+" - "+airportList[i].airport+" ("+airportList[i].IATA+")";}else{return airportList[i].name+" ("+airportList[i].IATA+")";}break;}}}return"";};Search.prototype.manageOnlineCheckinFields=function(clickedRadio){var selectedAirline=$(clickedRadio).val();$("#ONLINE_CHECKIN_FORM").find(".em:not(a)").removeClass("em");if(selectedAirline!=undefined){switch(selectedAirline.toUpperCase()){case"LAN":$('[class*="tamr"]').hide();$('[class*="lanr"]').show();$(".tamr").find("input").prop("disabled",true);$(".lanr").find("input").prop("disabled",false);$("#ONLINE_CHECKIN_FORM").attr("action",clientSideData.WDS_WEBCHECKIN_LAN_URL);break;case"TAM":$('[class*="lanr"]').hide();$('[class*="tamr"]').show();$(".lanr").find("input").prop("disabled",true);$(".tamr").find("input").prop("disabled",false);$("#ONLINE_CHECKIN_FORM").attr("action",clientSideData.WDS_WEBCHECKIN_URL);break;}}};Search.prototype.manageBookingFields=function(clickedRadio){var selectedValue=$(clickedRadio).val();$("#MANAGE_BOOKING_FORM").find(".em:not(a)").removeClass("em");if(selectedValue!=undefined){switch(selectedValue.toUpperCase()){case"PNR":$('[class*="manageEtkt"]').hide();$('[class*="managePNR"]').show();$(".manageEtkt").find("input").prop("disabled",true);$(".managePNR").find("input").prop("disabled",false);break;case"ETKT":$('[class*="managePNR"]').hide();$('[class*="manageEtkt"]').show();$(".managePNR").find("input").prop("disabled",true);$(".manageEtkt").find("input").prop("disabled",false);break;}}};Search.prototype.manageAffinityDeeplink=function(){if(clientSideData.WDS_GOTO_AFFINITY=="REDEMPTION"){$("*").hide();$("form[id='affinityRedemptionForm']").submit();}if(clientSideData.WDS_GOTO_AFFINITY=="REVENUE"){$("*").hide();$("form[id='affinityRevenueForm']").submit();}};window.manageHomeSearchView=function(viewName){if(clientSideData.PAGE_CODE=="HOME_SEARCH"||clientSideData.PAGE_CODE=="SEARCH"||clientSideData.PAGE_CODE=="GENERR"){if(typeof theSearch!="undefined"){theSearch.manageTabsNavigation(viewName);}}};$(document).ready(function(){var locationsTemplate=$('<script id="locationsTemplate"'+'type="text/x-jquery-tmpl">{{each obj}}<li data-code="{{html $value.IATA}}"'+'class="midst {{if $value.continent=="BRASIL" || $value.continent=="AMERICA" || $value.continent=="EUROP" || $value.continent=="ASIA"}}{{html $value.continent}}'+'{{else}}{{if $value.continent=="CARIB"}}AMERICA{{else}}ASIA{{/if}}{{/if}}list">'+"{{if $value.name!=$value.airport}} {{html $value.name}} - {{/if}}"+"{{html $value.airport}}&nbsp;({{html $value.IATA}})</li>"+"{{/each obj}}"+"<\/script>");if(clientSideData.PAGE_CODE=="HOME_SEARCH"){try{var domainName=$("#wds_domain_name").text();if($.browser.msie&&parseInt($.browser.version,10)==7){if(domainName=="localhost"){domainName+=".";}}document.domain=domainName;}catch(e){}}window.theSearch=new Search();$(window).on("wdsResponsiveSwitch",function(e,screenState){if(screenState=="mobile"){$("#search_inbound_date, #search_outbound_date").attr("readonly","true");}else{$("#search_inbound_date, #search_outbound_date").removeAttr("readonly");}});$("label[for='search_inbound_date'] input, label[for='search_outbound_date'] input, label[for='search_inbound_date'] img, label[for='search_outbound_date'] img, .ui-corner-all").on("click",function(e){if(window.wdsResponsive.isMobileScreen){setTimeout(function(){$("html, body").animate({scrollTop:$("#ui-datepicker-div").offset().top-50},0);},1);}});});