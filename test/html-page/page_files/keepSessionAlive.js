var keepSessionAlive=(function(window,$,undefined){var _popin=undefined,_showPopin=undefined,_updatePopinTimoutInterval=undefined,_timeLeft=undefined,_interval=undefined,_extendSession=undefined,_timeout=undefined;var _doNotShowTimeout=false;function open($popin){if(!_doNotShowTimeout){$.blockUI({overlayCSS:{backgroundColor:"#000",opacity:0.2}});$popin.dialog({autoOpen:true,draggable:false,width:800,modal:false,resizable:false,dialogClass:"extendSessionPopin responsive-dialog responsive-dialog-640",closeOnEscape:false});$popin.parent("div").find(".ui-dialog-titlebar-close").addClass("none");_popin=$popin;}}function close(){if(typeof _popin!=="undefined"){_popin.trigger("dialogclose");_popin.dialog("destroy");}if(typeof _updatePopinTimoutInterval!=="undefined"){window.clearInterval(_updatePopinTimoutInterval);}$.unblockUI();}function updatePopinTimeout(){_timeLeft=_timeLeft-_interval;var seconds=_timeLeft/1000;var minutes=Math.floor(seconds/60);$("#keepSessionAliveMinutes").text(minutes);$("#keepSessionAliveSeconds").text(seconds%60);if(_timeLeft<=0){if(clientSideData.WDS_ASSISTANT_TIMEOUT_HANDLING==true){theUtils.callAgentOnWdsAction({"ACTION":"AFTER_TIMEOUT","URL":clientSideData.WDS_WEBAPP_URL+"/dyn/air/search?WDS_MARKET="+clientSideData.WDS_MARKET+"&SITE="+clientSideData.SITE+"&LANGUAGE="+clientSideData.LANGUAGE,"LANGUAGE":clientSideData.LANGUAGE});}else{_popin.find("p").text(clientMessages["ALLP.text.SessionTimeOut"]);_extendSession.text(clientMessages["ALLP.text.Ok"]);_extendSession.unbind("click");_extendSession.click(function(){var attachParams="";if(clientSideData["FLOW"]!=undefined&&clientSideData["FLOW"]!=null&&clientSideData["FLOW"]=="SERVICING"){$("#sessionTimeoutRedirect").append("<input type='hidden' name='WDS_NAVIGATION_TAB' value='RETRIEVEPNR'/>");}$("#sessionTimeoutRedirect").submit();});}window.clearInterval(_updatePopinTimoutInterval);}}function process($popin){_timeLeft=_sessionTimeout-_showPopin;if(clientSideData.WDS_ASSISTANT_TIMEOUT_HANDLING==true){theUtils.callAgentOnWdsAction({"ACTION":"BEFORE_TIMEOUT","LANGUAGE":clientSideData.LANGUAGE});}else{open($popin);}updatePopinTimeout();_updatePopinTimoutInterval=window.setInterval(updatePopinTimeout,_interval);}function doCall(){$.ajax({dataType:"json",type:"POST",url:$("form#keepSessionAlive").attr("action"),data:$("form#keepSessionAlive").serialize(),success:function(data){},error:function(request,error){}});var urlCallBack=clientSideData.KEEP_SESSION_URL;var img=new Image();img.onload=function(){img=null;};img.src=urlCallBack;}return{extendSession:function(){close();doCall();_timeout=window.setTimeout(function(){process(_popin);},_sessionTimeout);},extendSessionSilent:function(){doCall();_timeout=window.setTimeout(function(){process(_popin);},_showPopin);},resetTimeout:function(){window.clearTimeout(_timeout);_timeout=window.setTimeout(function(){process(_popin);},_showPopin);},init:function($popin,$extendSession,sessionTimout,_showPopinBeforeTimeout,interval){var self=this;_popin=$popin;_showPopin=_showPopinBeforeTimeout;_interval=interval;_extendSession=$extendSession;_sessionTimeout=sessionTimout;$extendSession.click(function(){self.extendSession();});_timeout=window.setTimeout(function(){process($popin);},_showPopinBeforeTimeout);},disableTimeoutPopin:function(){_doNotShowTimeout=true;}};}(window,jQuery));$(document).ready(function(){if(clientSideData.WDS_ENABLE_KEEP_SESSION_POPIN){keepSessionAlive.init($("#KeepSessionAlive"),$("#extendSession"),clientSideData.SESSION_TIMEOUT*1000,clientSideData.WDS_BEFORE_TIMEOUT*1000,clientSideData.SESSION_INTERVAL*1000);}if(window.wdsResponsive&&window.wdsResponsive.initDialogOpenCloseEventHandler){window.wdsResponsive.initDialogOpenCloseEventHandler("#KeepSessionAlive");}});